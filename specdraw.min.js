!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a,c){"object"==typeof b&&b.exports?b.exports=function(a){return a.contextMenu=c(a),a.contextMenu}:a.d3.contextMenu=c(a.d3)}(this,function(a){return function(b,c){return a.selectAll(".d3-context-menu").data([1]).enter().append("div").attr("class","d3-context-menu"),a.select("body").on("click.d3-context-menu",function(){a.select(".d3-context-menu").style("display","none")}),function(d,e){var f=this;a.selectAll(".d3-context-menu").html("");var g=a.selectAll(".d3-context-menu").append("ul");g.selectAll("li").data(b).enter().append("li").html(function(a){return"string"==typeof a.title?a.title:a.title(d)}).on("click",function(b,c){b.action(f,d,e),a.select(".d3-context-menu").style("display","none")}),c&&c(d,e)===!1||(a.select(".d3-context-menu").style("left",a.event.pageX-2+"px").style("top",a.event.pageY-2+"px").style("display","block"),a.event.preventDefault(),a.event.stopPropagation())}}})},{}],2:[function(a,b,c){var d;!function e(b,c,d){function f(h,i){if(!c[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=c[h]={exports:{}};b[h][0].call(k.exports,function(a){var c=b[h][1][a];return f(c?c:a)},k,k.exports,e,b,c,d)}return c[h].exports}for(var g="function"==typeof a&&a,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(a,b,c){function d(a,b){var c=document,d=a.nodeType||a===window?a:c.createElement(a),f=[];b&&(d.className=b);var g=e(),h=e(),i=function(a,b){d.addEventListener?d.addEventListener(a,b,!1):d.attachEvent("on"+a,b),f.push({event:a,handler:b})},j=function(a,b){d.removeEventListener?d.removeEventListener(a,b):d.detachEvent("on"+a,b);for(var c,e=f.length;e-->0;)if(c=f[e],c.event===a&&c.handler===b){f.splice(e,1);break}},k=function(a){var b=!1,c=function(c){b||(b=!0,setTimeout(function(){b=!1},100),a(c))};i("touchstart",c),i("mousedown",c)},l=function(a){d&&(d.style.display="block",g.fire(a))},m=function(a){d&&(d.style.display="none",h.fire(a))},n=function(){return d.style&&"block"===d.style.display},o=function(a){d&&(d.innerHTML=a)},p=function(a){d&&(o(""),d.appendChild(c.createTextNode(a)))},q=function(){if(d.parentNode){for(var a,b=f.length;b-->0;)a=f[b],j(a.event,a.handler);d.parentNode.removeChild(d),g.removeAllListeners(),h.removeAllListeners()}},r=function(a){var b=a.el||a;d.appendChild(b)};return{el:d,addListener:i,addClickListener:k,onShowEvent:g,onHideEvent:h,show:l,hide:m,isShowing:n,html:o,text:p,remove:q,add:r}}var e=a("./ModalEvent");b.exports=d},{"./ModalEvent":3}],2:[function(a,b,c){function d(a,b,c,f,g){if(void 0!==a){b=b||{};var h,i=e("div","nanoModal nanoModalOverride "+(b.classes||"")),j=e("div","nanoModalContent"),k=e("div","nanoModalButtons");i.add(j),i.add(k),i.el.style.display="none";var l,m=[];b.buttons=b.buttons||[{text:"Close",handler:"hide",primary:!0}];var n=function(){for(var a=m.length;a-->0;){var b=m[a];b.remove()}m=[]},o=function(){i.el.style.marginLeft=-i.el.clientWidth/2+"px"},p=function(){for(var a=document.querySelectorAll(".nanoModal"),b=a.length;b-->0;)if("none"!==a[b].style.display)return!0;return!1},q=function(){i.isShowing()||(d.resizeOverlay(),c.show(c),i.show(l),o())},r=function(){i.isShowing()&&(i.hide(l),p()||c.hide(c),b.autoRemove&&l.remove())},s=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};return l={modal:i,overlay:c,show:function(){return f?f(q,l):q(),l},hide:function(){return g?g(r,l):r(),l},onShow:function(a){return i.onShowEvent.addListener(function(){a(l)}),l},onHide:function(a){return i.onHideEvent.addListener(function(){a(l)}),l},remove:function(){c.onRequestHide.removeListener(h),h=null,n(),i.remove()},setButtons:function(a){var b,c,d,f=a.length,g=function(a,b){var c=s(l);a.addClickListener(function(a){c.event=a||window.event,b.handler(c)})};if(n(),0===f)k.hide();else for(k.show();f-->0;)b=a[f],d="nanoModalBtn",b.primary&&(d+=" nanoModalBtnPrimary"),d+=b.classes?" "+b.classes:"",c=e("button",d),"hide"===b.handler?c.addClickListener(l.hide):b.handler&&g(c,b),c.text(b.text),k.add(c),m.push(c);return o(),l},setContent:function(b){return b.nodeType?(j.html(""),j.add(b)):j.html(b),o(),a=b,l},getContent:function(){return a}},h=c.onRequestHide.addListener(function(){b.overlayClose!==!1&&i.isShowing()&&l.hide()}),l.setContent(a).setButtons(b.buttons),document.body.appendChild(i.el),l}}var e=a("./El"),f=document,g=function(a){var b=f.documentElement,c="scroll"+a,d="offset"+a;return Math.max(f.body[c],b[c],f.body[d],b[d],b["client"+a])};d.resizeOverlay=function(){var a=f.getElementById("nanoModalOverlay");a.style.width=g("Width")+"px",a.style.height=g("Height")+"px"},b.exports=d},{"./El":1}],3:[function(a,b,c){function d(){var a={},b=0,c=function(c){return a[b]=c,b++},d=function(b){b&&delete a[b]},e=function(){a={}},f=function(){for(var c=0,d=b;d>c;++c)a[c]&&a[c].apply(null,arguments)};return{addListener:c,removeListener:d,removeAllListeners:e,fire:f}}b.exports=d},{}],4:[function(a,b,c){var e=a("./ModalEvent"),f=function(){function b(){if(!g.querySelector("#nanoModalOverlay")){var a=d("style"),b=a.el,h=g.querySelectorAll("head")[0].childNodes[0];h.parentNode.insertBefore(b,h);var i=".nanoModal{position:absolute;top:100px;left:50%;display:none;z-index:9999;min-width:300px;padding:15px 20px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;background:#fff;background:-moz-linear-gradient(top,#fff 0,#ddd 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fff),color-stop(100%,#ddd));background:-webkit-linear-gradient(top,#fff 0,#ddd 100%);background:-o-linear-gradient(top,#fff 0,#ddd 100%);background:-ms-linear-gradient(top,#fff 0,#ddd 100%);background:linear-gradient(to bottom,#fff 0,#ddd 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#dddddd', GradientType=0)}.nanoModalOverlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:9998;background:#000;display:none;-ms-filter:\"alpha(Opacity=50)\";-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}.nanoModalButtons{border-top:1px solid #ddd;margin-top:15px;text-align:right}.nanoModalBtn{color:#333;background-color:#fff;display:inline-block;padding:6px 12px;margin:8px 4px 0;font-size:14px;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.nanoModalBtn:active,.nanoModalBtn:focus,.nanoModalBtn:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.nanoModalBtn.nanoModalBtnPrimary{color:#fff;background-color:#428bca;border-color:#357ebd}.nanoModalBtn.nanoModalBtnPrimary:active,.nanoModalBtn.nanoModalBtnPrimary:focus,.nanoModalBtn.nanoModalBtnPrimary:hover{color:#fff;background-color:#3071a9;border-color:#285e8e}";b.styleSheet?b.styleSheet.cssText=i:a.text(i),c=d("div","nanoModalOverlay nanoModalOverride"),c.el.id="nanoModalOverlay",g.body.appendChild(c.el),c.onRequestHide=e();var j=function(){c.onRequestHide.fire()};c.addClickListener(j),d(g).addListener("keydown",function(a){var b=a.which||a.keyCode;27===b&&j()});var k,l=d(window);l.addListener("resize",function(){k&&clearTimeout(k),k=setTimeout(f.resizeOverlay,100)}),l.addListener("orientationchange",function(){for(var a=0;3>a;++a)setTimeout(f.resizeOverlay,1e3*a+200)})}}var c,d=a("./El"),f=a("./Modal"),g=document;document.body&&b();var h=function(a,d){return b(),f(a,d,c,h.customShow,h.customHide)};return h.resizeOverlay=f.resizeOverlay,h}();d=f},{"./El":1,"./Modal":2,"./ModalEvent":3}]},{},[1,2,3,4]),"undefined"!=typeof window&&("function"==typeof window.define&&window.define.amd&&window.define(function(){return d}),window.nanoModal=d),"undefined"!=typeof b&&(b.exports=d)},{}],3:[function(a,b,c){function d(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function e(a,b,c){var d,e=b.x,f=b.y,g=c.x-e,h=c.y-f;return(0!==g||0!==h)&&(d=((a.x-e)*g+(a.y-f)*h)/(g*g+h*h),d>1?(e=c.x,f=c.y):d>0&&(e+=g*d,f+=h*d)),g=a.x-e,h=a.y-f,g*g+h*h}function f(a,b){var c,e,f=a.length,g=a[0],h=[g];for(c=1;f>c;c++)e=a[c],d(e,g)>b&&(h.push(e),g=e);return g!==e&&h.push(e),h}function g(a,b){var c,d,f,g,h=a.length,i=typeof Uint8Array!=void 0+""?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[],o=[];for(j[k]=j[l]=1;l;){for(d=0,c=k+1;l>c;c++)f=e(a[c],a[k],a[l]),f>d&&(g=c,d=f);d>b&&(j[g]=1,m.push(k),n.push(g),m.push(g),n.push(l)),k=m.pop(),l=n.pop()}for(c=0;h>c;c++)j[c]&&o.push(a[c]);return o}function h(a,b,c){var d=void 0!==b?b*b:1;return c||(a=f(a,d)),a=g(a,d)}b.exports=h},{}],4:[function(a,b,c){!function(){"use strict";var b={version:"0.5.2"},c={};b.globals={},b.globals.render=!0,b.d1={},b.d1.integrate=function(){function b(b){function h(b,c){var d,e;return function(f){var h=f.append("g");d=f.append("path").attr("class","line").datum(b);var j=f.append("g").attr("class","integration-text"),l=j.append("rect");e=j.append("text").datum(c).text((c/i).toFixed(2)).on("focus",function(){}).on("blur",function(){});var m=e.node().getBBox();e.attr("dx",-m.width/2).attr("dy",m.height/2),l.attr("width",m.width+4).attr("height",m.height+4).attr("x",m.x-2).attr("y",m.y-2);var n=a("./src/modals");j.on("mouseenter",function(){l.classed("highlight",!0),d.classed("highlight",!0)}).on("mouseleave",function(){l.classed("highlight",!1),d.classed("highlight",!1)}).on("contextmenu",d3.contextMenu([{title:"Set integral",action:n.input("Set Integral to: ",e.text(),function(a){i=e.datum()/a,g.integ_refactor()})}])),h.on("_redraw",function(){d.attr("d",k);var a=d.node().getPointAtLength(.5*d.node().getTotalLength());j.attr("transform","translate("+a.x+","+a.y+")");var b=e.node().getBBox();l.attr("width",b.width+2).attr("height",b.height+2).attr("x",b.x-1).attr("y",b.y-1)}).on("_refactor",function(){e.text((c/i).toFixed(2));var a=e.node().getBBox();e.attr("dx",-a.width/2),h.on("_redraw")()});var o=++g.idx;g.on("redraw.integ."+o,h.on("_redraw")),g.on("integ_refactor."+o,h.on("_refactor"))}}var i,j=(b.attr("width"),b.attr("height"),20),k=d3.svg.line().x(function(a){return e(a.x)}).y(function(a){return f(a.y/j)-f.range()[0]/2});return d=b.append("g").attr("class","integration"),d.node().addIntegral=function(a){var b=c(a),e=b[b.length-1].y;i||(i=e),d.call(h(b,e))},d}function c(a){var b=a.map(function(a){return a.y}).cumsum(),c=a.map(function(a,c){return{x:a.x,y:b[c]}});return c}var d,e,f,g;return b.dispatcher=function(a){return arguments.length?(g=a,b):g},b.xScale=function(a){return arguments.length?(e=a,b):e},b.yScale=function(a){return arguments.length?(f=a,b):f},b},b.d1.line=function(){function c(a){j=c.xScale(),k=c.yScale(),l=c.dispatcher(),o=j.copy();var d,e=[],g=d3.svg.line().interpolate("linear").x(function(a){return j(a.x)}).y(function(a){return k(a.y*u)}),h=a.width();n=v(a),m=a.spectra().indexOf(c);var p=n.append("path").datum(f).classed("line clr"+m,!0);"undefined"==typeof i&&c.crosshair(!0),i&&i.xScale(j).yScale(k).dispatcher(l)(c);var s=b.d1.integrate().xScale(j).yScale(k).dispatcher(l)(n);n.on("_redraw",function(b){if(b.x)p.attr("d",g).attr("transform","scale(1,1)translate(0,0)"),n.selectAll(".segment").attr("d",g);else{var c=k.copy().domain(a.range().y),d=[0,-Math.min(c(k.domain()[1]),c(k.domain()[0]))],e=[1,Math.abs((a.range().y[0]-a.range().y[1])/(k.domain()[0]-k.domain()[1]))];p.attr("transform","scale("+e+")translate("+d+")"),n.selectAll(".segment").attr("transform","scale("+e+")translate("+d+")")}}).on("_regionchange",function(a){if(a.xdomain){var b=r.sliceDataIdx(f,j.domain(),t.x);q=b,d=r.simplify(f.slice(q.start,q.end),j.domain(),h),p.datum(d),t.y=d3.extent(d.map(function(a){return a.y})),t.y[0]*=u,t.y[1]*=u,n.selectAll(".segment").remove(),e.forEach(function(a){var b=d.filter(function(b){return b.x<a[0]&&b.x>a[1]});n.append("path").datum(b).attr("class","segment")}),o.domain([q.start,q.end])}}).on("_integrate",function(a){var b=r.sliceData(f,a.xdomain,t.x);s.node().addIntegral(b),n.node().addSegment([b[0].x,b[b.length-1].x]),l.redraw({y:!0})}).on("_segment",function(){});var w=++l.idx;return l.on("regionchange.line."+w,n.on("_regionchange")),l.on("redraw.line."+w,n.on("_redraw")),l.on("integrate.line."+w,n.on("_integrate")),n.on("remove",function(){l.on("regionchange.line."+w,null),l.on("redraw.line."+w,null),l.on("integrate.line."+w,null),f=null,i&&i.remove()}),n.node().addSegment=function(a){if(a[0].constructor===Array)for(var b=a.length-1;b>=0;b--)this.addSegment(a[b]);else{e.push(a);var c=d.filter(function(b){return b.x<=a[0]&&b.x>=a[1]});n.append("path").datum(c).attr("class","segment").attr("d",g)}},n.node().addSegmentByIndex=function(a){if(a[0].constructor===Array)for(var b=a.length-1;b>=0;b--)this.addSegmentByIndex(a[b]);else this.addSegment([f[a[0]].x,f[a[1]].x])},n}function d(a,b){n&&n.on("_redraw")({x:a,y:b})}function e(){n&&(n.on("_regionchange")({xdomain:j.domain()}),n.on("_redraw")({x:!0}))}var f,g,h,i,j,k,l,m,n,o,p,q,r=a("./src/utils"),s=a("./src/elem"),t={},u=1,v=s.SVGElem()["class"]("spec-line"),w=[];return s.inherit(c,v),c.addPeaks=function(a){w=w.concat(a)},c.delPeaks=function(a){a=a.map(c.ppmToi).sort(d3.ascending),w=w.filter(function(b){return!(b>=a[0]&&b<=a[1])})},c.peaks=function(a){var b=w;return a&&(b=b.filter(function(a){return a>q.start&&a<q.end})),f.subset(b)},c.iToPixel=function(a){return o(a)},c.pixelToi=function(a){return Math.round(o.invert(a))},c.ppmToi=function(a){var b=Math.round(p(a));return Math.abs(a-f[b].x)>Math.abs(a-f[b-1].x)?b--:Math.abs(a-f[b].x)>Math.abs(a-f[b+1].x)&&b++,b},c.range=function(){return t},c.datum=function(a){if(!arguments.length)return f;if(a[0].x)f=a;else if(f&&f.length===a.length)f=a.map(function(a,b){return{x:f[b].x,y:a}});else{var b=d3.scale.linear().range(c.parent().range().x).domain([0,a.length]);f=a.map(function(a,c){return{x:b(c),y:a}})}return t.x=[f[0].x,f[f.length-1].x],t.y=d3.extent(f.map(function(a){return a.y})),i&&i.datum(f),p=d3.scale.linear().range([0,f.length]).domain([f[0].x,f[f.length-1].x]),e(),c},c.label=function(a){return arguments.length?(h=a,c):h},c.crosshair=function(b){return arguments.length?(i=b?a("./src/d1/crosshair")().datum(f):!1,c):i},c.s_id=function(a){return arguments.length?(g=a,c):g},c.lineIdx=function(){return m},c.scaleFactor=function(a){return arguments.length?(u=a,d(),c):u},c},b.d1.main_focus=function(){function c(b){g=c.xScale(),h=c.yScale(),i=c.dispatcher(),f=m(b).attr("pointer-events","all").attr("clip-path","url(#"+b.clipId()+")").attr("width",c.width()).attr("height",c.height()).call(o).on("dblclick.zoom",null).on("mousedown.zoom",null),f.on("_redraw",function(a){i.redraw(a)}).on("_regionchange",function(a){if(a.xdomain&&g.domain(a.xdomain),i.regionchange({xdomain:a.xdomain}),a.ydomain)h.domain(a.ydomain),a.zoom||o.scale((k.y[0]-k.y[1])/(h.domain()[0]-h.domain()[1]));else{var b=d3.min(n.map(function(a){return a.range().y[0]})),c=d3.max(n.map(function(a){return a.range().y[1]})),d=c-b;b-=.05*d,c+=.05*d,k.y=[b,c],h.domain(k.y),i.rangechange({y:k.y}),o.scale(1)}i.regionchange({ydomain:h.domain()}),f.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(k.x=a.x),a.y&&(k.y=a.y),i.rangechange(a),a.norender||f.on("_regionchange")({xdomain:k.x,ydomain:k.y})}).on("mouseenter",i.mouseenter).on("mouseleave",i.mouseleave).on("mousemove",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.mousemove(a)}).on("mousedown",function(){var a=new Event("mousedown");a.pageX=d3.event.pageX,a.clientX=d3.event.clientX,a.pageY=d3.event.pageY,a.clientY=d3.event.clientY,f.select(".main-brush").node().dispatchEvent(a)}).on("click",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.click(a)}).on("dblclick",i.regionfull),i.on("regionfull",function(){f.on("_regionchange")({xdomain:k.x})}),f.append("rect").attr("width",c.width()).attr("height",c.height()).style("fill","none"),a("./src/d1/main-brush")().xScale(g).dispatcher(i)(c);for(var d=0;d<n.length;d++)e(n[d]);a("./src/d1/peak-picker")().xScale(g).yScale(h).dispatcher(i)(c)}function d(){var a=d3.max(n.map(function(a){return a.range().x[0]})),b=d3.min(n.map(function(a){return a.range().x[1]})),c=d3.min(n.map(function(a){return a.range().y[0]})),d=d3.max(n.map(function(a){return a.range().y[1]})),e=d-c;c-=.05*e,d+=.05*e;var h=g.domain();f.on("_rangechange")({x:[a,b],y:[c,d],norender:n.length>1}),n.length>1&&f.on("_regionchange")({xdomain:h})}function e(a){f&&(a.xScale(g).yScale(h).dispatcher(i)(c),d())}var f,g,h,i,j,k={},l=a("./src/elem"),m=l.SVGElem()["class"]("main-focus");l.inherit(c,m);var n=l.ElemArray(),o=d3.behavior.zoom().on("zoom",function(){var a=k.y[1]/o.scale()-k.y[0],b=(a-(h.domain()[1]-h.domain()[0]))/2,c=[];h.domain()[0]===k.y[0]?c[0]=k.y[0]:c[0]=Math.max(h.domain()[0]-b,k.y[0]),c[1]=c[0]+a,f.on("_regionchange")({zoom:!0,ydomain:c})});return c.changeRegion=function(a){f&&f.on("_regionchange")(a)},c.addSpec=function(a,c){if(!arguments.length)throw new Error("appendSlide: No data provided.");"undefined"==typeof c&&(c=!0);var d=null,f="spec"+n.length;console.log(a.label),"undefined"!=typeof a.s_id&&(d=a.s_id),"undefined"!=typeof a.label&&(f=a.label),a=a.data;var g=n.filter(function(a){return a.s_id()===d});return 0===g.length?(g=b.d1.line().datum(a).crosshair(c).s_id(d).label(f),n.push(g)):(g=g[0],g.datum(a)),e(g),g},c.addPeaks=function(a){f&&(f.select(".peaks").node().addpeaks(j.subset(a)),f.select(".peaks").on("_regionchange")({xdomain:!0}),f.select(".peaks").on("_redraw")({x:!0}))},c.nd=function(){return 1},c.spectra=function(){return n},c.range=function(){return k},c.datum=function(a){return arguments.length?(j=a,c.addSpec(a),c):j},c},b.d2={},b.d2.crosshair=function(){function a(a){var f=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),g=0;b=a.append("g").classed("crosshair clr"+g,!0).datum(null).call(f);var h=b.append("g").attr("class","crosshair line");h.append("path").attr("class","crosshair line x").attr("d",d3.svg.line()([[-c.range()[1],0],[c.range()[1],0]])),h.append("path").attr("class","crosshair line y").attr("d",d3.svg.line()([[0,-d.range()[0]],[0,d.range()[0]]]));var i=b.append("circle").attr("r",4.5);b.append("text").attr("x",9).attr("dy","-1em"),b.on("_regionchange",function(a){b.datum(null),b.attr("transform","translate(-10000,-10000)")}).on("_mousemove",function(a){var e=[c.invert(a.xcoor),d.invert(a.ycoor)];f.text(d3.round(e[0],3)+", "+d3.round(e[1],3)).show(i.node()),b.datum(e),b.attr("transform","translate("+a.xcoor+","+a.ycoor+")")}),b.node().show=function(a){return arguments.length?(b.style("display",a?null:"none"),a?f.show(b):f.hide(),void e.on("mousemove.line."+j,a?b.on("_mousemove"):null)):!("none"===b.style("display"))},b.node().enable=function(a){return arguments.length?(a?(e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)})):(e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null)),void b.node().show(a)):params.crosshair},b.node().remove=function(){e.on("regionchange.line."+j,null),e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null),e.on("mousemove.line."+j,null),e.on("crosshairEnable.line."+j,null),data=null,b.remove()};var j=++e.idx;return e.on("regionchange.line."+j,b.on("_regionchange")),e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)}),e.on("mousemove.line."+j,b.on("_mousemove")),e.on("crosshairEnable.line."+j,b.node().enable),b}var b,c,d,e;return a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},b.d2.main_focus=function(){function a(a){c=a.append("g").attr("class","main-focus").attr("pointer-events","all").attr("width",d).attr("height",e).call(k).on("dblclick.zoom",null).on("mousedown.zoom",null),c.node().dispatch_idx=0,c.node().nSpecs=0,c.node().xScale=f,c.node().yScale=g,c.node().range=j,c.node().addPeaks=function(a){c.select(".peaks").node().addpeaks(i.subset(a)),c.select(".peaks").on("_regionchange")({xdomain:!0}),c.select(".peaks").on("_redraw")({x:!0})},c.node().addSpec=function(a,d,e){arguments.length<2&&(d=!0);var i;e&&console.log("overwrite size:",e.size()),e&&0!=e.size()?(console.log("overwriting spec"),i=e,i.node().setData(a.data),a.s_id&&i.node().s_id(a.s_id)):i=b.d2.spec2d().datum(a.data).xScale(f).yScale(g).s_id(a.s_id).range({x:a.x_domain,y:a.y_domain}).crosshair(d).dispatcher(h)(c);var j=f.domain(),k=g.domain();return console.log("domains: ",a.x_domain,a.y_domain),c.on("_rangechange")({x:a.x_domain,y:a.y_domain,norender:c.node().nSpecs>0}),c.node().nSpecs>0&&c.on("_regionchange")({xdomain:j,ydomain:k}),c.node().nSpecs++,i},c.node().addSpecLine=c.node().addSpec,c.node().nd=2,c.node().getThreshold=function(a){c.call(b.d1.threshold().xScale(f).yScale(g).dispatcher(h).callback(a))},c.on("_redraw",function(a){h.redraw(a)}).on("_regionchange",function(a){a.xdomain&&f.domain(a.xdomain),a.ydomain&&g.domain(a.ydomain),h.regionchange({xdomain:a.xdomain,ydomain:g.domain()}),c.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(j.x=a.x),a.y&&(j.y=a.y),h.rangechange(a),a.norender||c.on("_regionchange")({xdomain:j.x,ydomain:j.y})}).on("mouseenter",h.mouseenter).on("mouseleave",h.mouseleave).on("mousemove",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.mousemove(b)}).on("mousedown",function(a){var b=new Event("mousedown");b.pageX=d3.event.pageX,b.clientX=d3.event.clientX,b.pageY=d3.event.pageY,b.clientY=d3.event.clientY,c.select(".main-brush").node().dispatchEvent(b)}).on("click",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.click(b)}).on("dblclick",h.regionfull),h.on("regionfull",function(){c.on("_regionchange")({xdomain:j.x,ydomain:j.y})}),c.node().addSpec(i),c.call(b.d1.mainBrush().xScale(f).yScale(g).dispatcher(h))}var c,d,e,f,g,h,i,j={},k=d3.behavior.zoom().on("zoom",function(){d3.select("#rfunc").attr("slope",k.scale()),d3.select("#bfunc").attr("slope",k.scale())}).scaleExtent([.1,100]);return a.datum=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(h=b,a):h},a.xScale=function(b){return arguments.length?(f=b,a):f},a.yScale=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a},b.d2.spec2d=function(){function a(a){var k,l=a.attr("width"),m=a.attr("height");h=a.append("g").attr("class","spec-img"),h.attr("clip-path","url(#"+h.selectP(".spec-slide").node().clip_id+")");var n=h.append("g").attr("filter","url(#2dColorFilter)").append("svg:image").attr("width",l).attr("height",m).attr("xlink:href","data:image/ png;base64,"+c).attr("preserveAspectRatio","none");h.node().range=i,j&&(k=b.d2.crosshair().xScale(d).yScale(e).dispatcher(g)(h)),h.on("_redraw",function(a){console.log("scale & range: ",d,i.x);var b=d.copy().domain(i.x),c=e.copy().domain(i.y),f=[-Math.min(b(d.domain()[1]),b(d.domain()[0])),-Math.min(c(e.domain()[1]),c(e.domain()[0]))],g=[Math.abs((i.x[0]-i.x[1])/(d.domain()[0]-d.domain()[1])),Math.abs((i.y[0]-i.y[1])/(e.domain()[0]-e.domain()[1]))];n.attr("transform","scale("+g+")translate("+f+")")}).on("_regionchange",function(a){}).on("_integrate",function(a){}).on("_segment",function(a){});var o=++g.idx;return g.on("regionchange.line."+o,h.on("_regionchange")),g.on("redraw.line."+o,h.on("_redraw")),h.node().specData=function(){return c},h.node().setData=function(a){c=a,n.attr("xlink:href","data:image/ png;base64,"+c),h.on("_redraw")()},h.node().specRange=function(){return i},h.node().s_id=function(){return f},h.node().remove=function(){g.on("regionchange.line."+o,null),g.on("redraw.line."+o,null),c=null,h.remove()},h}var c,d,e,f,g,h,i={},j=!0;return a.datum=function(b){return arguments.length?(c=b,a):c},a.range=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.crosshair=function(b){return arguments.length?(j=b,a):j},a.s_id=function(b){return arguments.length?(f=b,a):f},a.xScale=function(b){return arguments.length?(d=b,a):d},a.yScale=function(b){return arguments.length?(e=b,a):e},a},b.app=function(){function c(b){if(h=c.width(),i=c.height(),"undefined"==typeof h||"undefined"==typeof i||isNaN(h)||isNaN(i)){var e=b.node(),n=e.clientWidth?[e.clientWidth,e.clientHeight]:[e.getBoundingClientRect().width,e.getBoundingClientRect().height];h=n[0],i=n[1]}if(400>h||400>i)throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px");g=f(b).style({width:h,height:i}),h-=50,j=a("./src/modals")(c),a("./src/menu/menu")(c),a("./src/events").registerKeyboard(c),g.node().appendToCurrentSlide=function(a){var b=g.select(".spec-slide.active").node();b?(b.addSpec(a),l.slideContentChange()):g.node().appendSlide(a)},l.on("slideChange.app",function(a){k&&k.show(!1),a.show(!0),k=a});for(var o=0;o<m.length;o++)d(m[o])}function d(a){g&&(a.width(h).height(i)(c),l.slideChange(a))}var e=a("./src/elem"),f=e.Elem()["class"]("spec-app");e.inherit(c,f);var g,h,i,j,k,l=d3.dispatch("slideChange","slideContentChange","menuUpdate"),m=e.ElemArray();return c.slides=function(){return m},c.currentSlide=function(a){return arguments.length?void l.slideChange(a):k},c.dispatcher=function(){return l},c.slideDispatcher=function(){return k.slideDispatcher()},c.modals=function(){return j},c.appendSlide=function(a){if(!arguments.length)throw new Error("appendSlide: No data provided.");var e=b.slide().datum(a);return m.push(e),d(e),c},c.appendToCurrentSlide=function(a){if(!arguments.length)throw new Error("appendToCurrentSlide: No data provided.");if(!g){if(0===m.length)return c.appendSlide(a);var b=m[m.length-1].slide;return b.push(a),c}g.node().appendToCurrentSlide(a)},c.options={grid:{x:!1,y:!1}},c},b.slide=function(){function c(d){if(f){i=c.width(),j=c.height();var n=20,o={top:10+n,right:40,bottom:40,left:10+n},p=i-o.left-o.right,q=j-o.top-o.bottom;console.log("slide w,h ",i,j);var r=d3.scale.linear().range([0,p]),s=d3.scale.linear().range([q,0]),t=d3.svg.axis().scale(r).orient("bottom"),u=d3.svg.axis().scale(s).orient("right").tickFormat(d3.format("s")),v=d3.svg.axis().scale(r).orient("bottom").innerTickSize(q).tickFormat(""),w=d3.svg.axis().scale(s).orient("right").innerTickSize(p).tickFormat(""),x=f.nd&&2===f.nd;m.idx=0,console.log(d),h=d.append("svg").classed("spec-slide",!0).attr({width:i,height:j}),g=e(h).attr("transform","translate("+o.left+","+o.top+")").attr({width:i,height:j});var y=g.append("defs");if(y.append("clipPath").attr("id",l).append("rect").attr("width",p).attr("height",q),x){var z=y.append("filter").attr("id","2dColorFilter");z.append("feColorMatrix").attr("type","matrix").attr("values","1 0 0 0 0	0 0 0 0 0 1 0 0 0 0 0 0 0 1 0");var A=z.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");A.append("feFuncR").attr("type","linear").attr("slope","-1").attr("intercept","0.5"),A.append("feFuncB").attr("type","linear").attr("slope","1").attr("intercept","-0.5"),A=z.append("feComponentTransfer").attr("color-interpolation-filters","sRGB"),A.append("feFuncR").attr("id","rfunc").attr("type","linear").attr("slope","1"),A.append("feFuncB").attr("id","bfunc").attr("type","linear").attr("slope","1"),z.append("feColorMatrix").attr("type","matrix").attr("values","-10 0 0 0 1 -10 0 -10 0 1 0 0 -10 0 1 0 0 0 1 0")}g.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")"),g.append("g").attr("class","y axis").attr("transform","translate("+p+",0)"),g.append("g").classed("x grid",!0),g.append("g").classed("y grid",!0),g.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",p/2).attr("y",q).attr("dy","2.8em").text("Chemical shift (ppm)"),g.append("text").attr("class","y label").attr("text-anchor","end").attr("y",p).attr("dy","-.75em").attr("transform","rotate(-90)").text("Intensity"),m.on("redraw.slide",function(a){a.x&&(g.select(".x.axis").call(t),d.options.grid.x&&g.select(".x.grid").call(v)),a.y&&(g.select(".y.axis").call(u),d.options.grid.y&&g.select(".y.grid").call(w))}),k=x?b.d2.main_focus():b.d1.main_focus(),k.datum(f).xScale(r).yScale(s).width(p).height(q).dispatcher(m)(c),a("./src/d1/scale-brush")().xScale(r).dispatcher(m)(c),a("./src/d1/scale-brush")().yScale(s).dispatcher(m)(c),d3.rebind(c,k,"spectra","addSpec","changeRegion","range")}}var d=a("./src/elem"),e=d.Elem("g");d.inherit(c,e);var f,g,h,i,j,k,l=a("./src/utils").guid(),m=d3.dispatch("rangechange","regionchange","regionfull","redraw","mouseenter","mouseleave","mousemove","click","keyboard","peakpickEnable","peakdelEnable","peakpick","peakdel","integrateEnable","integrate","integ_refactor","crosshairEnable","blindregion","log");return c.show=function(a){h.classed("active",a)},c.nd=function(){return f?f.nd&&2===f.nd?2:1:0},c.clipId=function(){return l},c.slideDispatcher=function(){return m},c.specContainer=function(){return k},c.datum=function(a){return arguments.length?(f=a,c):f},c},c.read_menu=function(b,d){var e=c.plugins(b.node()),f=function(a,b){console.log(a,b);for(var c=a.length-1;c>=0;c--)if(a[c].label==b)return a[c].children||(a[c].children=[]),a[c];return a.push({label:b,children:[]}),a[a.length-1]},g=function(a){return a.args?function(){b.modals().methods(a.fun,a.args,a.title)()}:function(){e.request(a.fun)}},h=a("./src/pro/ajax");h.getJSON("/nmr/test",function(a){console.log(d);for(var c=a,e=0;e<a.length;e++){for(var h=f(d,c[e].menu_path[0]),i=1;i<c[e].menu_path.length;i++)h=f(h.children,c[e].menu_path[i]);h.children=null,h.fun=g(c[e]),h.nd=c[e].nd}console.log(d),b.dispatcher().menuUpdate()})},c.output={},c.output.overwriteSpec=function(a,b){"undefined"==typeof b&&"undefined"!=typeof a.s_id&&(b=a.s_id);var c=d3.select(".spec-slide.active").select(".main-focus"),d=1==c.node().nd?".spec-line":".spec-img",e=c.selectAll(d).filter(function(a){return this.s_id()==b});c.node().addSpecLine(a,!0,e)},c.output.preview=function(a){d3.select(".preview-spec").size()>0?d3.select(".preview-spec").node().setData(a):d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a,!1).classed("preview-spec",!0)},c.output.newSpec=function(a){d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a)},c.output.newSlide=function(a){},c.analysis={},c.analysis.addPeaks=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(console.log(f),1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addPeaks(b.peaks)},c.analysis.addSegments=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addSegmentByIndex(b.segs)},c.plugins=function(b){var d={},e=function(){var a=d3.select(b).select(".spec-slide.active").select(".main-focus"),c=1==a.node().nd?".spec-line":".spec-img",d=a.selectAll(c+".selected")[0].map(function(a){return a.s_id()});return 0==d.length&&(d=a.selectAll(c)[0].map(function(a){return a.s_id()})),d},f=function(b,d){var e=b.output?c.output[b.output]:c.output.overwriteSpec;a("./src/pro/process_data").process_spectrum(b,e)},g=function(a,b){void 0!==a.peaks&&c.analysis.addPeaks(a),void 0!==a.segs&&c.analysis.addSegments(a);
};return d.request=function(b,c,f,g){c||(c={}),c.sid||(f?c.sid=f:c.sid=e()),0===c.sid.length&&error("No Spectra selected","Please select one or more spectra!");var h=b+"_",i="sid="+JSON.stringify(c.sid)+"&preview="+ +g+"&"+h+"=null";for(var j in c)"sid"!==j&&(i.length>0&&(i+="&"),i+=h+j+"="+c[j]);var k="/nmr/plugins?"+i,l=a("./src/pro/ajax");l.getJSON(k,function(a){d.response(a,g)})},d.response=function(a,b){if(a.constructor!==Array)return void 0===a.data_type||"spectrum"===a.data_type?f(a,b):"spec_feature"===a.data_type?void g(a,b):"spec_like"===a.data_type?void handle_spec_like(a,b):void 0;for(var c=a.length-1;c>=0;c--)d.response(a[c])},d},c.get_spectrum=a("./src/pro/process_data").get_spectrum,window.spec=b,window.pro=c,console.log("specdraw:"+b.version)}()},{"./src/d1/crosshair":5,"./src/d1/main-brush":6,"./src/d1/peak-picker":7,"./src/d1/scale-brush":8,"./src/elem":10,"./src/events":11,"./src/menu/menu":14,"./src/modals":18,"./src/pro/ajax":19,"./src/pro/process_data":20,"./src/utils":22}],5:[function(a,b,c){b.exports=function(){function b(a,b,c){var d;if(c){var e=[b(a-10),b(a+10)];d=e[0]+g.slice(e[0],e[1]+1).whichMax()}else d=b(a);return g[d]}function c(){var a=".line."+j;h.on("regionchange"+a,null),h.on("mouseenter"+a,null),h.on("mouseleave"+a,null),h.on("mousemove"+a,null),k&&(h.on("regionchange"+a,i.on("_regionchange")),h.on("mouseenter"+a,function(){d.show(!0)}),h.on("mouseleave"+a,function(){d.show(!1)}),l&&h.on("mousemove"+a,i.on("_mousemove"))),h.on("crosshairEnable"+a,d.enable)}function d(a){return e=d.xScale(),f=d.yScale(),h=d.dispatcher(),j=++h.idx,k=l=!0,i=o(a).datum(null).call(m),i.append("circle").attr("class","clr"+a.lineIdx()).attr("r",4.5).on("click",function(){a.sel().toggleClass("selected")}).on("mouseenter",function(){a.sel().selectP(".main-focus").classed("dimmed",!0),a.sel().classed("highlighted",!0)}).on("mouseleave",function(){a.sel().selectP(".main-focus").classed("dimmed",!1),a.sel().classed("highlighted",!1)}),i.on("_regionchange",function(a){if(a.x)i.datum(null),i.attr("transform","translate(-10000,-10000)");else{var b=i.datum();b&&i.attr("transform","translate("+e(b.x)+","+f(b.y)+")")}}).on("_mousemove",function(c){var d=b(c.xcoor,a.pixelToi,c.shiftKey);return"undefined"==typeof d?void i.datum(null):(i.datum(d).attr("transform","translate("+e(d.x)+","+f(d.y)+")"),void m.text(d3.round(d.x,3)).show(i.node()))}).on("remove",function(){d.enabled(!1),h.on("crosshairEnable.line."+j,null),g=null,m.destroy()}),c(),i}var e,f,g,h,i,j,k,l,m=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),n=a("../elem"),o=n.SVGElem()["class"]("crosshair");return n.inherit(d,o),d.show=function(a){return arguments.length?(l=a,i?(i.style("display",a?null:"none"),a?m.show(i):m.hide(),c(),d):d):l},d.enable=function(a){return arguments.length?(k=a,d.show(a)):k},d.datum=function(a){return arguments.length?(g=a,d):g},d}},{"../elem":10}],6:[function(a,b,c){b.exports=function(){function b(){if(l.empty())return h&&i?l.extent([[0,0],[0,0]]):l.extent([0,0]),k.call(l),null;var a={};return h&&i?(a.xdomain=[l.extent()[1][0],l.extent()[0][0]],a.ydomain=[l.extent()[1][1],l.extent()[0][1]]):(a.xdomain=h?l.extent().reverse():null,a.ydomain=i?l.extent():null),l.clear(),k.call(l),a}function c(){var a=b();a&&g.parent().changeRegion(a)}function d(){var a=b();a&&j.peakdel(a)}function e(){var a=b();a&&j.integrate(a)}function f(){l.clear(),k.call(l)}function g(a){h=g.xScale(),i=g.yScale(),j=g.dispatcher(),l=d3.svg.brush().x(h).y(i).on("brushend",c),k=n(a).call(l),k.selectAll("rect").attr("height",a.height()),k.select(".background").style("cursor",null).style("pointer-events","all"),k.on("peakpickEnable",function(a){k.classed("peakpick-brush",a),g.parent().sel().classed("peakpick-brush",a),l.on("brushend",a?f:c)}).on("peakdelEnable",function(a){k.classed("peakdel-brush",a),g.parent().sel().classed("peakdel-brush",a),l.on("brushend",a?d:c)}).on("integrateEnable",function(a){k.classed("integrate-brush",a),g.parent().sel().classed("integrate-brush",a),l.on("brushend",a?e:c)});var b=++j.idx;return j.on("peakpickEnable.brush."+b,k.on("peakpickEnable")),j.on("peakdelEnable.brush."+b,k.on("peakdelEnable")),j.on("integrateEnable.brush."+b,k.on("integrateEnable")),k}var h,i,j,k,l,m=a("../elem"),n=m.SVGElem()["class"]("main-brush");return m.inherit(g,n),g}},{"../elem":10}],7:[function(a,b,c){function d(a,b,c){var d=Math.max(b-10,60);return d3.svg.line().defined(function(a){return!isNaN(a[1])})([[c,40],[a,60],[a,80],[NaN,NaN],[a,d-10],[a,d]])}function e(a,b,c){for(var d=b,e=c-d,f=0;f<a.length;f++)a[f].pos>e&&(a[f].pos=e),e=a[f].pos-d;if(d>e)for(e=d,f=a.length-1;f>=0&&a[f].pos<e;f--)a[f].pos=e,e=a[f].pos+d;return a}function f(a){for(var b=a.spectra(),c=a.xScale(),d=[],e=0;e<b.length;e++){var f=b[e].peaks(!0).map(function(a){return{line:e,pos:c(a.x),d:a}});d=d.concat(f)}return d=d.sort(function(a,b){return d3.descending(a.pos,b.pos)})}var g=a("d3-context-menu")(d3);b.exports=function(){function b(){var a=l.selectAll("text").data(q);a.enter().append("text").attr("dy","0.35em").attr("focusable",!0).on("focus",function(){}),a.exit().remove()}function c(){var a=l.selectAll("path").data(q);a.enter().append("path").style("fill","none"),a.exit().remove()}function h(){l.selectAll("text").text(function(a){return d3.round(a.d.x,3)}).attr("transform",function(a){return"translate("+a.pos+",0)rotate(90)"}).attr("class",function(a){return"peak-text clr"+a.line}).on("keydown",function(a){68===d3.event.keyCode&&o.peakdel({xdomain:[a.d.x,a.d.x]})}).on("click",g(p))}function i(){l.selectAll("path").attr("d",function(a){return d(m(a.d.x),n(a.d.y),a.pos)}).attr("class",function(a){return"peak-line clr"+a.line})}function j(){var a=l.append("text").text("any"),b=a.node().getBBox().height;return a.remove(),b}function k(a){m=k.xScale(),n=k.yScale(),o=k.dispatcher();var d=a.width();l=s(a),l.on("_click",function(b){var c=a.spectra();c.forEach(function(a){if(a.crosshair()){a.crosshair().sel().on("_mousemove")(b);var c=a.crosshair().sel().datum();c&&(console.log(c,a.ppmToi(c.x)),a.addPeaks(a.ppmToi(c.x)))}else a.addPeaks(a.pixelToi(b.xcoor))}),o.peakpick()}).on("_regionchange",function(b){b.xdomain&&(q=f(a),q=e(q,j(),d))}).on("_redraw",function(a){a.x&&(b(),c()),0!==q.length&&(h(),i())}).on("_peakpick",function(){l.on("_regionchange")({xdomain:!0}),l.on("_redraw")({x:!0,y:!0})}).on("_peakdel",function(b){b.xdomain&&a.spectra().forEach(function(a){a.delPeaks(b.xdomain)}),b.ydomain,o.peakpick()});var g=++o.idx;return o.on("regionchange.peaks."+g,l.on("_regionchange")),o.on("redraw.peaks."+g,l.on("_redraw")),o.on("peakpickEnable.peaks."+g,function(a){o.on("click.peaks."+g,a?l.on("_click"):null)}),o.on("peakpick.peaks."+g,l.on("_peakpick")),o.on("peakdel.peaks."+g,l.on("_peakdel")),l}var l,m,n,o,p=[{title:"Delete peak",action:function(a,b){k.parent().spectra().filter(function(a){return a.lineIdx()===b.line})[0].delPeaks([b.d.x,b.d.x]),o.peakpick()}}],q=[],r=a("../elem"),s=r.SVGElem()["class"]("peaks");return r.inherit(k,s),k.peaks=function(){return f(k.parent())},k}},{"../elem":10,"d3-context-menu":1}],8:[function(a,b,c){b.exports=function(){function b(a){e=b.xScale(),f=b.yScale(),g=b.dispatcher();var i=e?e:f;h=e?e.copy():f.copy();var k=d3.svg.axis().scale(h).orient(e?"bottom":"top").tickFormat(d3.format("s")),l=d3.svg.brush().x(h).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brushend",function(){var b=l.empty()?h.domain():l.extent().reverse();b=b.sort(h.domain()[0]>h.domain()[1]?d3.descending:d3.ascending),a.changeRegion(e?{xdomain:b}:{ydomain:b})});d=j(a).classed(e?"x":"y",!0).attr("transform",e?"translate(0,-20)":"translate(-20,0)rotate(90)"),d.append("g").call(k).attr("class","brush-axis"),d.append("g").attr("class","brush").call(l).selectAll("rect").attr("y",-5).attr("height",10),d.select(".background").style("pointer-events","all"),d.on("_rangechange",function(a){(a.x||a.y&&f)&&(h.domain(e?a.x:a.y),d.select(".brush-axis").call(k),d.select(".brush").call(l))}).on("_regionchange",function(a){if(a.xdomain||a.ydomain&&f){var b=c(i.domain(),h.domain());l.extent(b)}}).on("_redraw",function(a){(a.x||a.y&&f)&&d.select(".brush").call(l)});var m=++g.idx;return g.on("rangechange.scalebrush."+m,d.on("_rangechange")),g.on("regionchange.scalebrush."+m,d.on("_regionchange")),g.on("redraw.scalebrush."+m,d.on("_redraw")),d}function c(a,b){var c=[0,0];return a[0]>a[1]?(c[0]=Math.min(a[0],b[0]),c[1]=Math.max(a[1],b[1])):(c[0]=Math.max(a[0],b[0]),c[1]=Math.min(a[1],b[1])),c.join()===b.join()&&(c=[0,0]),c}var d,e,f,g,h,i=a("../elem"),j=i.SVGElem()["class"]("scale-brush");return i.inherit(b,j),b}},{"../elem":10}],9:[function(a,b,c){b.exports=function(){function b(a,g){d=b.xScale()||a.xScale(),e=b.yScale()||a.yScale(),f=b.dispatcher()||a.dispatcher(),c=h(a).on("_mousemove",function(a){c.attr("d",d3.svg.line()([[d.range()[0],a.ycoor],[d.range()[1],a.ycoor]]))}).on("_click",function(a){g(e.invert(a.ycoor)),c.remove(),f.on("mousemove.thresh."+i,null),f.on("click.thresh."+i,null)});var i=++f.idx;f.on("mousemove.thresh."+i,c.on("_mousemove")),f.on("click.thresh."+i,c.on("_click"))}var c,d,e,f,g=a("../elem"),h=g.ResponsiveElem("path")["class"]("threshold line x");return g.inherit(b,h),b}},{"../elem":10}],10:[function(a,b,c){function d(a,b){for(var c in b)"function"==typeof b[c]&&d3.rebind(a,b,c)}function e(a){return a||(a=[]),a.__proto__.nodes=function(){return this.map(function(a){return a.node()})},a}function f(a){function b(b){return c=b.append(a||"div"),d=b,g&&c.classed(g,!0),c}var c,d,e,f,g;return b.sel=function(){return c},b.node=function(){return c?c.node():void 0},b.parent=function(){return d},b.width=function(a){return arguments.length?(e=a,b):e},b.height=function(a){return arguments.length?(f=a,b):f},b["class"]=function(a){return arguments.length?(g=a,b):g},b.append=function(a){if(!c)throw new Error("Elem is not in DOM");return c.append(a)},b.select=function(a){if(!c)throw new Error("Elem is not in DOM");return c.select(a)},b.selectAll=function(a){if(!c)throw new Error("Elem is not in DOM");return c.selectAll(a)},b.remove=function(){c&&(c.on("remove")&&c.on("remove")(),c.remove())},b}function g(a){function b(a){var b=i(a);return b}var c,e,g,h,i=f(a);return b.xScale=function(a){return arguments.length?(c=a,b):c},b.yScale=function(a){return arguments.length?(e=a,b):e},b.datum=function(a){return arguments.length?(g=a,b):g},b.dispatcher=function(a){return arguments.length?(h=a,b):h},d(b,i),b}function h(){function a(a){var c=b(a);return c}var b=g("g");return d(a,b),a}b.exports.inherit=d,b.exports.ElemArray=e,b.exports.Elem=f,b.exports.ResponsiveElem=g,b.exports.SVGElem=h},{}],11:[function(a,b,c){var d={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1,zoom:["x","y",!1]};d.crosshairToggle=function(a){d.crosshair=!d.crosshair,a.slideDispatcher().crosshairEnable(d.crosshair)},d.peakpickToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),console.log(d.zoom),d.peakpick=!d.peakpick,a.slideDispatcher().peakpickEnable(d.peakpick)},d.peakdelToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.peakdel=!d.peakdel,a.slideDispatcher().peakdelEnable(d.peakdel)},d.integrateToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate=!d.integrate,a.slideDispatcher().integrateEnable(d.integrate)},d.zoomToggle=function(a){d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.zoom.rotate(),console.log(d.zoom)};d.registerKeyboard=function(a){console.log(a),d3.select("body").on("keydown",function(){a.slideDispatcher().log("keyCode: "+d3.event.keyCode),80===d3.event.keyCode?d.peakpickToggle(a):68===d3.event.keyCode?d.peakdelToggle(a):73===d3.event.keyCode?d.integrateToggle(a):67===d3.event.keyCode?d.crosshairToggle(a):70===d3.event.keyCode?dispatcher.regionfull(a):90===d3.event.keyCode&&d.zoomToggle(a),a.slideDispatcher().keyboard(d3.event)})},b.exports=d},{}],12:[function(a,b,c){var d={},e=a("./utils").fireEvent;d.num=function(a,b,c,d,e,f){var g=d3.select(document.createElement("label"));return g.classed("param num",!0).text(a).append("input").attr({type:"number",value:"undefined"==typeof b?0:b,min:"undefined"==typeof c?-(1/0):c,max:"undefined"==typeof d?1/0:d,step:"undefined"==typeof e?1:e}).text("undefined"==typeof f?"":f),g.node().getValue=function(){return g.select("input").node().value},function(){return g.node()}},d.checkbox=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param checkbox",!0).append("input").attr("type","checkbox").on("change",function(){e(this,"input")}).node().checked=b?!0:!1,c.append("div").classed("checker",!0),c.append("div").classed("label",!0).text(a),c.node().getValue=function(){return c.select("input").node().checked},function(){return c.node()}},d.checkbox_toggle=function(a,b,c){var f=d3.select(document.createElement("div")).classed("param checkbox-toggle",!0);return f.append(d.checkbox(a,b)).select("input").on("change",function(){f.select(".div_enable").classed("disabled",!this.checked),e(this,"input")}),f.append(d.div(c)).classed("div_enable",!0).classed("disabled",!f.select("input").node().checked),f.node().getValue=f.select(".param.checkbox").node().getValue,function(){return f.node()}},d.select=function(a,b,c){var d=d3.select(document.createElement("label")).classed("param select",!0).text(a),e=d.append("select");return e.selectAll("option").data(b).enter().append("option").text(function(a){return a}),e.node().value=c,d.node().getValue=function(){return e.node().value},function(){return d.node()}},d.select_multi=function(a,b){var c=d3.select(document.createElement("div")).classed("param select-multi",!0);return c.append("label").text(a).append("input").attr("type","checkbox").style("display","none").on("change",function(){c.select("ul").classed("shown",this.checked)}).node().checked=!1,c.append("ul").classed("block-list",!0).selectAll("li").data(b).enter().append("li").each(function(a){d3.select(this).append(d.checkbox(a,!0))}),c.node().getValue=function(){return c.selectAll(".param.checkbox").filter(function(){return this.children[0].checked})[0].map(function(a){return"undefined"!=typeof a.value?a.value:d3.select(a).select(".label").text()})},function(){return c.node()}},d.select_toggle=function(a,b){console.log(a,b);var c=d3.select(document.createElement("div")).classed("param select-toggle",!0);c.append(d.select(a,Object.keys(b))).selectAll("option").attr("value",function(a){return a}).text(function(a){return b[a][0]});var f=c.append("div").classed("method_params",!0),g=c.select("select").node();return c.select("select").on("input",function(){d3.event.stopPropagation()}).on("change",function(){f.select("fieldset").remove(),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),e(this.parentNode,"input")}),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),c.node().getValue=function(){return g.value},function(){return c.node()}},d.button=function(a){var b=d3.select(document.createElement("input")).classed("param btn",!0).attr("type","button").attr("value",a).on("click",function(){e(this,"input")});return b.node().getValue=function(){return d3.event&&d3.event.target===b.node()},function(){return b.node()}},d.threshold=function(b,c,e){console.log("app: ",e);var f=d3.select(document.createElement("div")).classed("param threshold",!0),g=f.append("input").attr("type","hidden"),h=f.append("input").attr("type","text").attr("readonly","readonly");return f.insert(d.button(b),":last-child").on("click",function(){var b=d3.selectAll(".nanoModalOverride:not([style*='display: none'])").style("display","none");th_fun=a("./d1/threshold")(),th_fun(e.currentSlide().specContainer(),function(a){h.attr("value",a.toExponential(2)),g.attr("value",a),b.style("display","block")})}),f.node().getValue=function(){return g.node().value},function(){return f.node()}},d.div=function(a,b){var c=d3.select(document.createElement("div"));for(var d in a){var e=a[d];"function"!=typeof e&&(c.append(f.apply(null,e.concat(b))).node().id=d)}return function(){return c.node()}};var f=function(a,b,c,e){var f=[d.num,d.checkbox,d.text,d.select_toggle,d.checkbox_toggle,d.button,d.threshold][b],g=[a].concat(c);return g=6===b?g.concat(e):g,f.apply(null,g)};d.spectrumSelector=function(){var a=d3.select(".spec-slide.active").select(".main-focus").selectAll(".spec-line");if(0===a.size())return function(){return d3.select(document.createElement("div")).text("No Spectra to show").node()};var b=d3.select(d.select_multi("Select Spectrum",a[0])()).classed("spec-selector",!0);return b.selectAll("li").each(function(a){d3.select(this).select(".checkbox").style("color",getComputedStyle(a.childNodes[0]).stroke).select(".label").text(a.label),d3.select(this).on("mouseenter",function(){d3.select(a.parentNode).classed("dimmed",!0),d3.select(a).classed("highlighted",!0)}).on("mouseleave",function(){d3.select(a.parentNode).classed("dimmed",!1),d3.select(a).classed("highlighted",!1)})}),b.node().getValue=function(){return b.selectAll("li").filter(function(){return d3.select(this).select("input").node().checked===!0}).data().map(function(a){return a.s_id()})},b.node().id="sid",function(){return b.node()}},d.preview=function(a){var b={prev_auto:["Instant Preview",1,"undefined"!=typeof a],prev_btn:["Preview",5,null]};return d.div(b)},d.popover=function(a){var b=d3.select(document.createElement("div")).classed("popover right",!0);b.append("div").classed("arrow",!0);var c=b.append("div").classed("popover-inner",!0);return c.append("h3").classed("popover-title",!0).text(a),c.append("div").classed("popover-content",!0),function(){return b.node()}},b.exports=d},{"./d1/threshold":9,"./utils":22}],13:[function(a,b,c){function d(a){return a.enter().append("li").text(function(a){return a.label}).classed("menu-item",!0).classed("not1d",function(a){return a.nd&&a.nd.indexOf(1)<0}).classed("not2d",function(a){return a.nd&&a.nd.indexOf(2)<0}),a}function e(a){var b=a.filter(function(a){return a.children}).classed("openable",!0).append("div").append("ul").selectAll("li").data(function(a){return a.children}).call(d);b.filter(function(a){return a.children}).size()>0&&e(b)}function f(a){function b(a){a.select(".menu-container").remove();var b=a.append(g.popover("Menu")).classed("menu-container",!0).select(".popover-content").append("div").classed("main-menu",!0).append("ul").classed("nav",!0);b.selectAll("li").data(c).call(d).call(e),b.selectAll("li").on("click",function(b){b.fun?(h.fireEvent(a.node(),"click"),b.fun()):this.focus()})}var c;return b.data=function(a){return arguments.length?(c=a,b):c},b}var g=a("../input_elem"),h=a("../utils");b.exports=f},{"../input_elem":12,"../utils":22}],14:[function(a,b,c){function d(b){function c(a){if(d3.event.target===this){var b=d3.select(this).toggleClass("opened");b.select(".tooltip").style("display",b.classed("opened")?"none":null)}}var d=a("./main_menu")(b),f=a("./spectra")(b),g=a("./slides")(b),h=a("./menu_data")(b),i=[["open-menu","Menu"],["open-spec-legend","Spectra"],["open-slides","Slides"],["open-settings","Settings"],["open-download","Download Spectra"],["open-fullscreen","Fullscreen App"],["connection-status","Connection Status"]],j=b.append("div").classed("column-menu",!0);j.selectAll("div").data(i).enter().append("div").attr("class",function(a){return a[0]}).attr("title",function(a){return a[1]}).call(bootstrap.tooltip().placement("right")).on("click",c),j.select(".open-menu").call(d.data(h));var k=b.dispatcher();return j.select(".open-fullscreen").on("click",function(a){e.fullScreen.toggle(b.node()),c.apply(this)}),d3.select(window).on("resize.fullscreenbutton",function(){j.select(".open-fullscreen").classed("opened",e.fullScreen.isFull())}),k.on("menuUpdate.menu",function(){j.select(".open-menu").call(d)}),k.on("slideChange.menu",function(a){var b=2==a.nd;j.select(".open-menu").classed("d1",!b).classed("d2",b),j.select(".open-spec-legend").call(f),j.select(".open-slides").call(g)}),k.on("slideContentChange.menu",function(){j.select(".open-spec-legend").call(f)}),pro.read_menu(b,h),j}var e=a("../utils");b.exports=d},{"../utils":22,"./main_menu":13,"./menu_data":15,"./slides":16,"./spectra":17}],15:[function(a,b,c){function d(a){var b=a.modals();return[{label:"Processing"},{label:"Analysis",children:[{label:"Peak Picking",children:[{label:"Manual peak picking",fun:e.peakpickToggle},{label:"View/manage peak table",fun:null},{label:"Delete peaks",fun:e.peakdelToggle}]}]},{label:"View",children:[{label:"Change region",children:[{label:"Set X region",fun:b.xRegion},{label:"Set Y region",fun:b.yRegion},{label:"Full spectrum",fun:null,children:[{label:"Error",fun:function(){b.error("error message")}}]},{label:"Reverse Spectrum",fun:null},{label:"Invert Phases",fun:null}]}]},{label:"Integration",fun:e.integrateToggle},{label:"crosshair",fun:e.crosshairToggle},{label:"Selected",fun:function(){},children:[{label:"Scale",fun:b.scaleLine}]}]}var e=a("../events");b.exports=d},{"../events":11}],16:[function(a,b,c){var d=a("../input_elem");b.exports=function(a){function b(b){b.select(".menu-container").remove();var c=b.append(d.popover("Slides")).classed("menu-container",!0).select(".popover-content");return c.append("ul").classed("block-list slide-list",!0).selectAll("li").data(a.slides).enter().append("li").text(function(a,b){return"Slide "+(b+1)}).on("click",function(b){a.dispatcher().slideChange(b)}),b}return b}},{"../input_elem":12}],17:[function(a,b,c){function d(a){function b(a){a.select(".menu-container").remove();var b=a.append(e.popover("Spectra")).classed("menu-container",!0).select(".popover-content"),c=d3.select(e.spectrumSelector()()).select("ul");return 0===c.size()?b.append(e.spectrumSelector()):b.append(function(){return c.node()}).classed("block-list spec-list no-checkbox",!0),a}return b}var e=a("../input_elem");b.exports=d},{"../input_elem":12}],18:[function(a,b,c){function d(b){var c={};return c.proto=function(a,c,d,e){var f=nanoModal(c,{overlayClose:!1,autoRemove:!0,buttons:[{text:"OK",handler:d,primary:!0},{text:"Cancel",handler:e?e:"hide",classes:"cancelBtn"}]});if(!b)return void console.log("App is not defined. Initialize the modal module first.");b.append(function(){return f.overlay.el}),b.append(function(){return f.modal.el});var g=d3.select(f.modal.el);return g.insert("div",":first-child").classed("title",!0).text(a?a:"Dialogue"),g.on("keydown",function(){13===d3.event.keyCode&&d3.select(f.modal.el).select(".nanoModalBtnPrimary").node().click(),27===d3.event.keyCode&&d3.select(f.modal.el).select(".cancelBtn").node().click()}),f.onShow(function(){g.style({display:"flex","flex-direction":"column","margin-left":-g.node().clientWidth/2,"max-width":.8*g.node().parentNode.clientWidth,"max-height":.8*g.node().parentNode.clientHeight});var a=d3.behavior.drag().on("drag",function(){g.style("top",d3.event.sourceEvent.pageY+"px").style("left",d3.event.sourceEvent.pageX+"px")});d3.select(f.modal.el).select(".title").call(a),d3.select(f.modal.el).select(".cancelBtn").node().focus()}),f},c.error=function(a,b){var d=c.proto("Error: "+a,b);d3.select(d.modal.el).classed("errorModal",!0).select(".cancelBtn").text("Dismiss"),d.show()},c.range=function(a,b,d,e){var f;f=b[0]>b[1]?[b[1],b[0]]:b,f=[d3.round(f[0],3),d3.round(f[1],3)],"undefined"==typeof e?e=f:(e[0]>e[1]&&(e=[e[1],e[0]]),e=[d3.round(e[0],3),d3.round(e[1],3)]);var g=a+'<input type="number" id="range0" step="0.001" value='+e[0]+" min="+f[0]+" max="+f[1]+'> - <input type="number" id="range1" step="0.001" value='+e[1]+" min="+f[0]+" max="+f[1]+">",h=c.proto("Range",g,function(a){a.hide();var c=d3.select(a.modal.el).selectAll("input")[0].map(function(a){return+a.value});c[0]<f[0]||c[0]>f[1]||c[1]<f[0]||c[1]>f[1]||c[0]>c[1]?nanoModal("Invalid input."+c).show():d(b[0]>b[1]?c.reverse():c)});return h.show},c.input=function(a,b,d){var e=a+'<input type="number" id="input0" step="0.001" value='+b+">",f=c.proto("Numeric",e,function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;d(b)});return f.show},c.xRegion=function(){c.range("Set x region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.x,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({xdomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().xScale.domain())()},c.yRegion=function(){c.range("Set y region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.y,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({ydomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().yScale.domain())()},c.slider=function(a,b,d){var e=a+'<input id="slider" type="range" min="-5" max="5" value="0" step="0.001"/>',f=c.proto("Slider",e,function(a){a.hide()},function(a){d(0)});return d3.select(f.modal.el).select("#slider").on("input",function(){d(+this.value)}),f.show},c.scaleLine=function(){c.slider("Scale spectrum by a factor:",0,function(a){d3.select(".selected").node().setScaleFactor(Math.pow(2,a))})()},c.methods=function(d,e,f,g,h){var i,j=!0,k=pro.plugins(b.node()),l=function(b){j=!1,a("./utils").fireEvent(i.node(),"input"),b.hide()},m=c.proto(f,"",l);i=d3.select(m.modal.el).select(".nanoModalContent");var n=null;i.on("input",function(){var a={};i.selectAll(".param").filter(function(){return""!==this.id}).each(function(b){a[this.id]=this.getValue()}),n&&clearTimeout(n),j===!1||d3.event.target===i||a.prev_btn===!0?k.request(d,a,a.s_id,j):a.prev_auto===!0&&(n=setTimeout(function(){k.request(d,a,a.s_id,!0)},300))});var o=a("./input_elem");return i.append(o.spectrumSelector()),i.append(o.div(e,b)),i.append(o.preview(!0)),m.show},c}a("nanoModal"),nanoModal.customHide=function(a,b){b.modal.el.style.display="block",a()},b.exports=d},{"./input_elem":12,"./utils":22,nanoModal:2}],19:[function(a,b,c){var d=a("../modals"),e=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){var a=4,e=200;d.readyState===a&&d.status===e?"function"==typeof b&&b(d.responseText):d.readyState===a&&c(d.responseText)},d.send()},f=function(a,b,c){var f=g();e(a,function(a){f.stop();var c=JSON.parse(a);"undefined"==typeof c.error?b(c):d.error(c.error.name,c.error.message)},function(a){f.stop(),d.error("Network Error",a)}),c&&f()},g=function(){function a(){e("/nmr/test",function(b){c?ajax("/nmr/test?complete=1"):(d3.select(".progress").text(b),setTimeout(a,100))})}var b,c=!1,d=function(){a()};return d.stop=function(){clearInterval(b),c=!0,d3.select(".progress").text("Completed")},d};b.exports.request=e,b.exports.getJSON=f},{"../modals":18}],20:[function(a,b,c){function d(b,c){if(console.log("processing"),b.constructor!==Array)switch(b.format){case"xy":f(b,c);break;case"base64":g(b,c);break;case"png":case"png16":a("./worker").maxWorkers()>0?i(b,c):h(b,c)}else for(var e=b.length-1;e>=0;e--)d(b[e],c)}function e(b,c){var e=a("./ajax");e.getJSON(b,function(a){d(a,c)})}var f=function(a,b){var c=a.x.map(function(b,c){return{x:b,y:a.y[c]}});b(c)},g=function(a,b){var c=atob(a.y);console.log(c);var d=d3.scale.linear().range(a.x_domain).domain([0,c.length]),e=d3.scale.linear().range(a.y_domain).domain([0,255]),f=c.map(function(a,b){return{x:d(b),y:e(a)}});b(f)},h=function(a,b){if(a.nd&&1!=a.nd)2==a.nd?b(a):console.log("Unsupported data dimension: "+a.nd);else{var c=document.createElement("img");c.onload=function(){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var e=d.getContext("2d");e.drawImage(c,0,0);var f=e.getImageData(0,0,c.width,c.height).data,g=[],h="png16"==a.format,i=h?f.length/2:f.length,j=d3.scale.linear().range(a.y_domain).domain([0,255]);h&&j.domain([0,Math.pow(2,16)-1]);for(var k=0;i>k;k+=4)h?g.push(j((f[k+i]<<8)+f[k])):g.push(j(f[k]));if(a.x_domain){var l=d3.scale.linear().range(a.x_domain).domain([0,g.length]);g=g.map(function(a,b){return{x:l(b),y:a}})}var m;m="undefined"!=typeof a.s_id?{data:g,s_id:a.s_id}:{data:g},b(m)};var d=a.data?a.data:a.y;c.src="data:image/png;base64,"+d}},i=function(b,c){if(b.nd&&1!=b.nd)2==b.nd?c(b):console.log("Unsupported data dimension: "+b.nd);else{var d=document.createElement("img");d.onload=function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f={};f._16bit="png16"==b.format;var g=e.getContext("2d");g.drawImage(d,0,0),f.buffer=g.getImageData(0,0,d.width,d.height).data,f.y_range=b.y_domain,f.y_domain=[0,255],f._16bit&&(f.y_domain=[0,Math.pow(2,16)-1]);var h=function(a){console.log("worker done");var d=[].slice.call(a.data);if(b.x_domain){var e=d3.scale.linear().range(b.x_domain).domain([0,d.length]);d=d.map(function(a,b){return{x:e(b),y:a}})}b.data=d,c(b)},i=[f,[f.buffer.buffer]];a("./worker").addJob({message:i,callback:h})};var e=b.data?b.data:b.y;d.src="data:image/png;base64,"+e}};b.exports.get_spectrum=e,b.exports.process_spectrum=d},{"./ajax":19,"./worker":21}],21:[function(a,b,c){function d(){var a=function(){function a(a,b){var c=b[1]-b[0],d=a[1]-a[0];return function(e){return(e-b[0])/c*d+a[0]}}self.onmessage=function(b,c){b=b.data;for(var d=b.buffer,e=b._16bit?d.length/2:d.length,f=a(b.y_range,b.y_domain),g=new Float64Array(e/4),h=0;e>h;h+=4)b._16bit?g[h/4]=f((d[h+e]<<8)+d[h]):g[h/4]=f(d[h]);self.postMessage(g,[g.buffer])}},b=new Blob(["("+a.toString()+")()"],{type:"application/javascript"}),c=window.URL.createObjectURL(b),d=new Worker(c);return d}function e(a){var b=k.shift();b&&(a.hasJob=!0,a.onmessage=function(c){var d=b.callback;a.hasJob=!1,e(a),d(c)},a.postMessage(b.message[0],b.message[1]))}function f(a){k.push(a);var b=g();"undefined"!=typeof b&&e(b)}function g(){for(var a=0;a<i.length;a++)if(!i[a].hasJob)return i[a];if(i.length<j){var b=d();return i.push(b),b}return void 0}function h(a){return arguments.length?void(j=a):j}var i=[],j=(navigator.hardwareConcurrency||2)-1,k=[];b.exports.addJob=f,b.exports.maxWorkers=h},{}],22:[function(a,b,c){function d(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function e(a){d()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():h(a)}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}Array.prototype.subset=function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push(this[a[c]]);return b},Array.prototype.rotate=function(a){return a?this.push(this.shift()):this.unshift(this.pop()),this},Array.prototype.rotateTo=function(a){for(;this[0]!==a;)this.rotate();return this},Array.prototype.whichMax=function(){if(!this.length||0===this.length)return null;if(1===this.length)return 0;for(var a=this[0].y,b=0,c=1;c<this.length;c++)this[c].y>a&&(b=c,a=this[c].y);return b},Array.prototype.cumsum=function(){for(var a=[this[0]],b=0,c=this.length-1;c>b;b++)a[b+1]=a[b]+this[b+1];return a},d3.selection.prototype.selectP=function(a){for(var b=this.node().parentNode;b;){if(b.matches(a))return d3.select(b);b=b.parentNode}return null},d3.selection.prototype.toggleClass=function(a){return this.classed(a,!this.classed(a))},d3.selection.prototype.size=function(){var a=0;return this.each(function(){++a}),a};var g=function(a,b){if(document.createEventObject){var c=document.createEventObject();return a.fireEvent("on"+b,c)}var c=document.createEvent("HTMLEvents");return c.initEvent(b,!0,!0),!a.dispatchEvent(c)},h=function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},i=function(a,b,c){
var d=a.length*(b[0]-b[1])/(c[0]-c[1]),e=a.length*(b[0]-c[0])/(c[1]-c[0]);return{start:e,end:e+d}},j=function(a,b,c){var d=i(a,b,c);return a.slice(d.start,d.end)},k=function(b,c,d){var e=a("simplify")(b,(c[0]-c[1])/d);return e};b.exports.fireEvent=g,b.exports.fullScreen={},b.exports.fullScreen.launch=h,b.exports.fullScreen.toggle=e,b.exports.fullScreen.isFull=d,b.exports.guid=f,b.exports.simplify=k,b.exports.sliceData=j,b.exports.sliceDataIdx=i},{simplify:3}]},{},[4,19,18,10,11,22,21,20,5,6,8,9]);