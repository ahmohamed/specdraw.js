!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d;!function e(b,c,d){function f(h,i){if(!c[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=c[h]={exports:{}};b[h][0].call(k.exports,function(a){var c=b[h][1][a];return f(c?c:a)},k,k.exports,e,b,c,d)}return c[h].exports}for(var g="function"==typeof a&&a,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(a,b,c){function d(a,b){var c=document,d=a.nodeType||a===window?a:c.createElement(a),f=[];b&&(d.className=b);var g=e(),h=e(),i=function(a,b){d.addEventListener?d.addEventListener(a,b,!1):d.attachEvent("on"+a,b),f.push({event:a,handler:b})},j=function(a,b){d.removeEventListener?d.removeEventListener(a,b):d.detachEvent("on"+a,b);for(var c,e=f.length;e-->0;)if(c=f[e],c.event===a&&c.handler===b){f.splice(e,1);break}},k=function(a){var b=!1,c=function(c){b||(b=!0,setTimeout(function(){b=!1},100),a(c))};i("touchstart",c),i("mousedown",c)},l=function(a){d&&(d.style.display="block",g.fire(a))},m=function(a){d&&(d.style.display="none",h.fire(a))},n=function(){return d.style&&"block"===d.style.display},o=function(a){d&&(d.innerHTML=a)},p=function(a){d&&(o(""),d.appendChild(c.createTextNode(a)))},q=function(){if(d.parentNode){for(var a,b=f.length;b-->0;)a=f[b],j(a.event,a.handler);d.parentNode.removeChild(d),g.removeAllListeners(),h.removeAllListeners()}},r=function(a){var b=a.el||a;d.appendChild(b)};return{el:d,addListener:i,addClickListener:k,onShowEvent:g,onHideEvent:h,show:l,hide:m,isShowing:n,html:o,text:p,remove:q,add:r}}var e=a("./ModalEvent");b.exports=d},{"./ModalEvent":3}],2:[function(a,b,c){function d(a,b,c,f,g){if(void 0!==a){b=b||{};var h,i=e("div","nanoModal nanoModalOverride "+(b.classes||"")),j=e("div","nanoModalContent"),k=e("div","nanoModalButtons");i.add(j),i.add(k),i.el.style.display="none";var l,m=[];b.buttons=b.buttons||[{text:"Close",handler:"hide",primary:!0}];var n=function(){for(var a=m.length;a-->0;){var b=m[a];b.remove()}m=[]},o=function(){i.el.style.marginLeft=-i.el.clientWidth/2+"px"},p=function(){for(var a=document.querySelectorAll(".nanoModal"),b=a.length;b-->0;)if("none"!==a[b].style.display)return!0;return!1},q=function(){i.isShowing()||(d.resizeOverlay(),c.show(c),i.show(l),o())},r=function(){i.isShowing()&&(i.hide(l),p()||c.hide(c),b.autoRemove&&l.remove())},s=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};return l={modal:i,overlay:c,show:function(){return f?f(q,l):q(),l},hide:function(){return g?g(r,l):r(),l},onShow:function(a){return i.onShowEvent.addListener(function(){a(l)}),l},onHide:function(a){return i.onHideEvent.addListener(function(){a(l)}),l},remove:function(){c.onRequestHide.removeListener(h),h=null,n(),i.remove()},setButtons:function(a){var b,c,d,f=a.length,g=function(a,b){var c=s(l);a.addClickListener(function(a){c.event=a||window.event,b.handler(c)})};if(n(),0===f)k.hide();else for(k.show();f-->0;)b=a[f],d="nanoModalBtn",b.primary&&(d+=" nanoModalBtnPrimary"),d+=b.classes?" "+b.classes:"",c=e("button",d),"hide"===b.handler?c.addClickListener(l.hide):b.handler&&g(c,b),c.text(b.text),k.add(c),m.push(c);return o(),l},setContent:function(b){return b.nodeType?(j.html(""),j.add(b)):j.html(b),o(),a=b,l},getContent:function(){return a}},h=c.onRequestHide.addListener(function(){b.overlayClose!==!1&&i.isShowing()&&l.hide()}),l.setContent(a).setButtons(b.buttons),document.body.appendChild(i.el),l}}var e=a("./El"),f=document,g=function(a){var b=f.documentElement,c="scroll"+a,d="offset"+a;return Math.max(f.body[c],b[c],f.body[d],b[d],b["client"+a])};d.resizeOverlay=function(){var a=f.getElementById("nanoModalOverlay");a.style.width=g("Width")+"px",a.style.height=g("Height")+"px"},b.exports=d},{"./El":1}],3:[function(a,b,c){function d(){var a={},b=0,c=function(c){return a[b]=c,b++},d=function(b){b&&delete a[b]},e=function(){a={}},f=function(){for(var c=0,d=b;d>c;++c)a[c]&&a[c].apply(null,arguments)};return{addListener:c,removeListener:d,removeAllListeners:e,fire:f}}b.exports=d},{}],4:[function(a,b,c){var e=a("./ModalEvent"),f=function(){function b(){if(!g.querySelector("#nanoModalOverlay")){var a=d("style"),b=a.el,h=g.querySelectorAll("head")[0].childNodes[0];h.parentNode.insertBefore(b,h);var i=".nanoModal{position:absolute;top:100px;left:50%;display:none;z-index:9999;min-width:300px;padding:15px 20px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;background:#fff;background:-moz-linear-gradient(top,#fff 0,#ddd 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fff),color-stop(100%,#ddd));background:-webkit-linear-gradient(top,#fff 0,#ddd 100%);background:-o-linear-gradient(top,#fff 0,#ddd 100%);background:-ms-linear-gradient(top,#fff 0,#ddd 100%);background:linear-gradient(to bottom,#fff 0,#ddd 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#dddddd', GradientType=0)}.nanoModalOverlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:9998;background:#000;display:none;-ms-filter:\"alpha(Opacity=50)\";-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}.nanoModalButtons{border-top:1px solid #ddd;margin-top:15px;text-align:right}.nanoModalBtn{color:#333;background-color:#fff;display:inline-block;padding:6px 12px;margin:8px 4px 0;font-size:14px;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.nanoModalBtn:active,.nanoModalBtn:focus,.nanoModalBtn:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.nanoModalBtn.nanoModalBtnPrimary{color:#fff;background-color:#428bca;border-color:#357ebd}.nanoModalBtn.nanoModalBtnPrimary:active,.nanoModalBtn.nanoModalBtnPrimary:focus,.nanoModalBtn.nanoModalBtnPrimary:hover{color:#fff;background-color:#3071a9;border-color:#285e8e}";b.styleSheet?b.styleSheet.cssText=i:a.text(i),c=d("div","nanoModalOverlay nanoModalOverride"),c.el.id="nanoModalOverlay",g.body.appendChild(c.el),c.onRequestHide=e();var j=function(){c.onRequestHide.fire()};c.addClickListener(j),d(g).addListener("keydown",function(a){var b=a.which||a.keyCode;27===b&&j()});var k,l=d(window);l.addListener("resize",function(){k&&clearTimeout(k),k=setTimeout(f.resizeOverlay,100)}),l.addListener("orientationchange",function(){for(var a=0;3>a;++a)setTimeout(f.resizeOverlay,1e3*a+200)})}}var c,d=a("./El"),f=a("./Modal"),g=document;document.body&&b();var h=function(a,d){return b(),f(a,d,c,h.customShow,h.customHide)};return h.resizeOverlay=f.resizeOverlay,h}();d=f},{"./El":1,"./Modal":2,"./ModalEvent":3}]},{},[1,2,3,4]),"undefined"!=typeof window&&("function"==typeof window.define&&window.define.amd&&window.define(function(){return d}),window.nanoModal=d),"undefined"!=typeof b&&(b.exports=d)},{}],2:[function(a,b,c){function d(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function e(a,b,c){var d,e=b.x,f=b.y,g=c.x-e,h=c.y-f;return(0!==g||0!==h)&&(d=((a.x-e)*g+(a.y-f)*h)/(g*g+h*h),d>1?(e=c.x,f=c.y):d>0&&(e+=g*d,f+=h*d)),g=a.x-e,h=a.y-f,g*g+h*h}function f(a,b){var c,e,f=a.length,g=a[0],h=[g];for(c=1;f>c;c++)e=a[c],d(e,g)>b&&(h.push(e),g=e);return g!==e&&h.push(e),h}function g(a,b){var c,d,f,g,h=a.length,i=typeof Uint8Array!=void 0+""?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[],o=[];for(j[k]=j[l]=1;l;){for(d=0,c=k+1;l>c;c++)f=e(a[c],a[k],a[l]),f>d&&(g=c,d=f);d>b&&(j[g]=1,m.push(k),n.push(g),m.push(g),n.push(l)),k=m.pop(),l=n.pop()}for(c=0;h>c;c++)j[c]&&o.push(a[c]);return o}function h(a,b,c){var d=void 0!==b?b*b:1;return c||(a=f(a,d)),a=g(a,d)}b.exports=h},{}],3:[function(a,b,c){!function(){"use strict";var b={version:"0.5.2"},c={};b.globals={},b.globals.render=!0,b.d1={},b.d1.threshold=function(){function a(a){b=a.append("path").attr("class","threshold line x").on("_mousemove",function(a){b.attr("d",d3.svg.line()([[c.range()[0],a.ycoor],[c.range()[1],a.ycoor]]))}).on("_click",function(a){f(d.invert(a.ycoor)),b.remove(),e.on("mousemove.thresh."+g,null),e.on("click.thresh."+g,null)});var g=++e.idx;e.on("mousemove.thresh."+g,b.on("_mousemove")),e.on("click.thresh."+g,b.on("_click"))}var b,c,d,e,f;return a.callback=function(b){return arguments.length?(f=b,a):f},a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},b.d1.crosshair=function(){function a(a){var g=function(a){var b;if(a.shiftKey){var c=[Math.floor(j.invert(a.xcoor-10)),Math.floor(j.invert(a.xcoor+10))];b=c[0]+e.slice(c[0],c[1]+1).whichMax()}else b=Math.floor(j.invert(a.xcoor));return b},h=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),j=c.copy(),k=a.node().line_idx;b=a.append("g").attr("class","crosshair").datum(null).call(h),b.append("circle").attr("class","clr"+k).attr("r",4.5).on("click",function(){a.toggleClass("selected")}).on("mouseenter",function(){a.selectP(".main-focus").classed("dimmed",!0),a.classed("highlighted",!0)}).on("mouseleave",function(){a.selectP(".main-focus").classed("dimmed",!1),a.classed("highlighted",!1)}),b.append("text").attr("x",9).attr("dy","-1em"),b.on("_regionchange",function(a){if(a.x)b.datum(null),b.attr("transform","translate(-1000,-1000)");else{var e=b.datum();e&&b.attr("transform","translate("+c(e.x)+","+d(e.y)+")")}}).on("_mousemove",function(a){var f=g(a);return"undefined"==typeof e[f]?(b.attr("i_pos",null),void b.datum(null)):(h.text(d3.round(e[f].x,3)).show(b.node()),b.attr("i_pos",f),b.datum(e[f]),void b.attr("transform","translate("+c(e[f].x)+","+d(e[f].y)+")"))}),b.node().setData=function(a){e=a},b.node().dataSlice=function(a){return arguments.length?void j.domain(a):j.domain()},b.node().show=function(a){return arguments.length?(b.style("display",a?null:"none"),a?h.show(b):h.hide(),void f.on("mousemove.line."+l,a?b.on("_mousemove"):null)):!("none"===b.style("display"))},b.node().enable=function(a){return arguments.length?(a?(f.on("mouseenter.line."+l,function(){b.node().show(!0)}),f.on("mouseleave.line."+l,function(){b.node().show(!1)})):(f.on("mouseenter.line."+l,null),f.on("mouseleave.line."+l,null)),void b.node().show(a)):params.crosshair},b.node().i=function(a){return arguments.length?(b.attr("i_pos",i),void b.datum(e[i])):b.attr("i_pos")},b.node().remove=function(){f.on("regionchange.line."+l,null),f.on("mouseenter.line."+l,null),f.on("mouseleave.line."+l,null),f.on("mousemove.line."+l,null),f.on("crosshairEnable.line."+l,null),e=null,b.remove()};var l=++f.idx;return f.on("regionchange.line."+l,b.on("_regionchange")),f.on("mouseenter.line."+l,function(){b.node().show(!0)}),f.on("mouseleave.line."+l,function(){b.node().show(!1)}),f.on("mousemove.line."+l,b.on("_mousemove")),f.on("crosshairEnable.line."+l,b.node().enable),b}var b,c,d,e,f;return a.dispatcher=function(b){return arguments.length?(f=b,a):f},a.datum=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},b.d1.integrate=function(){function b(b){function h(b,c){var d,e;return function(f){var h=f.append("g");d=f.append("path").attr("class","line").datum(b);var j=f.append("g").attr("class","integration-text"),l=j.append("rect");e=j.append("text").datum(c).text((c/i).toFixed(2)).on("focus",function(){}).on("blur",function(){});var m=e.node().getBBox();e.attr("dx",-m.width/2).attr("dy",m.height/2),l.attr("width",m.width+4).attr("height",m.height+4).attr("x",m.x-2).attr("y",m.y-2);var n=a("./src/modals");j.on("mouseenter",function(){l.classed("highlight",!0),d.classed("highlight",!0)}).on("mouseleave",function(){l.classed("highlight",!1),d.classed("highlight",!1)}).on("contextmenu",d3.contextMenu([{title:"Set integral",action:n.input("Set Integral to: ",e.text(),function(a){i=e.datum()/a,g.integ_refactor()})}])),h.on("_redraw",function(){d.attr("d",k);var a=d.node().getPointAtLength(.5*d.node().getTotalLength());j.attr("transform","translate("+a.x+","+a.y+")");var b=e.node().getBBox();l.attr("width",b.width+2).attr("height",b.height+2).attr("x",b.x-1).attr("y",b.y-1)}).on("_refactor",function(){e.text((c/i).toFixed(2));var a=e.node().getBBox();e.attr("dx",-a.width/2),h.on("_redraw")()});var o=++g.idx;g.on("redraw.integ."+o,h.on("_redraw")),g.on("integ_refactor."+o,h.on("_refactor"))}}var i,j=(b.attr("width"),b.attr("height"),20),k=d3.svg.line().x(function(a){return e(a.x)}).y(function(a){return f(a.y/j)-f.range()[0]/2});return d=b.append("g").attr("class","integration"),d.node().addIntegral=function(a){var b=c(a),e=b[b.length-1].y;i||(i=e),d.call(h(b,e))},d}function c(a){var b=a.map(function(a){return a.y}).cumsum(),c=a.map(function(a,c){return{x:a.x,y:b[c]}});return c}var d,e,f,g;return b.dispatcher=function(a){return arguments.length?(g=a,b):g},b.xScale=function(a){return arguments.length?(e=a,b):e},b.yScale=function(a){return arguments.length?(f=a,b):f},b},b.d1.line=function(){function c(a){var c,m,n,o=[],p=1,q=d3.svg.line().interpolate("linear").x(function(a){return e(a.x)}).y(function(a){return f(a.y*p)}),r=a.attr("width");i=a.append("g").attr("class","spec-line"),i.attr("clip-path","url(#"+i.selectP(".spec-slide").node().clip_id+")"),i.node().range=j;var s=a.node().nSpecs;i.node().line_idx=s;var t=i.append("path").datum(d).attr("class","line clr"+s);k&&(c=b.d1.crosshair().datum(d).xScale(e).yScale(f).dispatcher(h)(i));var u=b.d1.integrate().xScale(e).yScale(f).dispatcher(h)(i);i.on("_redraw",function(b){if(b.x)t.attr("d",q).attr("transform","scale(1,1)translate(0,0)"),i.selectAll(".segment").attr("d",q);else{var c=(e.copy().domain(a.node().range.x),f.copy().domain(a.node().range.y)),d=[0,-Math.min(c(f.domain()[1]),c(f.domain()[0]))],g=[1,Math.abs((a.node().range.y[0]-a.node().range.y[1])/(f.domain()[0]-f.domain()[1]))];t.attr("transform","scale("+g+")translate("+d+")"),i.selectAll(".segment").attr("transform","scale("+g+")translate("+d+")")}}).on("_regionchange",function(a){if(a.xdomain){var b=l.sliceDataIdx(d,e.domain(),j.x);n=b,m=l.simplify(d.slice(n.start,n.end),e.domain(),r),t.datum(m),j.y=d3.extent(m.map(function(a){return a.y})),j.y[0]*=p,j.y[1]*=p,i.selectAll(".segment").remove(),o.forEach(function(a){var b=m.filter(function(b){return b.x<a[0]&&b.x>a[1]});i.append("path").datum(b).attr("class","segment")}),k&&c.node().dataSlice([n.start,n.end])}}).on("_integrate",function(a){var b=l.sliceData(d,a.xdomain,j.x);u.node().addIntegral(b),i.node().addSegment([b[0].x,b[b.length-1].x]),h.redraw({y:!0})}).on("_segment",function(a){});var v=++h.idx;return h.on("regionchange.line."+v,i.on("_regionchange")),h.on("redraw.line."+v,i.on("_redraw")),h.on("integrate.line."+v,i.on("_integrate")),i.node().specData=function(){return d},i.node().setData=function(a){d=a[0].x?a:a.map(function(a,b){return{x:d[b].x,y:a}}),j.y=d3.extent(d.map(function(a){return a.y})),c&&c.node().setData(d),i.on("_regionchange")({xdomain:e.domain()}),i.on("_redraw")({x:!0})},i.node().dataSlice=function(){return n},i.node().specRange=function(){return j},i.node().s_id=function(a){return arguments.length?void(g=a):g},i.node().setScaleFactor=function(a){return arguments.length?(p=a,void i.on("_redraw")({y:!0})):p},i.node().addPeaks=function(b){a.select(".peaks").node().addpeaks(d.subset(b),s),a.select(".peaks").on("_regionchange")({xdomain:!0}),a.select(".peaks").on("_redraw")({x:!0})},i.node().addSegment=function(a){if(a[0].constructor===Array)for(var b=a.length-1;b>=0;b--)this.addSegment(a[b]);else{o.push(a);var c=m.filter(function(b){return b.x<=a[0]&&b.x>=a[1]});i.append("path").datum(c).attr("class","segment").attr("d",q)}},i.node().addSegmentByIndex=function(a){if(a[0].constructor===Array)for(var b=a.length-1;b>=0;b--)this.addSegmentByIndex(a[b]);else this.addSegment([d[a[0]].x,d[a[1]].x])},i.node().remove=function(){h.on("regionchange.line."+v,null),h.on("redraw.line."+v,null),h.on("integrate.line."+v,null),d=null,k&&c.node().remove(),i.remove()},i}var d,e,f,g,h,i,j={},k=!0,l=a("./src/utils");return c.datum=function(a){if(!arguments.length)return d;if(a[0].x)d=a;else{var b=d3.scale.linear().range(svg.node().range.x).domain([0,a.length]);d=a.map(function(a,c){return{x:b(c),y:a}})}return j.x=[d[0].x,d[d.length-1].x],j.y=d3.extent(d.map(function(a){return a.y})),c},c.dispatcher=function(a){return arguments.length?(h=a,c):h},c.crosshair=function(a){return arguments.length?(k=a,c):k},c.s_id=function(a){return arguments.length?(g=a,c):g},c.xScale=function(a){return arguments.length?(e=a,c):e},c.yScale=function(a){return arguments.length?(f=a,c):f},c},b.d1.mainBrush=function(){function a(a){function f(){if(l.empty())return c&&d?l.extent([[0,0],[0,0]]):l.extent([0,0]),b.call(l),null;var a={};return c&&d?(a.xdomain=[l.extent()[1][0],l.extent()[0][0]],a.ydomain=[l.extent()[1][1],l.extent()[0][1]]):(a.xdomain=c?l.extent().reverse():null,a.ydomain=d?l.extent():null),l.clear(),b.call(l),a}function g(){var b=f();b&&a.on("_regionchange")(b)}function h(){var a=f();a&&e.peakdel(a)}function i(){var a=f();a&&e.integrate(a)}function j(){l.clear(),b.call(l)}var k=(a.attr("width"),a.attr("height")),l=d3.svg.brush().x(c).y(d).on("brushend",g);b=a.append("g").attr("class","main-brush").call(l),b.selectAll("rect").attr("height",k),b.select(".background").style("cursor",null).style("pointer-events","all"),b.node().peakpickEnable=function(c){b.classed("peakpick-brush",c),a.classed("peakpick-brush",c),l.on("brushend",c?j:g)},b.node().peakdelEnable=function(c){b.classed("peakdel-brush",c),a.classed("peakdel-brush",c),l.on("brushend",c?h:g)},b.node().integrateEnable=function(c){b.classed("integrate-brush",c),a.classed("integrate-brush",c),l.on("brushend",c?i:g)};var m=++e.idx;return e.on("peakpickEnable.brush."+m,b.node().peakpickEnable),e.on("peakdelEnable.brush."+m,b.node().peakdelEnable),e.on("integrateEnable.brush."+m,b.node().integrateEnable),b}var b,c,d,e;return a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},b.d1.scaleBrush=function(){function a(a){var i=e?e:f;h=e?e.copy():f.copy(),d=e?"bottom":"top";var j=d3.svg.axis().scale(h).orient(d).tickFormat(d3.format("s")),k=d3.svg.brush().x(h).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brushend",function(){var b=k.empty()?h.domain():k.extent().reverse();b=b.sort(h.domain()[0]>h.domain()[1]?d3.descending:d3.ascending),a.select(".main-focus").on("_regionchange")(e?{xdomain:b}:{ydomain:b})});c=a.append("g").attr("class",(e?"x":"y")+" scale-brush").attr("transform",e?"translate(0,-20)":"translate(-20,0)rotate(90)"),c.append("g").call(j).attr("class","brush-axis"),c.append("g").attr("class","brush").call(k).selectAll("rect").attr("y",-5).attr("height",10),c.select(".background").style("pointer-events","all"),c.on("_rangechange",function(a){(a.x||a.y&&f)&&(h.domain(e?a.x:a.y),c.select(".brush-axis").call(j),c.select(".brush").call(k))}).on("_regionchange",function(a){if(a.xdomain||a.ydomain&&f){var c=b(i.domain(),h.domain());k.extent(c)}}).on("_redraw",function(a){(a.x||a.y&&f)&&c.select(".brush").call(k)});var l=++g.idx;return g.on("rangechange.scalebrush."+l,c.on("_rangechange")),g.on("regionchange.scalebrush."+l,c.on("_regionchange")),g.on("redraw.scalebrush."+l,c.on("_redraw")),c}function b(a,b){var c=[0,0];return a[0]>a[1]?(c[0]=Math.min(a[0],b[0]),c[1]=Math.max(a[1],b[1])):(c[0]=Math.max(a[0],b[0]),c[1]=Math.min(a[1],b[1])),c.join()==b.join()&&(c=[0,0]),c}var c,d,e,f,g,h;return a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.xScale=function(b){return arguments.length?(e=b,a):e},a.yScale=function(b){return arguments.length?(f=b,a):f},a},b.d1.pp=function(){function b(b){var h=[{title:" Delete peak",action:function(a,b,c){g.peakdel({xdomain:[b[0],b[0]]})}}],i=(b.attr("width"),b.attr("height"),[]),j=[];d=b.append("g").attr("class","peaks"),d.on("_click",function(c){a("./src/events").crosshair||d3.selectAll(".crosshair").each(function(){d3.select(this).on("_mousemove")(c)}),b.selectAll(".crosshair").each(function(){d.node().addpeaks(this.__data__,this.parentNode.line_idx),d.on("_regionchange")({xdomain:!0}),d.on("_redraw")({x:!0,y:!0})})}).on("_regionchange",function(a){if(a.xdomain){var b=e.domain().sort(d3.descending);j=i.filter(function(a){return a[0]<b[0]&&a[0]>b[1]})}}).on("_redraw",function(a){var b=d.selectAll("text").data(j);b.enter().append("text").text(function(a){return d3.round(a[0],3)}).attr("dy","0.35em").attr("focusable",!0).on("focus",function(){}).on("keydown",function(a){68===d3.event.keyCode&&g.peakdel({xdomain:[a[0],a[0]]})}).on("contextmenu",d3.contextMenu(h)),b.exit().remove();var f=d.selectAll(".peak-line").data(j);if(f.enter().append("path").style("fill","none"),f.exit().remove(),0!==j.length){var i,k=[],l=d.select("text").node().getBBox().height;d.selectAll("text").sort(function(a,b){return d3.ascending(a[0],b[0])}).text(function(a){return d3.round(a[0],3)}).attr("class",function(a){return"peak-text clr"+a[2]}).attr("transform",function(a,b){var c=e(a[0]);return c>i-l&&(c=i-l),i=c,k.push(c),"translate("+c+",0)rotate(90)"}).append("title").text("dbl Click to edit"),d.selectAll("path").sort(function(a,b){return d3.ascending(a[0],b[0])}).attr("class",function(a){return"peak-line clr"+a[2]}).attr("d",function(a,b){return c(a[0],a[1],k[b])})}}).on("_peakpick",function(a,b){this.addPeaks(a,b),d.on("_regionchange")({xdomain:!0}),d.on("_redraw")({x:!0,y:!0})}).on("_peakdel",function(a){if(a.xdomain){var b=a.xdomain.sort(d3.descending);i=i.filter(function(a){return!(a[0]<=b[0]&&a[0]>=b[1])})}if(a.ydomain){var b=a.ydomain.sort(d3.descending);i=i.filter(function(a){return!(a[0]<=b[0]&&a[0]>=b[1])})}d.on("_regionchange")({xdomain:e.domain(),ydomain:f.domain()}),d.on("_redraw")({x:!0,y:!0})});var k=++g.idx;return g.on("regionchange.peaks."+k,d.on("_regionchange")),g.on("redraw.peaks."+k,d.on("_redraw")),g.on("peakpickEnable.peaks."+k,function(a){g.on("click.peaks."+k,a?d.on("_click"):null)}),g.on("peakpick.peaks."+k,d.on("_peakpick")),g.on("peakdel.peaks."+k,d.on("_peakdel")),d.node().peaks=function(){return i},d.node().addpeaks=function(a,b){if(a.x)-1==i.indexOf([a.x,a.y])&&i.push([a.x,a.y,b]);else for(var c=a.length-1;c>=0;c--)this.addpeaks(a[c],b)},d}function c(a,b,c){var d=Math.max(f(b)-10,60);return d3.svg.line().defined(function(a){return!isNaN(a[1])})([[c,40],[e(a),60],[e(a),80],[NaN,NaN],[e(a),d-10],[e(a),d]])}var d,e,f,g;return b.dispatcher=function(a){return arguments.length?(g=a,b):g},b.xScale=function(a){return arguments.length?(e=a,b):e},b.yScale=function(a){return arguments.length?(f=a,b):f},b},b.d1.main_focus=function(){function a(a){c=a.append("g").attr("class","main-focus").attr("pointer-events","all").attr("width",d).attr("height",e).call(k).on("dblclick.zoom",null).on("mousedown.zoom",null),c.node().dispatch_idx=0,c.node().nSpecs=0,c.node().xScale=f,c.node().yScale=g,c.node().range=j,c.node().addPeaks=function(a){c.select(".peaks").node().addpeaks(i.subset(a)),c.select(".peaks").on("_regionchange")({xdomain:!0}),c.select(".peaks").on("_redraw")({x:!0})},c.node().addSpecLine=function(a,d,e){d||(d=!0);var i=null,j="spec"+c.node().nSpecs;console.log(a.label),a.constructor!==Array&&("undefined"!=typeof a.s_id&&(i=a.s_id),"undefined"!=typeof a.label&&(j=a.label),a=a.data);var k;if(e&&0!=e.size()?(console.log("overwriting spec"),k=e,k.node().setData(a),i&&k.node().s_id(i)):(k=b.d1.line().datum(a).xScale(f).yScale(g).s_id(i).crosshair(d).dispatcher(h)(c),k.node().label=j),b.globals.render){var l=d3.max(c.selectAll(".spec-line")[0].map(function(a){return a.range.x[0]})),m=d3.min(c.selectAll(".spec-line")[0].map(function(a){return a.range.x[1]})),n=d3.min(c.selectAll(".spec-line")[0].map(function(a){return a.range.y[0]})),o=d3.max(c.selectAll(".spec-line")[0].map(function(a){return a.range.y[1]})),p=o-n;n-=.05*p,o+=.05*p;var q=f.domain();g.domain();c.on("_rangechange")({x:[l,m],y:[n,o],norender:c.node().nSpecs>0}),c.node().nSpecs>0&&c.on("_regionchange")({xdomain:q})}return c.node().nSpecs++,k},c.node().addSpec=c.node().addSpecLine,c.node().nd=1,c.node().getThreshold=function(a){c.call(b.d1.threshold().xScale(f).yScale(g).dispatcher(h).callback(a))},c.on("_redraw",function(a){h.redraw(a)}).on("_regionchange",function(a){if(a.xdomain&&f.domain(a.xdomain),h.regionchange({xdomain:a.xdomain}),a.ydomain)g.domain(a.ydomain),a.zoom||k.scale((j.y[0]-j.y[1])/(g.domain()[0]-g.domain()[1]));else{var b=d3.min(c.selectAll(".spec-line")[0].map(function(a){return a.range.y[0]})),d=d3.max(c.selectAll(".spec-line")[0].map(function(a){return a.range.y[1]})),e=d-b;b-=.05*e,d+=.05*e,j.y=[b,d],g.domain(j.y),h.rangechange({y:j.y}),k.scale(1)}h.regionchange({ydomain:g.domain()}),c.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(j.x=a.x),a.y&&(j.y=a.y),h.rangechange(a),a.norender||c.on("_regionchange")({xdomain:j.x,ydomain:j.y})}).on("mouseenter",h.mouseenter).on("mouseleave",h.mouseleave).on("mousemove",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.mousemove(b)}).on("mousedown",function(a){var b=new Event("mousedown");b.pageX=d3.event.pageX,b.clientX=d3.event.clientX,b.pageY=d3.event.pageY,b.clientY=d3.event.clientY,c.select(".main-brush").node().dispatchEvent(b)}).on("click",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.click(b)}).on("dblclick",h.regionfull),h.on("regionfull",function(){c.on("_regionchange")({xdomain:j.x})}),c.append("rect").attr("width",d).attr("height",e).style("fill","none"),c.call(b.d1.mainBrush().xScale(f).dispatcher(h)),c.node().addSpecLine(i),c.call(b.d1.pp().xScale(f).yScale(g).dispatcher(h))}var c,d,e,f,g,h,i,j={},k=d3.behavior.zoom().on("zoom",function(){var a=j.y[1]/k.scale()-j.y[0],b=(a-(g.domain()[1]-g.domain()[0]))/2,d=[];g.domain()[0]==j.y[0]?d[0]=j.y[0]:d[0]=Math.max(g.domain()[0]-b,j.y[0]),d[1]=d[0]+a,c.on("_regionchange")({zoom:!0,ydomain:d})});return a.datum=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(h=b,a):h},a.xScale=function(b){return arguments.length?(f=b,a):f},a.yScale=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a},b.d2={},b.d2.crosshair=function(){function a(a){var f=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),g=0;b=a.append("g").classed("crosshair clr"+g,!0).datum(null).call(f);var h=b.append("g").attr("class","crosshair line");h.append("path").attr("class","crosshair line x").attr("d",d3.svg.line()([[-c.range()[1],0],[c.range()[1],0]])),h.append("path").attr("class","crosshair line y").attr("d",d3.svg.line()([[0,-d.range()[0]],[0,d.range()[0]]]));var i=b.append("circle").attr("r",4.5);b.append("text").attr("x",9).attr("dy","-1em"),b.on("_regionchange",function(a){b.datum(null),b.attr("transform","translate(-10000,-10000)")}).on("_mousemove",function(a){var e=[c.invert(a.xcoor),d.invert(a.ycoor)];f.text(d3.round(e[0],3)+", "+d3.round(e[1],3)).show(i.node()),b.datum(e),b.attr("transform","translate("+a.xcoor+","+a.ycoor+")")}),b.node().show=function(a){return arguments.length?(b.style("display",a?null:"none"),a?f.show(b):f.hide(),void e.on("mousemove.line."+j,a?b.on("_mousemove"):null)):!("none"===b.style("display"))},b.node().enable=function(a){return arguments.length?(a?(e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)})):(e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null)),void b.node().show(a)):params.crosshair},b.node().remove=function(){e.on("regionchange.line."+j,null),e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null),e.on("mousemove.line."+j,null),e.on("crosshairEnable.line."+j,null),data=null,b.remove()};var j=++e.idx;return e.on("regionchange.line."+j,b.on("_regionchange")),e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)}),e.on("mousemove.line."+j,b.on("_mousemove")),e.on("crosshairEnable.line."+j,b.node().enable),b}var b,c,d,e;return a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},b.d2.main_focus=function(){function a(a){c=a.append("g").attr("class","main-focus").attr("pointer-events","all").attr("width",d).attr("height",e).call(k).on("dblclick.zoom",null).on("mousedown.zoom",null),c.node().dispatch_idx=0,c.node().nSpecs=0,c.node().xScale=f,c.node().yScale=g,c.node().range=j,c.node().addPeaks=function(a){c.select(".peaks").node().addpeaks(i.subset(a)),c.select(".peaks").on("_regionchange")({xdomain:!0}),c.select(".peaks").on("_redraw")({x:!0})},c.node().addSpec=function(a,d,e){arguments.length<2&&(d=!0);var i;e&&console.log("overwrite size:",e.size()),e&&0!=e.size()?(console.log("overwriting spec"),i=e,i.node().setData(a.data),a.s_id&&i.node().s_id(a.s_id)):i=b.d2.spec2d().datum(a.data).xScale(f).yScale(g).s_id(a.s_id).range({x:a.x_domain,y:a.y_domain}).crosshair(d).dispatcher(h)(c);var j=f.domain(),k=g.domain();return console.log("domains: ",a.x_domain,a.y_domain),c.on("_rangechange")({x:a.x_domain,y:a.y_domain,norender:c.node().nSpecs>0}),c.node().nSpecs>0&&c.on("_regionchange")({xdomain:j,ydomain:k}),c.node().nSpecs++,i},c.node().addSpecLine=c.node().addSpec,c.node().nd=2,c.node().getThreshold=function(a){c.call(b.d1.threshold().xScale(f).yScale(g).dispatcher(h).callback(a))},c.on("_redraw",function(a){h.redraw(a)}).on("_regionchange",function(a){a.xdomain&&f.domain(a.xdomain),a.ydomain&&g.domain(a.ydomain),h.regionchange({xdomain:a.xdomain,ydomain:g.domain()}),c.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(j.x=a.x),a.y&&(j.y=a.y),h.rangechange(a),a.norender||c.on("_regionchange")({xdomain:j.x,ydomain:j.y})}).on("mouseenter",h.mouseenter).on("mouseleave",h.mouseleave).on("mousemove",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.mousemove(b)}).on("mousedown",function(a){var b=new Event("mousedown");b.pageX=d3.event.pageX,b.clientX=d3.event.clientX,b.pageY=d3.event.pageY,b.clientY=d3.event.clientY,c.select(".main-brush").node().dispatchEvent(b)}).on("click",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.click(b)}).on("dblclick",h.regionfull),h.on("regionfull",function(){c.on("_regionchange")({xdomain:j.x,ydomain:j.y})}),c.node().addSpec(i),c.call(b.d1.mainBrush().xScale(f).yScale(g).dispatcher(h))}var c,d,e,f,g,h,i,j={},k=d3.behavior.zoom().on("zoom",function(){d3.select("#rfunc").attr("slope",k.scale()),d3.select("#bfunc").attr("slope",k.scale())}).scaleExtent([.1,100]);return a.datum=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(h=b,a):h},a.xScale=function(b){return arguments.length?(f=b,a):f},a.yScale=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a},b.d2.spec2d=function(){function a(a){var k,l=a.attr("width"),m=a.attr("height");h=a.append("g").attr("class","spec-img"),h.attr("clip-path","url(#"+h.selectP(".spec-slide").node().clip_id+")");var n=h.append("g").attr("filter","url(#2dColorFilter)").append("svg:image").attr("width",l).attr("height",m).attr("xlink:href","data:image/ png;base64,"+c).attr("preserveAspectRatio","none");
h.node().range=i,j&&(k=b.d2.crosshair().xScale(d).yScale(e).dispatcher(g)(h)),h.on("_redraw",function(a){console.log("scale & range: ",d,i.x);var b=d.copy().domain(i.x),c=e.copy().domain(i.y),f=[-Math.min(b(d.domain()[1]),b(d.domain()[0])),-Math.min(c(e.domain()[1]),c(e.domain()[0]))],g=[Math.abs((i.x[0]-i.x[1])/(d.domain()[0]-d.domain()[1])),Math.abs((i.y[0]-i.y[1])/(e.domain()[0]-e.domain()[1]))];n.attr("transform","scale("+g+")translate("+f+")")}).on("_regionchange",function(a){}).on("_integrate",function(a){}).on("_segment",function(a){});var o=++g.idx;return g.on("regionchange.line."+o,h.on("_regionchange")),g.on("redraw.line."+o,h.on("_redraw")),h.node().specData=function(){return c},h.node().setData=function(a){c=a,n.attr("xlink:href","data:image/ png;base64,"+c),h.on("_redraw")()},h.node().specRange=function(){return i},h.node().s_id=function(){return f},h.node().remove=function(){g.on("regionchange.line."+o,null),g.on("redraw.line."+o,null),c=null,h.remove()},h}var c,d,e,f,g,h,i={},j=!0;return a.datum=function(b){return arguments.length?(c=b,a):c},a.range=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.crosshair=function(b){return arguments.length?(j=b,a):j},a.s_id=function(b){return arguments.length?(f=b,a):f},a.xScale=function(b){return arguments.length?(d=b,a):d},a.yScale=function(b){return arguments.length?(e=b,a):e},a},b.app=function(){function c(h){if("undefined"==typeof e||"undefined"==typeof f||isNaN(e)||isNaN(f)){var i=h.node(),j=i.clientWidth?[i.clientWidth,i.clientHeight]:[i.getBoundingClientRect().width,i.getBoundingClientRect().height];e=j[0]-50,f=j[1]}if(400>e||400>f)throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px");var k=d3.dispatch("slideChange","slideContentChange","menuUpdate");d=h.append("div").classed("spec-app",!0).attr({width:e,height:f}),d.node().dispatcher=k,d.modals=a("./src/modals")(d),d.call(a("./src/menu/menu")()),a("./src/events").registerKeyboard(d.node()),d.node().appendSlide=function(a){d.selectAll(".spec-slide").classed("active",!1),d.call(b.slide().datum(a).width(e).height(f)),k.slideChange()},d.node().appendToCurrentSlide=function(a){var b=d.select(".spec-slide.active").node();b?(b.addSpec(a),k.slideContentChange()):d.node().appendSlide(a)},d.node().options=c.options,k.on("slideChange.app",function(){d.node().slideDispatcher=d.select(".spec-slide.active").node().slideDispatcher});for(var l=0;l<g.length;l++)d.node().appendSlide(g[l].slide)}var d,e,f,g=[];return c.appendSlide=function(a){if(!arguments.length)throw new Error("appendSlide: No data provided.");return d?d.node().appendSlide(a):g.push({slide:a}),c},c.appendToCurrentSlide=function(a){if(!arguments.length)throw new Error("appendToCurrentSlide: No data provided.");if(!d){if(0===g.length)return c.appendSlide(a);var b=g[g.length-1].slide;return b.push(a),c}d.node().appendToCurrentSlide(a)},c.width=function(a){return arguments.length?(e=a,c):e},c.height=function(a){return arguments.length?(f=a,c):f},c.options={grid:{x:!1,y:!1}},c},b.slide=function(){function c(c){if(!d)return void create_empty_slide();var g=20,h={top:10+g,right:40,bottom:40,left:10+g},i=e-h.left-h.right,j=f-h.top-h.bottom,k=d3.scale.linear().range([0,i]),l=d3.scale.linear().range([j,0]),m=d3.svg.axis().scale(k).orient("bottom"),n=d3.svg.axis().scale(l).orient("right").tickFormat(d3.format("s")),o=d3.svg.axis().scale(k).orient("bottom").innerTickSize(j).tickFormat(""),p=d3.svg.axis().scale(l).orient("right").innerTickSize(i).tickFormat(""),q=d.nd&&2===d.nd,r=d3.dispatch("rangechange","regionchange","regionfull","redraw","mouseenter","mouseleave","mousemove","click","keyboard","peakpickEnable","peakdelEnable","peakpick","peakdel","integrateEnable","integrate","integ_refactor","crosshairEnable","blindregion","log");r.idx=0;var s=c.append("svg").attr({width:e,height:f}).classed("spec-slide",!0).classed("active",!0),t=s.append("g").attr("transform","translate("+h.left+","+h.top+")");s.node().clip_id=a("./src/utils").guid();var u=s.append("defs");if(u.append("clipPath").attr("id",s.node().clip_id).append("rect").attr("width",i).attr("height",j),q){var v=u.append("filter").attr("id","2dColorFilter");v.append("feColorMatrix").attr("type","matrix").attr("values","1 0 0 0 0	0 0 0 0 0 1 0 0 0 0 0 0 0 1 0");var w=v.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");w.append("feFuncR").attr("type","linear").attr("slope","-1").attr("intercept","0.5"),w.append("feFuncB").attr("type","linear").attr("slope","1").attr("intercept","-0.5");var w=v.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");w.append("feFuncR").attr("id","rfunc").attr("type","linear").attr("slope","1"),w.append("feFuncB").attr("id","bfunc").attr("type","linear").attr("slope","1"),v.append("feColorMatrix").attr("type","matrix").attr("values","-10 0 0 0 1 -10 0 -10 0 1 0 0 -10 0 1 0 0 0 1 0")}t.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")"),t.append("g").attr("class","y axis").attr("transform","translate("+i+",0)"),t.append("g").classed("x grid",!0),t.append("g").classed("y grid",!0),t.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",i/2).attr("y",j).attr("dy","2.8em").text("Chemical shift (ppm)"),t.append("text").attr("class","y label").attr("text-anchor","end").attr("y",i).attr("dy","-.75em").attr("transform","rotate(-90)").text("Intensity"),r.on("redraw.slide",function(a){a.x&&(t.select(".x.axis").call(m),c.node().options.grid.x&&t.select(".x.grid").call(o)),a.y&&(t.select(".y.axis").call(n),c.node().options.grid.y&&t.select(".y.grid").call(p))});var x=q?b.d2.main_focus:b.d1.main_focus;t.call(x().datum(d).xScale(k).yScale(l).width(i).height(j).dispatcher(r)),t.call(b.d1.scaleBrush().xScale(k).dispatcher(r)),t.call(b.d1.scaleBrush().yScale(l).dispatcher(r)),s.node().nd=q?2:1,s.node().addSpec=function(a){t.select(".main-focus").node().addSpec(a)},s.node().slideDispatcher=r}var d,e,f;return c.datum=function(a){return arguments.length?(d=a,c):d},c.width=function(a){return arguments.length?(e=a,c):e},c.height=function(a){return arguments.length?(f=a,c):f},c},b.slideChanger=function(){function a(a){var b;if(0===a.select(".slide-changer").size()){var c=a.append("g").attr("class","slide-changer"),d=a.attr("width"),e=a.attr("height"),f=c.append("svg:foreignObject").attr("width",d).attr("height",e).style("pointer-events","all").append("xhtml:div").classed("slideout",!0).on("click",function(){f.toggleClass("active")});f.append("xhtml:p").text("Slides"),b=f.append("xhtml:div").classed("slideout_inner",!0).text("Switch Slide")}else b=a.select(".slideout_inner");var g=a.selectAll(".spec-slide");b.selectAll("div").data(g[0]).enter().append("xhtml:div").text(function(a,b){return"slide "+(b+1)}),b.selectAll("div").on("click",function(b){g.classed("active",!1),d3.select(b).classed("active",!0),a.node().dispatcher=b.slideDispatcher})}return a},c.read_menu=function(b,d){var e=c.plugins(b.node()),f=function(a,b){console.log(a,b);for(var c=a.length-1;c>=0;c--)if(a[c].label==b)return a[c].children||(a[c].children=[]),a[c];return a.push({label:b,children:[]}),a[a.length-1]},g=function(a){return a.args?function(){b.modals.methods(a.fun,a.args,a.title)()}:function(){e.request(a.fun)}},h=a("./src/pro/ajax");h.getJSON("/nmr/test",function(a){console.log(d);for(var c=a,e=0;e<a.length;e++){for(var h=f(d,c[e].menu_path[0]),i=1;i<c[e].menu_path.length;i++)h=f(h.children,c[e].menu_path[i]);h.children=null,h.fun=g(c[e]),h.nd=c[e].nd}console.log(d),b.node().dispatcher.menuUpdate()})},c.output={},c.output.overwriteSpec=function(a,b){"undefined"==typeof b&&"undefined"!=typeof a.s_id&&(b=a.s_id);var c=d3.select(".spec-slide.active").select(".main-focus"),d=1==c.node().nd?".spec-line":".spec-img",e=c.selectAll(d).filter(function(a){return this.s_id()==b});c.node().addSpecLine(a,!0,e)},c.output.preview=function(a){d3.select(".preview-spec").size()>0?d3.select(".preview-spec").node().setData(a):d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a,!1).classed("preview-spec",!0)},c.output.newSpec=function(a){d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a)},c.output.newSlide=function(a){},c.analysis={},c.analysis.addPeaks=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(console.log(f),1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addPeaks(b.peaks)},c.analysis.addSegments=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addSegmentByIndex(b.segs)},c.plugins=function(b){var d={},e=function(){var a=d3.select(b).select(".spec-slide.active").select(".main-focus"),c=1==a.node().nd?".spec-line":".spec-img",d=a.selectAll(c+".selected")[0].map(function(a){return a.s_id()});return 0==d.length&&(d=a.selectAll(c)[0].map(function(a){return a.s_id()})),d},f=function(b,d){var e=b.output?c.output[b.output]:c.output.overwriteSpec;a("./src/pro/process_data").process_spectrum(b,e)},g=function(a,b){void 0!==a.peaks&&c.analysis.addPeaks(a),void 0!==a.segs&&c.analysis.addSegments(a)};return d.request=function(b,c,f,g){c||(c={}),c.sid||(f?c.sid=f:c.sid=e()),0===c.sid.length&&error("No Spectra selected","Please select one or more spectra!");var h=b+"_",i="sid="+JSON.stringify(c.sid)+"&preview="+ +g+"&"+h+"=null";for(var j in c)"sid"!==j&&(i.length>0&&(i+="&"),i+=h+j+"="+c[j]);var k="/nmr/plugins?"+i,l=a("./src/pro/ajax");l.getJSON(k,function(a){d.response(a,g)})},d.response=function(a,b){if(a.constructor!==Array)return void 0===a.data_type||"spectrum"===a.data_type?f(a,b):"spec_feature"===a.data_type?void g(a,b):"spec_like"===a.data_type?void handle_spec_like(a,b):void 0;for(var c=a.length-1;c>=0;c--)d.response(a[c])},d},c.get_spectrum=a("./src/pro/process_data").get_spectrum,window.spec=b,window.pro=c,console.log("specdraw:"+b.version)}()},{"./src/events":4,"./src/menu/menu":7,"./src/modals":11,"./src/pro/ajax":12,"./src/pro/process_data":13,"./src/utils":15}],4:[function(a,b,c){var d={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1,zoom:["x","y",!1]};d.crosshairToggle=function(a){d.crosshair=!d.crosshair,a.slideDispatcher.crosshairEnable(d.crosshair)},d.peakpickToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),console.log(d.zoom),d.peakpick=!d.peakpick,a.slideDispatcher.peakpickEnable(d.peakpick)},d.peakdelToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.peakdel=!d.peakdel,a.slideDispatcher.peakdelEnable(d.peakdel)},d.integrateToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate=!d.integrate,a.slideDispatcher.integrateEnable(d.integrate)},d.zoomToggle=function(a){d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.zoom.rotate(),console.log(d.zoom)};d.registerKeyboard=function(a){console.log(a),d3.select("body").on("keydown",function(){a.slideDispatcher.log("keyCode: "+d3.event.keyCode),80===d3.event.keyCode?d.peakpickToggle(a):68===d3.event.keyCode?d.peakdelToggle(a):73===d3.event.keyCode?d.integrateToggle(a):67===d3.event.keyCode?d.crosshairToggle(a):70===d3.event.keyCode?dispatcher.regionfull(a):90===d3.event.keyCode&&d.zoomToggle(a),a.slideDispatcher.keyboard(d3.event)})},b.exports=d},{}],5:[function(a,b,c){var d={},e=a("./utils").fireEvent;d.num=function(a,b,c,d,e,f){var g=d3.select(document.createElement("label"));return g.classed("param num",!0).text(a).append("input").attr({type:"number",value:"undefined"==typeof b?0:b,min:"undefined"==typeof c?-(1/0):c,max:"undefined"==typeof d?1/0:d,step:"undefined"==typeof e?1:e}).text("undefined"==typeof f?"":f),g.node().getValue=function(){return g.select("input").node().value},function(){return g.node()}},d.checkbox=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param checkbox",!0).append("input").attr("type","checkbox").on("change",function(){e(this,"input")}).node().checked=b?!0:!1,c.append("div").classed("checker",!0),c.append("div").classed("label",!0).text(a),c.node().getValue=function(){return c.select("input").node().checked},function(){return c.node()}},d.checkbox_toggle=function(a,b,c){var f=d3.select(document.createElement("div")).classed("param checkbox-toggle",!0);return f.append(d.checkbox(a,b)).select("input").on("change",function(){f.select(".div_enable").classed("disabled",!this.checked),e(this,"input")}),f.append(d.div(c)).classed("div_enable",!0).classed("disabled",!f.select("input").node().checked),f.node().getValue=f.select(".param.checkbox").node().getValue,function(){return f.node()}},d.select=function(a,b,c){var d=d3.select(document.createElement("label")).classed("param select",!0).text(a),e=d.append("select");return e.selectAll("option").data(b).enter().append("option").text(function(a){return a}),e.node().value=c,d.node().getValue=function(){return e.node().value},function(){return d.node()}},d.select_multi=function(a,b){var c=d3.select(document.createElement("div")).classed("param select-multi",!0);return c.append("label").text(a).append("input").attr("type","checkbox").style("display","none").on("change",function(){c.select("ul").classed("shown",this.checked)}).node().checked=!1,c.append("ul").classed("block-list",!0).selectAll("li").data(b).enter().append("li").each(function(a){d3.select(this).append(d.checkbox(a,!0))}),c.node().getValue=function(){return c.selectAll(".param.checkbox").filter(function(){return this.children[0].checked})[0].map(function(a){return"undefined"!=typeof a.value?a.value:d3.select(a).select(".label").text()})},function(){return c.node()}},d.select_toggle=function(a,b){console.log(a,b);var c=d3.select(document.createElement("div")).classed("param select-toggle",!0);c.append(d.select(a,Object.keys(b))).selectAll("option").attr("value",function(a){return a}).text(function(a){return b[a][0]});var f=c.append("div").classed("method_params",!0),g=c.select("select").node();return c.select("select").on("input",function(){d3.event.stopPropagation()}).on("change",function(){f.select("fieldset").remove(),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),e(this.parentNode,"input")}),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),c.node().getValue=function(){return g.value},function(){return c.node()}},d.button=function(a){var b=d3.select(document.createElement("input")).classed("param btn",!0).attr("type","button").attr("value",a).on("click",function(){e(this,"input")});return b.node().getValue=function(){return d3.event&&d3.event.target===b.node()},function(){return b.node()}},d.threshold=function(a){var b=d3.select(document.createElement("div")).classed("param threshold",!0),c=b.append("input").attr("type","hidden"),e=b.append("input").attr("type","text").attr("readonly","readonly");return b.insert(d.button(a),":last-child").on("click",function(){var a=d3.selectAll(".nanoModalOverride:not([style*='display: none'])").style("display","none");d3.select(".spec-slide.active").select(".main-focus").node().getThreshold(function(b){e.attr("value",b.toExponential(2)),c.attr("value",b),a.style("display","block")})}),b.node().getValue=function(){return c.node().value},function(){return b.node()}},d.div=function(a){var b=d3.select(document.createElement("div"));for(var c in a){var d=a[c];"function"!=typeof d&&(b.append(f.apply(null,d)).node().id=c)}return function(){return b.node()}};var f=function(a,b,c){var e=[d.num,d.checkbox,d.text,d.select_toggle,d.checkbox_toggle,d.button,d.threshold][b];return e.apply(null,[a].concat(c))};d.spectrumSelector=function(){var a=d3.select(".spec-slide.active").select(".main-focus").selectAll(".spec-line");if(0===a.size())return function(){return d3.select(document.createElement("div")).text("No Spectra to show").node()};var b=d3.select(d.select_multi("Select Spectrum",a[0])()).classed("spec-selector",!0);return b.selectAll("li").each(function(a){d3.select(this).select(".checkbox").style("color",getComputedStyle(a.childNodes[0]).stroke).select(".label").text(a.label),d3.select(this).on("mouseenter",function(){d3.select(a.parentNode).classed("dimmed",!0),d3.select(a).classed("highlighted",!0)}).on("mouseleave",function(){d3.select(a.parentNode).classed("dimmed",!1),d3.select(a).classed("highlighted",!1)})}),b.node().getValue=function(){return b.selectAll("li").filter(function(){return d3.select(this).select("input").node().checked===!0}).data().map(function(a){return a.s_id()})},b.node().id="sid",function(){return b.node()}},d.preview=function(a){var b={prev_auto:["Instant Preview",1,"undefined"!=typeof a],prev_btn:["Preview",5,null]};return d.div(b)},d.popover=function(a){var b=d3.select(document.createElement("div")).classed("popover right",!0);b.append("div").classed("arrow",!0);var c=b.append("div").classed("popover-inner",!0);return c.append("h3").classed("popover-title",!0).text(a),c.append("div").classed("popover-content",!0),function(){return b.node()}},b.exports=d},{"./utils":15}],6:[function(a,b,c){function d(a){return a.enter().append("li").text(function(a){return a.label}).classed("menu-item",!0).classed("not1d",function(a){return a.nd&&a.nd.indexOf(1)<0}).classed("not2d",function(a){return a.nd&&a.nd.indexOf(2)<0}),a}function e(a){var b=a.filter(function(a){return a.children}).classed("openable",!0).append("div").append("ul").selectAll("li").data(function(a){return a.children}).call(d);b.filter(function(a){return a.children}).size()>0&&e(b)}function f(a){function b(a){a.select(".menu-container").remove();var b=a.append(g.popover("Menu")).classed("menu-container",!0).select(".popover-content").append("div").classed("main-menu",!0).append("ul").classed("nav",!0);b.selectAll("li").data(c).call(d).call(e),b.selectAll("li").on("click",function(b){b.fun?(h.fireEvent(a.node(),"click"),b.fun()):this.focus()})}var c;return b.data=function(a){return arguments.length?(c=a,b):c},b}var g=a("../input_elem"),h=a("../utils");b.exports=f},{"../input_elem":5,"../utils":15}],7:[function(a,b,c){function d(){function b(a){if(d3.event.target===this){var b=d3.select(this).toggleClass("opened");b.select(".tooltip").style("display",b.classed("opened")?"none":null)}}function c(c){var d=a("./main_menu")(c),f=a("./spectra")(c),g=a("./slides")(c),h=a("./menu_data")(c),i=[["open-menu","Menu"],["open-spec-legend","Spectra"],["open-slides","Slides"],["open-settings","Settings"],["open-download","Download Spectra"],["open-fullscreen","Fullscreen App"],["connection-status","Connection Status"]],j=c.append("div").classed("column-menu",!0);j.selectAll("div").data(i).enter().append("div").attr("class",function(a){return a[0]}).attr("title",function(a){return a[1]}).call(bootstrap.tooltip().placement("right")).on("click",b),j.select(".open-menu").call(d.data(h));var k=c.node().dispatcher;return j.select(".open-fullscreen").on("click",function(a){e.fullScreen.toggle(c.node()),b.apply(this)}),d3.select(window).on("resize.fullscreenbutton",function(){j.select(".open-fullscreen").classed("opened",e.fullScreen.isFull())}),k.on("menuUpdate.menu",function(){j.select(".open-menu").call(d)}),k.on("slideChange.menu",function(){var a=2==c.select(".spec-slide.active").node().nd;j.select(".open-menu").classed("d1",!a).classed("d2",a),j.select(".open-spec-legend").call(f),j.select(".open-slides").call(g)}),k.on("slideContentChange.menu",function(){j.select(".open-spec-legend").call(f)}),pro.read_menu(c,h),j}return c}var e=a("../utils");b.exports=d},{"../utils":15,"./main_menu":6,"./menu_data":8,"./slides":9,"./spectra":10}],8:[function(a,b,c){function d(a){var b=a.modals;return[{label:"Processing"},{label:"Analysis",children:[{label:"Peak Picking",children:[{label:"Manual peak picking",fun:e.peakpickToggle},{label:"View/manage peak table",fun:null},{label:"Delete peaks",fun:e.peakdelToggle}]}]},{label:"View",children:[{label:"Change region",children:[{label:"Set X region",fun:b.xRegion},{label:"Set Y region",fun:b.yRegion},{label:"Full spectrum",fun:null,children:[{label:"Error",fun:function(){b.error("error message")}}]},{label:"Reverse Spectrum",fun:null},{label:"Invert Phases",fun:null}]}]},{label:"Integration",fun:e.integrateToggle},{label:"crosshair",fun:e.crosshairToggle},{label:"Selected",fun:function(){},children:[{label:"Scale",fun:b.scaleLine}]}]}var e=a("../events");b.exports=d},{"../events":4}],9:[function(a,b,c){function d(a){function b(b){b.select(".menu-container").remove();var c=a.selectAll(".spec-slide"),d=b.append(e.popover("Slides")).classed("menu-container",!0).select(".popover-content");return d.append("ul").classed("block-list slide-list",!0).selectAll("li").data(c[0]).enter().append("li").text(function(a,b){return"Slide "+(b+1)}).on("click",function(b){c.classed("active",!1),d3.select(b).classed("active",!0),a.node().dispatcher.slideChange()}),b}return b}var e=a("../input_elem");b.exports=d},{"../input_elem":5}],10:[function(a,b,c){function d(a){function b(a){a.select(".menu-container").remove();var b=a.append(e.popover("Spectra")).classed("menu-container",!0).select(".popover-content"),c=d3.select(e.spectrumSelector()()).select("ul");return 0===c.size()?b.append(e.spectrumSelector()):b.append(function(){return c.node()}).classed("block-list spec-list no-checkbox",!0),a}return b}var e=a("../input_elem");b.exports=d},{"../input_elem":5}],11:[function(a,b,c){function d(b){var c={};return c.proto=function(a,c,d,e){var f=nanoModal(c,{overlayClose:!1,autoRemove:!0,buttons:[{text:"OK",handler:d,primary:!0},{text:"Cancel",handler:e?e:"hide",classes:"cancelBtn"}]});if(!b)return void console.log("App is not defined. Initialize the modal module first.");b.append(function(){return f.overlay.el}),b.append(function(){return f.modal.el});var g=d3.select(f.modal.el);return g.insert("div",":first-child").classed("title",!0).text(a?a:"Dialogue"),g.on("keydown",function(){13===d3.event.keyCode&&d3.select(f.modal.el).select(".nanoModalBtnPrimary").node().click(),27===d3.event.keyCode&&d3.select(f.modal.el).select(".cancelBtn").node().click()}),f.onShow(function(){g.style({display:"flex","flex-direction":"column","margin-left":-g.node().clientWidth/2,"max-width":.8*g.node().parentNode.clientWidth,"max-height":.8*g.node().parentNode.clientHeight});var a=d3.behavior.drag().on("drag",function(){g.style("top",d3.event.sourceEvent.pageY+"px").style("left",d3.event.sourceEvent.pageX+"px")});d3.select(f.modal.el).select(".title").call(a),d3.select(f.modal.el).select(".cancelBtn").node().focus()}),f},c.error=function(a,b){var d=c.proto("Error: "+a,b);d3.select(d.modal.el).classed("errorModal",!0).select(".cancelBtn").text("Dismiss"),d.show()},c.range=function(a,b,d,e){var f;f=b[0]>b[1]?[b[1],b[0]]:b,f=[d3.round(f[0],3),d3.round(f[1],3)],"undefined"==typeof e?e=f:(e[0]>e[1]&&(e=[e[1],e[0]]),e=[d3.round(e[0],3),d3.round(e[1],3)]);var g=a+'<input type="number" id="range0" step="0.001" value='+e[0]+" min="+f[0]+" max="+f[1]+'> - <input type="number" id="range1" step="0.001" value='+e[1]+" min="+f[0]+" max="+f[1]+">",h=c.proto("Range",g,function(a){a.hide();var c=d3.select(a.modal.el).selectAll("input")[0].map(function(a){return+a.value});c[0]<f[0]||c[0]>f[1]||c[1]<f[0]||c[1]>f[1]||c[0]>c[1]?nanoModal("Invalid input."+c).show():d(b[0]>b[1]?c.reverse():c)});return h.show},c.input=function(a,b,d){var e=a+'<input type="number" id="input0" step="0.001" value='+b+">",f=c.proto("Numeric",e,function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;d(b)});return f.show},c.xRegion=function(){c.range("Set x region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.x,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({xdomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().xScale.domain())()},c.yRegion=function(){c.range("Set y region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.y,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({ydomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().yScale.domain())()},c.slider=function(a,b,d){var e=a+'<input id="slider" type="range" min="-5" max="5" value="0" step="0.001"/>',f=c.proto("Slider",e,function(a){a.hide()},function(a){d(0)});return d3.select(f.modal.el).select("#slider").on("input",function(){d(+this.value)}),f.show},c.scaleLine=function(){c.slider("Scale spectrum by a factor:",0,function(a){d3.select(".selected").node().setScaleFactor(Math.pow(2,a))})()},c.methods=function(d,e,f,g,h){var i,j=!0,k=pro.plugins(b.node()),l=function(b){j=!1,a("./utils").fireEvent(i.node(),"input"),b.hide()},m=c.proto(f,"",l);i=d3.select(m.modal.el).select(".nanoModalContent");var n=null;i.on("input",function(){var a={};i.selectAll(".param").filter(function(){return""!==this.id}).each(function(b){a[this.id]=this.getValue()}),n&&clearTimeout(n),j===!1||d3.event.target===i||a.prev_btn===!0?k.request(d,a,a.s_id,j):a.prev_auto===!0&&(n=setTimeout(function(){k.request(d,a,a.s_id,!0)},300))});var o=a("./input_elem");return i.append(o.spectrumSelector()),i.append(o.div(e)),i.append(o.preview(!0)),m.show},c}a("nanoModal"),nanoModal.customHide=function(a,b){b.modal.el.style.display="block",a()},b.exports=d},{"./input_elem":5,"./utils":15,nanoModal:1}],12:[function(a,b,c){var d=a("../modals"),e=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){var a=4,e=200;d.readyState===a&&d.status===e?"function"==typeof b&&b(d.responseText):d.readyState===a&&c(d.responseText)},d.send()},f=function(a,b,c){var f=g();e(a,function(a){f.stop();var c=JSON.parse(a);"undefined"==typeof c.error?b(c):d.error(c.error.name,c.error.message)},function(a){f.stop(),d.error("Network Error",a)}),c&&f()},g=function(){function a(){e("/nmr/test",function(b){c?ajax("/nmr/test?complete=1"):(d3.select(".progress").text(b),setTimeout(a,100))})}var b,c=!1,d=function(){a()};return d.stop=function(){clearInterval(b),c=!0,d3.select(".progress").text("Completed")},d};b.exports.request=e,b.exports.getJSON=f},{"../modals":11}],13:[function(a,b,c){function d(b,c){if(console.log("processing"),b.constructor!==Array)switch(b.format){case"xy":f(b,c);break;case"base64":g(b,c);break;case"png":case"png16":a("./worker").maxWorkers()>0?i(b,c):h(b,c)}else for(var e=b.length-1;e>=0;e--)d(b[e],c)}function e(b,c){var e=a("./ajax");e.getJSON(b,function(a){d(a,c)})}var f=function(a,b){var c=a.x.map(function(b,c){return{x:b,y:a.y[c]}});b(c)},g=function(a,b){var c=atob(a.y);console.log(c);var d=d3.scale.linear().range(a.x_domain).domain([0,c.length]),e=d3.scale.linear().range(a.y_domain).domain([0,255]),f=c.map(function(a,b){return{x:d(b),y:e(a)}});b(f)},h=function(a,b){if(a.nd&&1!=a.nd)2==a.nd?b(a):console.log("Unsupported data dimension: "+a.nd);else{var c=document.createElement("img");c.onload=function(){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var e=d.getContext("2d");e.drawImage(c,0,0);var f=e.getImageData(0,0,c.width,c.height).data,g=[],h="png16"==a.format,i=h?f.length/2:f.length,j=d3.scale.linear().range(a.y_domain).domain([0,255]);h&&j.domain([0,Math.pow(2,16)-1]);for(var k=0;i>k;k+=4)h?g.push(j((f[k+i]<<8)+f[k])):g.push(j(f[k]));if(a.x_domain){var l=d3.scale.linear().range(a.x_domain).domain([0,g.length]);g=g.map(function(a,b){return{x:l(b),y:a}})}var m;m="undefined"!=typeof a.s_id?{data:g,s_id:a.s_id}:{data:g},b(m)};var d=a.data?a.data:a.y;c.src="data:image/png;base64,"+d}},i=function(b,c){if(b.nd&&1!=b.nd)2==b.nd?c(b):console.log("Unsupported data dimension: "+b.nd);else{var d=document.createElement("img");d.onload=function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f={};f._16bit="png16"==b.format;var g=e.getContext("2d");g.drawImage(d,0,0),f.buffer=g.getImageData(0,0,d.width,d.height).data,f.y_range=b.y_domain,f.y_domain=[0,255],f._16bit&&(f.y_domain=[0,Math.pow(2,16)-1]);var h=function(a){console.log("worker done");var d=[].slice.call(a.data);if(b.x_domain){var e=d3.scale.linear().range(b.x_domain).domain([0,d.length]);d=d.map(function(a,b){return{x:e(b),y:a}})}b.data=d,c(b)},i=[f,[f.buffer.buffer]];a("./worker").addJob({message:i,callback:h})};var e=b.data?b.data:b.y;d.src="data:image/png;base64,"+e}};b.exports.get_spectrum=e,b.exports.process_spectrum=d},{"./ajax":12,"./worker":14}],14:[function(a,b,c){function d(){var a=function(){function a(a,b){var c=b[1]-b[0],d=a[1]-a[0];return function(e){return(e-b[0])/c*d+a[0]}}self.onmessage=function(b,c){b=b.data;for(var d=b.buffer,e=b._16bit?d.length/2:d.length,f=a(b.y_range,b.y_domain),g=new Float64Array(e/4),h=0;e>h;h+=4)b._16bit?g[h/4]=f((d[h+e]<<8)+d[h]):g[h/4]=f(d[h]);self.postMessage(g,[g.buffer])}},b=new Blob(["("+a.toString()+")()"],{type:"application/javascript"}),c=window.URL.createObjectURL(b),d=new Worker(c);return d}function e(a){var b=k.shift();b&&(a.hasJob=!0,a.onmessage=function(c){var d=b.callback;a.hasJob=!1,e(a),d(c)},a.postMessage(b.message[0],b.message[1]))}function f(a){k.push(a);var b=g();"undefined"!=typeof b&&e(b)}function g(){for(var a=0;a<i.length;a++)if(!i[a].hasJob)return i[a];if(i.length<j){var b=d();return i.push(b),b}return void 0}function h(a){return arguments.length?void(j=a):j}var i=[],j=(navigator.hardwareConcurrency||2)-1,k=[];b.exports.addJob=f,b.exports.maxWorkers=h},{}],15:[function(a,b,c){function d(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function e(a){d()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():h(a)}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}Array.prototype.subset=function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push(this[a[c]]);return b},Array.prototype.rotate=function(a){return a?this.push(this.shift()):this.unshift(this.pop()),this},Array.prototype.rotateTo=function(a){for(;this[0]!==a;)this.rotate();return this},Array.prototype.whichMax=function(){if(!this.length||0===this.length)return null;if(1===this.length)return 0;for(var a=this[0].y,b=0,c=1;c<this.length;c++)this[c].y>a&&(b=c,a=this[c].y);return b},Array.prototype.cumsum=function(){for(var a=[this[0]],b=0,c=this.length-1;c>b;b++)a[b+1]=a[b]+this[b+1];return a},d3.selection.prototype.selectP=function(a){for(var b=this.node().parentNode;b;){if(b.matches(a))return d3.select(b);b=b.parentNode}return null},d3.selection.prototype.toggleClass=function(a){return this.classed(a,!this.classed(a))},d3.selection.prototype.size=function(){var a=0;return this.each(function(){++a}),a};var g=function(a,b){if(document.createEventObject){var c=document.createEventObject();return a.fireEvent("on"+b,c)}var c=document.createEvent("HTMLEvents");return c.initEvent(b,!0,!0),!a.dispatchEvent(c)},h=function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},i=function(a,b,c){var d=a.length*(b[0]-b[1])/(c[0]-c[1]),e=a.length*(b[0]-c[0])/(c[1]-c[0]);return{start:e,end:e+d}},j=function(a,b,c){var d=i(a,b,c);return a.slice(d.start,d.end)},k=function(b,c,d){var e=a("simplify")(b,(c[0]-c[1])/d);
return e};b.exports.fireEvent=g,b.exports.fullScreen={},b.exports.fullScreen.launch=h,b.exports.fullScreen.toggle=e,b.exports.fullScreen.isFull=d,b.exports.guid=f,b.exports.simplify=k,b.exports.sliceData=j,b.exports.sliceDataIdx=i},{simplify:2}]},{},[3,12,11,4,15,14,13]);