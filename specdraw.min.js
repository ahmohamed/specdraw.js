!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a){function b(a){var b=d3.select(a).style("position");return"absolute"===b||"static"===b?{x:a.offsetLeft,y:a.offsetTop,w:a.offsetWidth,h:a.offsetHeight}:{x:0,y:0,w:a.offsetWidth,h:a.offsetHeight}}var c="object"==typeof a.bootstrap?a.bootstrap:a.bootstrap={};c.tooltip=function(){function a(){var a=d3.select(this),b=g.apply(this,arguments),e=a.append("div").attr("class","tooltip");b&&e.classed("fade",!0),e.append("div").attr("class","tooltip-arrow"),e.append("div").attr("class","tooltip-inner");var f=l.apply(this,arguments);e.classed(f,!0),a.on(j,c),a.on(k,d)}function c(){var a,c=d3.select(this),d=i.apply(this,arguments),e=c.select(".tooltip").classed("in",!0),f=h.apply(this,arguments),g=(e.select(".tooltip-inner")[f?"html":"text"](d),l.apply(this,arguments)),j=c.style("position"),k=b(c.node()),m=b(e.node());("absolute"===j||"relative"===j)&&(k.x=k.y=0);var a;switch(g){case"top":a={x:k.x+(k.w-m.w)/2,y:k.y-m.h};break;case"right":a={x:k.x+k.w,y:k.y+(k.h-m.h)/2};break;case"left":a={x:k.x-m.w,y:k.y+(k.h-m.h)/2};break;case"bottom":a={x:Math.max(0,k.x+(k.w-m.w)/2),y:k.y+k.h}}e.style(a?{left:~~a.x+"px",top:~~a.y+"px"}:{left:null,top:null}),this.tooltipVisible=!0}function d(){d3.select(this).select(".tooltip").classed("in",!1),this.tooltipVisible=!1}function e(){this.tooltipVisible?d.apply(this,arguments):c.apply(this,arguments)}var f=function(b){b.each(a)},g=d3.functor(!1),h=d3.functor(!1),i=function(){var a=this.getAttribute("data-original-title");return a?a:(a=this.getAttribute("title"),this.removeAttribute("title"),this.setAttribute("data-original-title",a),a)},j="mouseenter.tooltip",k="mouseleave.tooltip",l=("top left bottom right".split(" "),d3.functor("top"));return f.title=function(a){return arguments.length?(i=d3.functor(a),f):i},f.html=function(a){return arguments.length?(h=d3.functor(a),f):h},f.placement=function(a){return arguments.length?(l=d3.functor(a),f):l},f.show=function(a){a.each(c)},f.hide=function(a){a.each(d)},f.toggle=function(a){a.each(e)},f.destroy=function(a){a.on(j,null).on(k,null).attr("title",function(){return this.getAttribute("data-original-title")||this.getAttribute("title")}).attr("data-original-title",null).select(".tooltip").remove()},f}}(this)},{}],2:[function(a,b,c){!function(a,c){"undefined"!=typeof b&&b.exports?b.exports=c():"function"==typeof define&&define.amd?define(c):this[a]=c()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function d(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var e,f=c(/(ipod|iphone|ipad)/i).toLowerCase(),g=/like android/i.test(a),h=!g&&/android/i.test(a),i=/CrOS/.test(a),j=c(/edge\/(\d+(\.\d+)?)/i),k=c(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(a),m=!l&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?e={name:"Opera",opera:b,version:k||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?e={name:"Yandex Browser",yandexbrowser:b,version:k||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?(e={name:"Windows Phone",windowsphone:b},j?(e.msedge=b,e.version=j):(e.msie=b,e.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?e={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:i?e={name:"Chrome",chromeBook:b,chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?e={name:"Microsoft Edge",msedge:b,version:j}:/chrome|crios|crmo/i.test(a)?e={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:f?(e={name:"iphone"==f?"iPhone":"ipad"==f?"iPad":"iPod"},k&&(e.version=k)):/sailfish/i.test(a)?e={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?e={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(e={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(e.firefoxos=b)):/silk/i.test(a)?e={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:h?e={name:"Android",version:k}:/phantom/i.test(a)?e={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?e={name:"BlackBerry",blackberry:b,version:k||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(e={name:"WebOS",webos:b,version:k||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(e.touchpad=b)):e=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||k}:/safari/i.test(a)?{name:"Safari",safari:b,version:k}:{name:c(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!e.msedge&&/(apple)?webkit/i.test(a)?(e.name=e.name||"Webkit",e.webkit=b,!e.version&&k&&(e.version=k)):!e.opera&&/gecko\//i.test(a)&&(e.name=e.name||"Gecko",e.gecko=b,e.version=e.version||c(/gecko\/(\d+(\.\d+)?)/i)),e.msedge||!h&&!e.silk?f&&(e[f]=b,e.ios=b):e.android=b;var n="";e.windowsphone?n=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):f?(n=c(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):h?n=c(/android[ \/-](\d+(\.\d+)*)/i):e.webos?n=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):e.blackberry?n=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):e.bada?n=c(/bada\/(\d+(\.\d+)*)/i):e.tizen&&(n=c(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(e.osversion=n);var o=n.split(".")[0];return l||"ipad"==f||h&&(3==o||4==o&&!m)||e.silk?e.tablet=b:(m||"iphone"==f||"ipod"==f||h||e.blackberry||e.webos||e.bada)&&(e.mobile=b),e.msedge||e.msie&&e.version>=10||e.yandexbrowser&&e.version>=15||e.chrome&&e.version>=20||e.firefox&&e.version>=20||e.safari&&e.version>=6||e.opera&&e.version>=10||e.ios&&e.osversion&&e.osversion.split(".")[0]>=6||e.blackberry&&e.version>=10.1?e.a=b:e.msie&&e.version<10||e.chrome&&e.version<20||e.firefox&&e.version<20||e.safari&&e.version<6||e.opera&&e.version<10||e.ios&&e.osversion&&e.osversion.split(".")[0]<6?e.c=b:e.x=b,e}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c.test=function(a){for(var b=0;b<a.length;++b){var d=a[b];if("string"==typeof d&&d in c)return!0}return!1},c._detect=a,c})},{}],3:[function(a,b,c){!function(a,c){"object"==typeof b&&b.exports?b.exports=function(a){return a.contextMenu=c(a),a.contextMenu}:a.d3.contextMenu=c(a.d3)}(this,function(a){return function(b,c){return a.selectAll(".d3-context-menu").data([1]).enter().append("div").attr("class","d3-context-menu"),a.select("body").on("click.d3-context-menu",function(){a.select(".d3-context-menu").style("display","none")}),function(d,e){var f=this;a.selectAll(".d3-context-menu").html("");var g=a.selectAll(".d3-context-menu").append("ul");g.selectAll("li").data(b).enter().append("li").html(function(a){return"string"==typeof a.title?a.title:a.title(d)}).on("click",function(b,c){b.action(f,d,e),a.select(".d3-context-menu").style("display","none")}),c&&c(d,e)===!1||(a.select(".d3-context-menu").style("left",a.event.pageX-2+"px").style("top",a.event.pageY-2+"px").style("display","block"),a.event.preventDefault(),a.event.stopPropagation())}}})},{}],4:[function(a,b,c){var d;!function e(b,c,d){function f(h,i){if(!c[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=c[h]={exports:{}};b[h][0].call(k.exports,function(a){var c=b[h][1][a];return f(c?c:a)},k,k.exports,e,b,c,d)}return c[h].exports}for(var g="function"==typeof a&&a,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(a,b,c){function d(a,b){var c=document,d=a.nodeType||a===window?a:c.createElement(a),f=[];b&&(d.className=b);var g=e(),h=e(),i=function(a,b){d.addEventListener?d.addEventListener(a,b,!1):d.attachEvent("on"+a,b),f.push({event:a,handler:b})},j=function(a,b){d.removeEventListener?d.removeEventListener(a,b):d.detachEvent("on"+a,b);for(var c,e=f.length;e-->0;)if(c=f[e],c.event===a&&c.handler===b){f.splice(e,1);break}},k=function(a){var b=!1,c=function(c){b||(b=!0,setTimeout(function(){b=!1},100),a(c))};i("touchstart",c),i("mousedown",c)},l=function(a){d&&(d.style.display="block",g.fire(a))},m=function(a){d&&(d.style.display="none",h.fire(a))},n=function(){return d.style&&"block"===d.style.display},o=function(a){d&&(d.innerHTML=a)},p=function(a){d&&(o(""),d.appendChild(c.createTextNode(a)))},q=function(){if(d.parentNode){for(var a,b=f.length;b-->0;)a=f[b],j(a.event,a.handler);d.parentNode.removeChild(d),g.removeAllListeners(),h.removeAllListeners()}},r=function(a){var b=a.el||a;d.appendChild(b)};return{el:d,addListener:i,addClickListener:k,onShowEvent:g,onHideEvent:h,show:l,hide:m,isShowing:n,html:o,text:p,remove:q,add:r}}var e=a("./ModalEvent");b.exports=d},{"./ModalEvent":3}],2:[function(a,b,c){function d(a,b,c,f,g){if(void 0!==a){b=b||{};var h,i=e("div","nanoModal nanoModalOverride "+(b.classes||"")),j=e("div","nanoModalContent"),k=e("div","nanoModalButtons");i.add(j),i.add(k),i.el.style.display="none";var l,m=[];b.buttons=b.buttons||[{text:"Close",handler:"hide",primary:!0}];var n=function(){for(var a=m.length;a-->0;){var b=m[a];b.remove()}m=[]},o=function(){i.el.style.marginLeft=-i.el.clientWidth/2+"px"},p=function(){for(var a=document.querySelectorAll(".nanoModal"),b=a.length;b-->0;)if("none"!==a[b].style.display)return!0;return!1},q=function(){i.isShowing()||(d.resizeOverlay(),c.show(c),i.show(l),o())},r=function(){i.isShowing()&&(i.hide(l),p()||c.hide(c),b.autoRemove&&l.remove())},s=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};return l={modal:i,overlay:c,show:function(){return f?f(q,l):q(),l},hide:function(){return g?g(r,l):r(),l},onShow:function(a){return i.onShowEvent.addListener(function(){a(l)}),l},onHide:function(a){return i.onHideEvent.addListener(function(){a(l)}),l},remove:function(){c.onRequestHide.removeListener(h),h=null,n(),i.remove()},setButtons:function(a){var b,c,d,f=a.length,g=function(a,b){var c=s(l);a.addClickListener(function(a){c.event=a||window.event,b.handler(c)})};if(n(),0===f)k.hide();else for(k.show();f-->0;)b=a[f],d="nanoModalBtn",b.primary&&(d+=" nanoModalBtnPrimary"),d+=b.classes?" "+b.classes:"",c=e("button",d),"hide"===b.handler?c.addClickListener(l.hide):b.handler&&g(c,b),c.text(b.text),k.add(c),m.push(c);return o(),l},setContent:function(b){return b.nodeType?(j.html(""),j.add(b)):j.html(b),o(),a=b,l},getContent:function(){return a}},h=c.onRequestHide.addListener(function(){b.overlayClose!==!1&&i.isShowing()&&l.hide()}),l.setContent(a).setButtons(b.buttons),document.body.appendChild(i.el),l}}var e=a("./El"),f=document,g=function(a){var b=f.documentElement,c="scroll"+a,d="offset"+a;return Math.max(f.body[c],b[c],f.body[d],b[d],b["client"+a])};d.resizeOverlay=function(){var a=f.getElementById("nanoModalOverlay");a.style.width=g("Width")+"px",a.style.height=g("Height")+"px"},b.exports=d},{"./El":1}],3:[function(a,b,c){function d(){var a={},b=0,c=function(c){return a[b]=c,b++},d=function(b){b&&delete a[b]},e=function(){a={}},f=function(){for(var c=0,d=b;d>c;++c)a[c]&&a[c].apply(null,arguments)};return{addListener:c,removeListener:d,removeAllListeners:e,fire:f}}b.exports=d},{}],4:[function(a,b,c){var e=a("./ModalEvent"),f=function(){function b(){if(!g.querySelector("#nanoModalOverlay")){var a=d("style"),b=a.el,h=g.querySelectorAll("head")[0].childNodes[0];h.parentNode.insertBefore(b,h);var i=".nanoModal{position:absolute;top:100px;left:50%;display:none;z-index:9999;min-width:300px;padding:15px 20px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;background:#fff;background:-moz-linear-gradient(top,#fff 0,#ddd 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fff),color-stop(100%,#ddd));background:-webkit-linear-gradient(top,#fff 0,#ddd 100%);background:-o-linear-gradient(top,#fff 0,#ddd 100%);background:-ms-linear-gradient(top,#fff 0,#ddd 100%);background:linear-gradient(to bottom,#fff 0,#ddd 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#dddddd', GradientType=0)}.nanoModalOverlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:9998;background:#000;display:none;-ms-filter:\"alpha(Opacity=50)\";-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}.nanoModalButtons{border-top:1px solid #ddd;margin-top:15px;text-align:right}.nanoModalBtn{color:#333;background-color:#fff;display:inline-block;padding:6px 12px;margin:8px 4px 0;font-size:14px;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.nanoModalBtn:active,.nanoModalBtn:focus,.nanoModalBtn:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.nanoModalBtn.nanoModalBtnPrimary{color:#fff;background-color:#428bca;border-color:#357ebd}.nanoModalBtn.nanoModalBtnPrimary:active,.nanoModalBtn.nanoModalBtnPrimary:focus,.nanoModalBtn.nanoModalBtnPrimary:hover{color:#fff;background-color:#3071a9;border-color:#285e8e}";b.styleSheet?b.styleSheet.cssText=i:a.text(i),c=d("div","nanoModalOverlay nanoModalOverride"),c.el.id="nanoModalOverlay",g.body.appendChild(c.el),c.onRequestHide=e();var j=function(){c.onRequestHide.fire()};c.addClickListener(j),d(g).addListener("keydown",function(a){var b=a.which||a.keyCode;27===b&&j()});var k,l=d(window);l.addListener("resize",function(){k&&clearTimeout(k),k=setTimeout(f.resizeOverlay,100)}),l.addListener("orientationchange",function(){for(var a=0;3>a;++a)setTimeout(f.resizeOverlay,1e3*a+200)})}}var c,d=a("./El"),f=a("./Modal"),g=document;document.body&&b();var h=function(a,d){return b(),f(a,d,c,h.customShow,h.customHide)};return h.resizeOverlay=f.resizeOverlay,h}();d=f},{"./El":1,"./Modal":2,"./ModalEvent":3}]},{},[1,2,3,4]),"undefined"!=typeof window&&("function"==typeof window.define&&window.define.amd&&window.define(function(){return d}),window.nanoModal=d),"undefined"!=typeof b&&(b.exports=d)},{}],5:[function(a,b,c){function d(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function e(a,b,c){var d,e=b.x,f=b.y,g=c.x-e,h=c.y-f;return(0!==g||0!==h)&&(d=((a.x-e)*g+(a.y-f)*h)/(g*g+h*h),d>1?(e=c.x,f=c.y):d>0&&(e+=g*d,f+=h*d)),g=a.x-e,h=a.y-f,g*g+h*h}function f(a,b){var c,e,f=a.length,g=a[0],h=[g];for(c=1;f>c;c++)e=a[c],d(e,g)>b&&(h.push(e),g=e);return g!==e&&h.push(e),h}function g(a,b){var c,d,f,g,h=a.length,i=typeof Uint8Array!=void 0+""?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[],o=[];for(j[k]=j[l]=1;l;){for(d=0,c=k+1;l>c;c++)f=e(a[c],a[k],a[l]),f>d&&(g=c,d=f);d>b&&(j[g]=1,m.push(k),n.push(g),m.push(g),n.push(l)),k=m.pop(),l=n.pop()}for(c=0;h>c;c++)j[c]&&o.push(a[c]);return o}function h(a,b,c){var d=void 0!==b?b*b:1;return c||(a=f(a,d)),a=g(a,d)}b.exports=h},{}],6:[function(a,b,c){!function(){"use strict";var b={version:"0.5.2"},c={};b.globals={},b.globals.render=!0,b.app=function(){function b(d){if(g=b.width(),h=b.height(),"undefined"==typeof g||"undefined"==typeof h||isNaN(g)||isNaN(h)){var m=d.node(),n=m.clientWidth?[m.clientWidth,m.clientHeight]:[m.getBoundingClientRect().width,m.getBoundingClientRect().height];g=n[0],h=n[1]}if(400>g||400>h)throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px");f=e(d).style({width:g,height:h}),g-=50,i=a("./src/modals")(b),a("./src/menu/menu")(b),a("./src/events").registerKeyboard(b),f.node().appendToCurrentSlide=function(a){var b=f.select(".spec-slide.active").node();b?(b.addSpec(a),k.slideContentChange()):f.node().appendSlide(a)},k.on("slideChange.app",function(a){j!==a&&b.currentSlide(a)});for(var o=0;o<l.length;o++)c(l[o])}function c(a){f&&(a.width(g).height(h)(b),b.currentSlide(a))}var d=a("./src/elem"),e=d.Elem()["class"]("spec-app");d.inherit(b,e);var f,g,h,i,j,k=d3.dispatch("slideChange","slideContentChange","menuUpdate"),l=d.ElemArray();return b.slides=function(){return l},b.currentSlide=function(a){return arguments.length?(j&&j.show(!1),a.show(!0),j=a,void k.slideChange(a)):j},b.dispatcher=function(){return k},b.slideDispatcher=function(){return j.slideDispatcher()},b.modals=function(){return i},b.pluginRequest=a("./src/pro/plugins")(b),b.appendSlide=function(d){if(!arguments.length)throw new Error("appendSlide: No data provided.");var e=a("./src/slide")().datum(d);return l.push(e),c(e),b},b.appendToCurrentSlide=function(a){if(!arguments.length)throw new Error("appendToCurrentSlide: No data provided.");if(!f){if(0===l.length)return b.appendSlide(a);var c=l[l.length-1].slide;return c.push(a),b}f.node().appendToCurrentSlide(a)},b.options={grid:{x:!1,y:!1}},b},c.get_spectrum=a("./src/pro/process_data").get_spectrum,window.spec=b,window.pro=c,console.log("specdraw:"+b.version)}()},{"./src/elem":19,"./src/events":20,"./src/menu/menu":23,"./src/modals":28,"./src/pro/plugins":31,"./src/pro/process_data":32,"./src/slide":34}],7:[function(a,b,c){b.exports=function(){function b(a,b,c){var d;if(c){var e=[b(a-10),b(a+10)];d=e[0]+g.slice(e[0],e[1]+1).whichMax()}else d=b(a);return g[d]}function c(){var a=".line."+j;h.on("regionchange"+a,null),h.on("mouseenter"+a,null),h.on("mouseleave"+a,null),h.on("mousemove"+a,null),k&&(h.on("regionchange"+a,i.on("_regionchange")),h.on("mouseenter"+a,function(){d.show(!0)}),h.on("mouseleave"+a,function(){d.show(!1)}),l&&h.on("mousemove"+a,i.on("_mousemove"))),h.on("specDataChange"+a,function(a){a===d.parent()&&d.datum(a.datum())}),h.on("crosshairEnable"+a,d.enable)}function d(a){return e=d.xScale(),f=d.yScale(),h=d.dispatcher(),j=++h.idx,k=l=!0,i=o(a).datum(null).call(m),i.append("circle").attr("class","clr"+a.lineIdx()).attr("r",4.5).on("click",function(){a.sel().toggleClass("selected")}).on("mouseenter",function(){a.sel().selectP(".main-focus").classed("dimmed",!0),a.sel().classed("highlighted",!0)}).on("mouseleave",function(){a.sel().selectP(".main-focus").classed("dimmed",!1),a.sel().classed("highlighted",!1)}),i.on("_regionchange",function(a){if(a.x)i.datum(null),i.attr("transform","translate(-10000,-10000)");else{var b=i.datum();b&&i.attr("transform","translate("+e(b.x)+","+f(b.y)+")")}}).on("_mousemove",function(c){var d=b(c.xcoor,a.pixelToi,c.shiftKey);return"undefined"==typeof d?void i.datum(null):(i.datum(d).attr("transform","translate("+e(d.x)+","+f(d.y)+")"),void m.text(d3.round(d.x,3)).show(i.node()))}).on("remove",function(){d.enabled(!1),h.on("crosshairEnable.line."+j,null),g=null,m.destroy()}),c(),i}var e,f,g,h,i,j,k,l,m=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),n=a("../elem"),o=n.SVGElem()["class"]("crosshair");return n.inherit(d,o),d.show=function(a){return arguments.length?(l=a,i?(i.style("display",a?null:"none"),a?m.show(i):m.hide(),c(),d):d):l},d.enable=function(a){return arguments.length?(k=a,d.show(a)):k},d.datum=function(a){return arguments.length?(g=a,d):g},d}},{"../elem":19}],8:[function(a,b,c){function d(a){var b=a.map(function(a){return a.y}).cumsum(),c=a.map(function(a,c){return{x:a.x,y:b[c]}});return c}b.exports=function(){function b(a){function c(){k.datum(i).attr("d",m),d()}function d(){var a=k.node().getPointAtLength(.5*k.node().getTotalLength());s.attr("transform","translate("+a.x+","+a.y+")"),n()}function n(){l.datum(o).text((o/p).toFixed(2));var a=l.node().getBBox();l.attr("dx",-a.width/2),r()}function r(){var a=l.node().getBBox();t.attr("width",a.width+4).attr("height",a.height+4).attr("x",a.x-2).attr("y",a.y-2)}f=b.xScale(),g=b.yScale(),h=b.dispatcher(),j=e(a),b.updateData(),p||(p=o),q||(q=1),m=d3.svg.line().x(function(a){return f(a.x)}).y(function(a){return g(a.y/q)-.3*g.range()[0]}),k=j.append("path").attr("class","line");var s=j.append("g").attr("class","integration-text"),t=s.append("rect");l=s.append("text");var u=b.parentApp().modals();s.on("mouseenter",function(){j.classed("highlight",!0)}).on("mouseleave",function(){j.classed("highlight",!1)}).on("click",d3.contextMenu([{title:"Set integral",action:u.input("Set Integral to: ",l.text(),function(a){p=l.datum()/a,h.integ_refactor(p)})}])),c(),j.on("_redraw",function(a){a.x&&c()}).on("_refactor",function(a){b.integFactor(a),n()}).on("_reduction_factor",function(a){b.reductionFactor(a),c()});var v=++h.idx;h.on("redraw.integ."+v,j.on("_redraw")),h.on("integ_refactor."+v,j.on("_refactor")),h.on("specDataChange.integ."+v,function(a){a===b.parent()&&(p===o?(b.updateData(),p=o,h.integ_refactor(p)):b.updateData())})}var c=a("../elem"),e=c.SVGElem()["class"]("integration");c.inherit(b,e);var f,g,h,i,j,k,l,m,n,o,p,q;return b.segment=function(a){return arguments.length?(n=a,b.updateData()):n},b.updateData=function(){if(!n||!j)return o=void 0,b;var a=b.parent();return i=d(Array.prototype.slice.apply(a.datum(),n)),o=i[i.length-1].y,b},b.integFactor=function(a){return arguments.length?(p=a,b):p},b.integValue=function(a){return arguments.length?(o=a,b):o},b.reductionFactor=function(a){return arguments.length?(q=a,b.sel()&&b.sel().on("_redraw")({x:!0}),b):q},b}},{"../elem":19}],9:[function(a,b,c){function d(a){for(var b=[],c=a.spectra(),d=0;d<c.length;d++)b=b.concat(c[d].segments(!0).map(function(a){return a.integValue()}));var e=d3.max(b)/(.5*a.yScale().domain()[1]);return a.spectra().forEach(function(a){a.segments(!0).forEach(function(a){a.reductionFactor(e)})}),d3.max(b)/.5}function e(a){for(var b,c=a.spectra(),d=0;d<c.length;d++)for(var e=c[d].segments(),f=0;f<e.length;f++)if(b=e[f].integFactor())return b}b.exports=function(){function b(a){o=b.xScale(),p=b.yScale(),q=b.dispatcher(),t=o.copy(),r=a.spectra().indexOf(b),s=j(a).classed("selected",x).classed("clr"+r,!0),i.datum(k).xScale(o).yScale(p).simplify(1)["class"]("line")(s),"undefined"==typeof n&&b.crosshair(!0),n&&n.xScale(o).yScale(p).dispatcher(q)(b);for(var e=0;e<A.length;e++)c(A[e]);s.on("_redraw",function(b){if(b.x)i.redraw().sel().attr("transform","scale(1,1)translate(0,0)"),d(a);else{var c=p.copy().domain(a.range().y),e=[0,-Math.min(c(p.domain()[1]),c(p.domain()[0]))],f=[1,Math.abs((a.range().y[0]-a.range().y[1])/(p.domain()[0]-p.domain()[1]))];i.sel().attr("transform","scale("+f+")translate("+e+")")}}).on("_regionchange",function(a){a.xdomain&&(v=a.xdomain.map(b.ppmToi),t.domain(v),i.datum(Array.prototype.slice.apply(k,v)),w.y=i.range().y,w.y[0]*=y,w.y[1]*=y)}).on("_integrate",function(a){var c=a.xdomain.map(b.ppmToi).sort(d3.ascending);b.addSegment(c)}).on("_segment",function(){});var f=++q.idx;return q.on("regionchange.line."+f,s.on("_regionchange")),q.on("redraw.line."+f,s.on("_redraw")),q.on("integrate.line."+f,s.on("_integrate")),s.on("remove",function(){q.on("regionchange.line."+f,null),q.on("redraw.line."+f,null),q.on("integrate.line."+f,null),k=null,n&&n.remove()}),s}function c(a){s&&a.xScale(o).yScale(p).dispatcher(q)(b)}function f(a,b){s&&s.on("_redraw")({x:a,y:b})}function g(){s&&(s.on("_regionchange")({xdomain:o.domain()}),s.on("_redraw")({x:!0}))}var h=a("../elem"),i=a("./path-simplify")(),j=h.SVGElem()["class"]("spec-line");h.inherit(b,j);var k,l,m,n,o,p,q,r,s,t,u,v,w={},x=!0,y=1,z=[],A=h.ElemArray();return b.addSegment=function(f){var g=a("./integration-elem")().segment(f).integFactor(e(b.parent()));A.push(g),c(g),d(b.parent())},b.delSegment=function(a){A=A.filter(function(b){return!(b>=a[0]&&b<=a[1])})},b.segments=function(a){var b=A;return a&&(b=b.filter(function(a){var b=a.segment();return b[0]>v[0]&&b[0]<v[1]&&b[1]>v[0]&&b[1]<v[1]})),b},b.addPeaks=function(a){z=z.concat(a)},b.delPeaks=function(a){a=a.map(b.ppmToi).sort(d3.ascending),z=z.filter(function(b){return!(b>=a[0]&&b<=a[1])})},b.peaks=function(a){var b=z;return a&&(b=b.filter(function(a){return a>v[0]&&a<v[1]})),k.subset(b)},b.iToPixel=function(a){return t(a)},b.pixelToi=function(a){return Math.round(t.invert(a))},b.ppmToi=function(a){console.log("ppm",a);var b=Math.round(u(a));return b=b>k.length-1?k.length-1:b,b=0>b?0:b,k[b-1]&&Math.abs(a-k[b].x)>Math.abs(a-k[b-1].x)?b--:k[b+1]&&Math.abs(a-k[b].x)>Math.abs(a-k[b+1].x)&&b++,b},b.range=function(){return w},b.datum=function(a){if(!arguments.length)return k;if(a[0].x)k=a;else if(k&&k.length===a.length)k=a.map(function(a,b){return{x:k[b].x,y:a}});else{var c=d3.scale.linear().range(b.parent().range().x).domain([0,a.length]);k=a.map(function(a,b){return{x:c(b),y:a}})}return w.x=[k[0].x,k[k.length-1].x],w.y=d3.extent(k.map(function(a){return a.y})),u=d3.scale.linear().range([0,k.length]).domain([k[0].x,k[k.length-1].x]),q&&q.specDataChange(b),g(),b},b.label=function(a){return arguments.length?(m=a,b):m},b.crosshair=function(c){return arguments.length?(n=c?a("./crosshair")().datum(k):!1,b):n},b.s_id=function(a){return arguments.length?(l=a,b):l},b.selected=function(a){return arguments.length?(x=a,b):x},b.lineIdx=function(){return r},b.scaleFactor=function(a){return arguments.length?(y=a,f(),b):y},b}},{"../elem":19,"./crosshair":7,"./integration-elem":8,"./path-simplify":11}],10:[function(a,b,c){b.exports=function(){function b(){if(l.empty())return h&&i?l.extent([[0,0],[0,0]]):l.extent([0,0]),k.call(l),null;var a={};return h&&i?(a.xdomain=[l.extent()[1][0],l.extent()[0][0]],a.ydomain=[l.extent()[1][1],l.extent()[0][1]]):(a.xdomain=h?l.extent().reverse():null,a.ydomain=i?l.extent():null),l.clear(),k.call(l),a}function c(){var a=b();a&&g.parent().changeRegion(a)}function d(){var a=b();a&&j.peakdel(a)}function e(){var a=b();a&&j.integrate(a)}function f(){l.clear(),k.call(l)}function g(a){h=g.xScale(),i=g.yScale(),j=g.dispatcher(),l=d3.svg.brush().x(h).y(i).on("brushend",c),k=n(a).call(l),k.selectAll("rect").attr("height",a.height()),k.select(".background").style("cursor",null).style("pointer-events","all"),k.on("peakpickEnable",function(a){k.classed("peakpick-brush",a),g.parent().sel().classed("peakpick-brush",a),l.on("brushend",a?f:c)}).on("peakdelEnable",function(a){k.classed("peakdel-brush",a),g.parent().sel().classed("peakdel-brush",a),l.on("brushend",a?d:c)}).on("integrateEnable",function(a){k.classed("integrate-brush",a),g.parent().sel().classed("integrate-brush",a),l.on("brushend",a?e:c)});var b=++j.idx;return j.on("peakpickEnable.brush."+b,k.on("peakpickEnable")),j.on("peakdelEnable.brush."+b,k.on("peakdelEnable")),j.on("integrateEnable.brush."+b,k.on("integrateEnable")),k}var h,i,j,k,l,m=a("../elem"),n=m.SVGElem()["class"]("main-brush");return m.inherit(g,n),g}},{"../elem":19}],11:[function(a,b,c){b.exports=function(){function b(a){return h=b.xScale(),i=b.yScale(),m=d3.svg.line().interpolate("linear").x(function(a){return h(a.x)}).y(function(a){return i(a.y)}),j=f(a)}function c(){n.x=[k[0].x,k[k.length-1].x],n.y=d3.extent(k.map(function(a){return a.y}))}var d=a("../utils"),e=a("../elem"),f=e.ResponsiveElem("path");e.inherit(b,f);var g,h,i,j,k,l,m,n={};return b.redraw=function(){return j?(j.attr("d",m),b):b},b.update=function(){return j?(l?(k=d.simplify(g,h,l),console.log("simplify",k.length)):k=g,j.datum(k),c(),b):b},b.range=function(){return n},b.datum=function(a){return arguments.length?(g=a,b.update()):g},b.simplify=function(a){return arguments.length?(l=a,b):l},b}},{"../elem":19,"../utils":35}],12:[function(a,b,c){function d(a,b,c){var d=Math.max(b-10,60);return d3.svg.line().defined(function(a){return!isNaN(a[1])})([[c,40],[a,60],[a,80],[NaN,NaN],[a,d-10],[a,d]])}function e(a,b,c){for(var d=b,e=c-d,f=0;f<a.length;f++)a[f].pos>e&&(a[f].pos=e),e=a[f].pos-d;if(d>e)for(e=d,f=a.length-1;f>=0&&a[f].pos<e;f--)a[f].pos=e,e=a[f].pos+d;return a}function f(a){for(var b=a.spectra(),c=a.xScale(),d=[],e=0;e<b.length;e++){var f=b[e].peaks(!0).map(function(a){return{line:b[e].lineIdx(),pos:c(a.x),d:a}});d=d.concat(f)}return d=d.sort(function(a,b){return d3.descending(a.pos,b.pos)})}var g=a("d3-context-menu")(d3);b.exports=function(){function b(){var a=l.selectAll("text").data(q);a.enter().append("text").attr("dy","0.35em").attr("focusable",!0).on("focus",function(){}),a.exit().remove()}function c(){var a=l.selectAll("path").data(q);a.enter().append("path").style("fill","none"),a.exit().remove()}function h(){l.selectAll("text").text(function(a){return d3.round(a.d.x,3)}).attr("transform",function(a){return"translate("+a.pos+",0)rotate(90)"}).attr("class",function(a){return"peak-text clr"+a.line}).on("keydown",function(a){68===d3.event.keyCode&&o.peakdel({xdomain:[a.d.x,a.d.x]})}).on("click",g(p))}function i(){l.selectAll("path").attr("d",function(a){return d(m(a.d.x),n(a.d.y),a.pos)}).attr("class",function(a){return"peak-line clr"+a.line})}function j(){var a=l.append("text").text("any"),b=a.node().getBBox().height;return a.remove(),b}function k(a){m=k.xScale(),n=k.yScale(),o=k.dispatcher();var d=a.width();l=s(a),l.on("_click",function(b){var c=a.spectra();c.forEach(function(a){if(a.crosshair()){a.crosshair().sel().on("_mousemove")(b);var c=a.crosshair().sel().datum();c&&(console.log(c,a.ppmToi(c.x)),a.addPeaks(a.ppmToi(c.x)))}else a.addPeaks(a.pixelToi(b.xcoor))}),o.peakpick()}).on("_regionchange",function(b){b.xdomain&&(q=f(a),q=e(q,j(),d))}).on("_redraw",function(a){if(a.x){if(b(),c(),0===q.length)return;h()}i()}).on("_peakpick",function(){l.on("_regionchange")({xdomain:!0}),l.on("_redraw")({x:!0,y:!0})}).on("_peakdel",function(b){b.xdomain&&a.spectra().forEach(function(a){a.delPeaks(b.xdomain)}),b.ydomain,o.peakpick()});var g=++o.idx;return o.on("regionchange.peaks."+g,l.on("_regionchange")),o.on("redraw.peaks."+g,l.on("_redraw")),o.on("peakpickEnable.peaks."+g,function(a){o.on("click.peaks."+g,a?l.on("_click"):null)}),o.on("peakpick.peaks."+g,l.on("_peakpick")),o.on("peakdel.peaks."+g,l.on("_peakdel")),l}var l,m,n,o,p=[{title:"Delete peak",action:function(a,b){k.parent().spectra().filter(function(a){return a.lineIdx()===b.line})[0].delPeaks([b.d.x,b.d.x]),o.peakpick()}}],q=[],r=a("../elem"),s=r.SVGElem()["class"]("peaks");return r.inherit(k,s),k.peaks=function(){return f(k.parent())},k}},{"../elem":19,"d3-context-menu":3}],13:[function(a,b,c){b.exports=function(){function b(a){e=b.xScale(),f=b.yScale(),g=b.dispatcher();var i=e?e:f;h=e?e.copy():f.copy();var k=d3.svg.axis().scale(h).orient(e?"bottom":"top").tickFormat(d3.format("s")),l=d3.svg.brush().x(h).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brushend",function(){var b=l.empty()?h.domain():l.extent().reverse();b=b.sort(h.domain()[0]>h.domain()[1]?d3.descending:d3.ascending),a.changeRegion(e?{xdomain:b}:{ydomain:b})});d=j(a).classed(e?"x":"y",!0).attr("transform",e?"translate(0,-20)":"translate(-20,0)rotate(90)"),d.append("g").call(k).attr("class","brush-axis"),d.append("g").attr("class","brush").call(l).selectAll("rect").attr("y",-5).attr("height",10),d.select(".background").style("pointer-events","all"),d.on("_rangechange",function(a){(a.x||a.y&&f)&&(h.domain(e?a.x:a.y),d.select(".brush-axis").call(k),d.select(".brush").call(l))}).on("_regionchange",function(a){if(a.xdomain||a.ydomain&&f){var b=c(i.domain(),h.domain());l.extent(b)}}).on("_redraw",function(a){(a.x||a.y&&f)&&d.select(".brush").call(l)});var m=++g.idx;return g.on("rangechange.scalebrush."+m,d.on("_rangechange")),g.on("regionchange.scalebrush."+m,d.on("_regionchange")),g.on("redraw.scalebrush."+m,d.on("_redraw")),d}function c(a,b){var c=[0,0];return a[0]>a[1]?(c[0]=Math.min(a[0],b[0]),c[1]=Math.max(a[1],b[1])):(c[0]=Math.max(a[0],b[0]),c[1]=Math.min(a[1],b[1])),c.join()===b.join()&&(c=[0,0]),c}var d,e,f,g,h,i=a("../elem"),j=i.SVGElem()["class"]("scale-brush");return i.inherit(b,j),b}},{"../elem":19}],14:[function(a,b,c){b.exports=function(){function b(a){h=b.xScale(),i=b.yScale(),j=b.dispatcher(),g=f(a).attr("pointer-events","all").attr("clip-path","url(#"+a.clipId()+")").attr("width",b.width()).attr("height",b.height()).call(p).on("dblclick.zoom",null).on("mousedown.zoom",null),g.append("rect").attr("width",b.width()).attr("height",b.height()).style("fill","none"),
g.on("_redraw",function(a){j.redraw(a)}).on("_regionchange",function(a){if(a.xdomain&&h.domain(a.xdomain),j.regionchange({xdomain:a.xdomain}),a.ydomain)i.domain(a.ydomain),a.zoom||p.scale((l.y[0]-l.y[1])/(i.domain()[0]-i.domain()[1]));else{var b=d3.min(m.map(function(a){return a.range().y[0]})),c=d3.max(m.map(function(a){return a.range().y[1]})),d=c-b;b-=.05*d,c+=.05*d,l.y=[b,c],i.domain(l.y),j.rangechange({y:l.y}),p.scale(1)}j.regionchange({ydomain:i.domain()}),g.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(l.x=a.x),a.y&&(l.y=a.y),j.rangechange(a),a.norender||g.on("_regionchange")({xdomain:l.x,ydomain:l.y})}).on("mouseenter",j.mouseenter).on("mouseleave",j.mouseleave).on("mousemove",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],j.mousemove(a)}).on("mousedown",function(){var a=new Event("mousedown");a.pageX=d3.event.pageX,a.clientX=d3.event.clientX,a.pageY=d3.event.pageY,a.clientY=d3.event.clientY,g.select(".main-brush").node().dispatchEvent(a)}).on("click",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],j.click(a)}).on("dblclick",j.regionfull),j.on("regionfull",function(){g.on("_regionchange")({xdomain:l.x})}),o.xScale(h).dispatcher(j)(b);for(var c=0;c<m.length;c++)d(m[c]);n.xScale(h).yScale(i).dispatcher(j)(b)}function c(){var a=d3.max(m.map(function(a){return a.range().x[0]})),b=d3.min(m.map(function(a){return a.range().x[1]})),c=d3.min(m.map(function(a){return a.range().y[0]})),d=d3.max(m.map(function(a){return a.range().y[1]})),e=d-c;c-=.05*e,d+=.05*e;var f=h.domain();g.on("_rangechange")({x:[a,b],y:[c,d],norender:m.length>1}),m.length>1&&g.on("_regionchange")({xdomain:f})}function d(a){g&&(a.xScale(h).yScale(i).dispatcher(j)(b),c())}var e=a("../elem"),f=e.SVGElem()["class"]("main-focus");e.inherit(b,f);var g,h,i,j,k,l={},m=e.ElemArray(),n=a("./peak-picker")(),o=a("./main-brush")(),p=d3.behavior.zoom().on("zoom",function(){var a=l.y[1]/p.scale()-l.y[0],b=(a-(i.domain()[1]-i.domain()[0]))/2,c=[];i.domain()[0]===l.y[0]?c[0]=l.y[0]:c[0]=Math.max(i.domain()[0]-b,l.y[0]),c[1]=c[0]+a,g.on("_regionchange")({zoom:!0,ydomain:c})});return b.changeRegion=function(a){g&&g.on("_regionchange")(a)},b.addSpec=function(b,e){if(!arguments.length)throw new Error("appendSlide: No data provided.");"undefined"==typeof e&&(e=!0);var f=null,g="spec"+m.length;console.log(b.label),"undefined"!=typeof b.s_id&&(f=b.s_id),"undefined"!=typeof b.label&&(g=b.label),b=b.data;var h=m.filter(function(a){return a.s_id()===f});return console.log("addspec",h,f),0===h.length?(h=a("./line")().datum(b).crosshair(e).s_id(f).label(g),m.push(h),d(h)):(h=h[0],h.datum(b),c()),h},b.addPeaks=function(a){g&&(g.select(".peaks").node().addpeaks(k.subset(a)),g.select(".peaks").on("_regionchange")({xdomain:!0}),g.select(".peaks").on("_redraw")({x:!0}))},b.nd=function(){return 1},b.spectra=function(a){return a?m.filter(function(a){return a.selected()}):m},b.highlightSpec=function(a){var b=m.indexOf(a);0>b?m.sel().classed("dimmed",!1).classed("highlighted",!1):(m.sel().classed("dimmed",!1),a.sel().classed("highlighted",!0))},b.peakPicker=function(){return n},b.mainBrush=function(){return o},b.range=function(){return l},b.datum=function(a){return arguments.length?(k=a,b.addSpec(a),b):k},b}},{"../elem":19,"./line":9,"./main-brush":10,"./peak-picker":12}],15:[function(a,b,c){b.exports=function(){function b(a,g){d=b.xScale()||a.xScale(),e=b.yScale()||a.yScale(),f=b.dispatcher()||a.dispatcher(),c=h(a).on("_mousemove",function(a){c.attr("d",d3.svg.line()([[d.range()[0],a.ycoor],[d.range()[1],a.ycoor]]))}).on("_click",function(a){g(e.invert(a.ycoor)),c.remove(),f.on("mousemove.thresh."+i,null),f.on("click.thresh."+i,null)});var i=++f.idx;f.on("mousemove.thresh."+i,c.on("_mousemove")),f.on("click.thresh."+i,c.on("_click"))}var c,d,e,f,g=a("../elem"),h=g.ResponsiveElem("path")["class"]("threshold line x");return g.inherit(b,h),b}},{"../elem":19}],16:[function(a,b,c){b.exports=function(){function b(){var a=".line."+j;i.on("regionchange"+a,null),i.on("mouseenter"+a,null),i.on("mouseleave"+a,null),i.on("mousemove"+a,null),k&&(i.on("regionchange"+a,f.on("_regionchange")),i.on("mouseenter"+a,function(){c.show(!0)}),i.on("mouseleave"+a,function(){c.show(!1)}),l&&i.on("mousemove"+a,f.on("_mousemove"))),i.on("crosshairEnable"+a,c.enable)}function c(a){g=c.xScale(),h=c.yScale(),i=c.dispatcher(),j=++i.idx,k=l=!0,f=e(a).classed("clr"+a.lineIdx(),!0).datum(null).call(m);var d=f.append("g").attr("class","crosshair line");d.append("path").attr("class","crosshair line x").attr("d",d3.svg.line()([[-g.range()[1],0],[g.range()[1],0]])),d.append("path").attr("class","crosshair line y").attr("d",d3.svg.line()([[0,-h.range()[0]],[0,h.range()[0]]]));var n=f.append("circle").attr("r",4.5);return f.on("_regionchange",function(){}).on("_mousemove",function(a){var b=[g.invert(a.xcoor),h.invert(a.ycoor)];f.datum(b),f.attr("transform","translate("+a.xcoor+","+a.ycoor+")"),m.text(d3.round(b[0],2)+", "+d3.round(b[1],2)).show(n.node())}).on("remove",function(){c.enabled(!1),i.on("crosshairEnable.line."+j,null),m.destroy()}),b(),f}var d=a("../elem"),e=d.SVGElem()["class"]("crosshair");d.inherit(c,e);var f,g,h,i,j,k,l,m=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0);return c.show=function(a){return arguments.length?(l=a,f?(f.style("display",a?null:"none"),a?m.show(f):m.hide(),b(),c):c):l},c.enable=function(a){return arguments.length?(k=a,c.show(a)):k},c}},{"../elem":19}],17:[function(a,b,c){b.exports=function(){function b(a){g=b.xScale(),h=b.yScale(),i=b.dispatcher(),k=f(a).attr("pointer-events","all").attr("clip-path","url(#"+a.clipId()+")").attr("width",b.width()).attr("height",b.height()).call(o).on("dblclick.zoom",null).on("mousedown.zoom",null),k.on("_redraw",function(a){i.redraw(a)}).on("_regionchange",function(a){a.xdomain&&g.domain(a.xdomain),a.ydomain&&h.domain(a.ydomain),i.regionchange({xdomain:a.xdomain,ydomain:h.domain()}),k.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(l.x=a.x),a.y&&(l.y=a.y),i.rangechange(a),a.norender||k.on("_regionchange")({xdomain:l.x,ydomain:l.y})}).on("mouseenter",i.mouseenter).on("mouseleave",i.mouseleave).on("mousemove",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.mousemove(a)}).on("mousedown",function(){var a=new Event("mousedown");a.pageX=d3.event.pageX,a.clientX=d3.event.clientX,a.pageY=d3.event.pageY,a.clientY=d3.event.clientY,k.select(".main-brush").node().dispatchEvent(a)}).on("click",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.click(a)}).on("dblclick",i.regionfull),i.on("regionfull",function(){k.on("_regionchange")({xdomain:l.x,ydomain:l.y})});for(var d=0;d<m.length;d++)c(m[d]);n.xScale(g).yScale(h).dispatcher(i)(b)}function c(a){k&&(console.log(a),a.xScale(g).yScale(h).dispatcher(i)(b),d())}function d(){var a=d3.max(m.map(function(a){return a.range().x[0]})),b=d3.min(m.map(function(a){return a.range().x[1]})),c=d3.min(m.map(function(a){return a.range().y[0]})),d=d3.max(m.map(function(a){return a.range().y[1]})),e=g.domain(),f=h.domain();k.on("_rangechange")({x:[a,b],y:[c,d],norender:m.length>1}),m.length>1&&k.on("_regionchange")({xdomain:e,ydomain:f})}var e=a("../elem"),f=e.SVGElem()["class"]("main-focus");e.inherit(b,f);var g,h,i,j,k,l={},m=e.ElemArray(),n=a("../d1/main-brush")(),o=d3.behavior.zoom().on("zoom",function(){d3.select("#rfunc").attr("slope",o.scale()),d3.select("#bfunc").attr("slope",o.scale())}).scaleExtent([.1,100]);return b.addSpec=function(b,d){if(!arguments.length)throw new Error("appendSlide: No data provided.");"undefined"==typeof d&&(d=!0);var e=m.filter(function(a){return a.s_id()===b.s_id});return 0===e.length?(e=a("./spec2d")().datum(b.data).s_id(b.s_id).crosshair(d).range({x:b.x_domain,y:b.y_domain}),m.push(e)):(e=e[0],e.datum(b).range({x:b.x_domain,y:b.y_domain})),c(e),e},b.changeRegion=function(a){k&&k.on("_regionchange")(a)},b.nd=function(){return 2},b.spectra=function(){return m},b.range=function(){return l},b.datum=function(a){return arguments.length?(j=a,b.addSpec(a),b):j},b}},{"../d1/main-brush":10,"../elem":19,"./spec2d":18}],18:[function(a,b,c){b.exports=function(){function b(a){k=b.xScale(),l=b.yScale(),m=b.dispatcher(),n=f(a),p=a.spectra().indexOf(b),o=n.append("g").attr("filter","url(#2dColorFilter)").append("svg:image").attr("width",a.width()).attr("height",a.height()).attr("xlink:href","data:image/ png;base64,"+g).attr("preserveAspectRatio","none"),j&&j.xScale(k).yScale(l).dispatcher(m)(b),n.on("_redraw",c).on("_regionchange",function(){}).on("_integrate",function(){}).on("_segment",function(){}).on("_remove",function(){m.on("regionchange.line."+d,null),m.on("redraw.line."+d,null),g=null,j&&j.remove()});var d=++m.idx;return m.on("regionchange.line."+d,n.on("_regionchange")),m.on("redraw.line."+d,n.on("_redraw")),n}function c(){if(o){var a=k.copy().domain(q.x),b=l.copy().domain(q.y),c=[-Math.min(a(k.domain()[1]),a(k.domain()[0])),-Math.min(b(l.domain()[1]),b(l.domain()[0]))],d=[Math.abs((q.x[0]-q.x[1])/(k.domain()[0]-k.domain()[1])),Math.abs((q.y[0]-q.y[1])/(l.domain()[0]-l.domain()[1]))];o.attr("transform","scale("+d+")translate("+c+")")}}function d(){o&&(o.attr("xlink:href","data:image/ png;base64,"+g),c())}var e=a("../elem"),f=e.SVGElem()["class"]("spec-img");e.inherit(b,f);var g,h,i,j,k,l,m,n,o,p,q={};return b.datum=function(a){return arguments.length?(g=a,d(),b):g},b.range=function(a){return arguments.length?(q=a,b):q},b.crosshair=function(c){return arguments.length?(j=c?a("./crosshair-2d")():!1,b):j},b.s_id=function(a){return arguments.length?(h=a,b):h},b.label=function(a){return arguments.length?(i=a,b):i},b.lineIdx=function(){return p},b}},{"../elem":19,"./crosshair-2d":16}],19:[function(a,b,c){function d(a,b){for(var c in b)"function"==typeof b[c]&&d3.rebind(a,b,c)}function e(a){return a||(a=[]),a.nodes=function(){return this.map(function(a){return a.node()})},a.sel=function(){return d3.selectAll(this.nodes())},a}function f(a){function b(b){return c=b.append(a||"div"),d=b,g&&c.classed(g,!0),c}var c,d,e,f,g;return b.sel=function(){return c},b.node=function(){return c?c.node():void 0},b.parent=function(){return d},b.width=function(a){return arguments.length?(e=a,b):e},b.height=function(a){return arguments.length?(f=a,b):f},b["class"]=function(a){return arguments.length?(g=a,b):g},b.append=function(a){if(!c)throw new Error("Elem is not in DOM");return c.append(a)},b.select=function(a){if(!c)throw new Error("Elem is not in DOM");return c.select(a)},b.selectAll=function(a){if(!c)throw new Error("Elem is not in DOM");return c.selectAll(a)},b.remove=function(){c&&(c.on("remove")&&c.on("remove")(),c.remove())},b.parentApp=function(){for(var a=d;a;){if("function"==typeof a.currentSlide)return a;a=a.parent?a.parent():null}return null},b}function g(a){function b(a){var b=i(a);return b}var c,e,g,h,i=f(a);return b.xScale=function(a){return arguments.length?(c=a,b):c},b.yScale=function(a){return arguments.length?(e=a,b):e},b.datum=function(a){return arguments.length?(g=a,b):g},b.dispatcher=function(a){return arguments.length?(h=a,b):h},d(b,i),b}function h(){function a(a){var c=b(a);return c}var b=g("g");return d(a,b),a}b.exports.inherit=d,b.exports.ElemArray=e,b.exports.Elem=f,b.exports.ResponsiveElem=g,b.exports.SVGElem=h},{}],20:[function(a,b,c){var d={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1,zoom:["x","y",!1]};d.crosshairToggle=function(a){d.crosshair=!d.crosshair,a.slideDispatcher().crosshairEnable(d.crosshair)},d.peakpickToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),console.log(d.zoom),d.peakpick=!d.peakpick,a.slideDispatcher().peakpickEnable(d.peakpick)},d.peakdelToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.peakdel=!d.peakdel,a.slideDispatcher().peakdelEnable(d.peakdel)},d.integrateToggle=function(a){d.zoom[0]!==!1&&d.zoom.rotateTo(!1),d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate=!d.integrate,a.slideDispatcher().integrateEnable(d.integrate)},d.zoomToggle=function(a){d.peakpick!==!1&&d.peakpickToggle(a),d.peakdel!==!1&&d.peakdelToggle(a),d.integrate!==!1&&d.integrateToggle(a),d.zoom.rotate(),console.log(d.zoom)};d.registerKeyboard=function(a){console.log(a),d3.select("body").on("keydown",function(){a.slideDispatcher().log("keyCode: "+d3.event.keyCode),80===d3.event.keyCode?d.peakpickToggle(a):68===d3.event.keyCode?d.peakdelToggle(a):73===d3.event.keyCode?d.integrateToggle(a):67===d3.event.keyCode?d.crosshairToggle(a):70===d3.event.keyCode?dispatcher.regionfull(a):90===d3.event.keyCode&&d.zoomToggle(a),a.slideDispatcher().keyboard(d3.event)})},b.exports=d},{}],21:[function(a,b,c){var d={},e=a("./utils").fireEvent;d.num=function(a,b,c,d,e,f){var g=d3.select(document.createElement("label"));return g.classed("param num",!0).text(a).append("input").attr({type:"number",value:"undefined"==typeof b?0:b,min:"undefined"==typeof c?-(1/0):c,max:"undefined"==typeof d?1/0:d,step:"undefined"==typeof e?1:e}).text("undefined"==typeof f?"":f),g.node().getValue=function(){return g.select("input").node().value},function(){return g.node()}},d.checkbox=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param checkbox",!0).append("input").attr("type","checkbox").on("change",function(){e(this,"input")}).node().checked=b?!0:!1,c.append("div").classed("checker",!0),c.append("div").classed("label",!0).text("string"==typeof a?a:""),c.node().getValue=function(){return c.select("input").node().checked},function(){return c.node()}},d.checkbox_toggle=function(a,b,c){var f=d3.select(document.createElement("div")).classed("param checkbox-toggle",!0);return f.append(d.checkbox(a,b)).select("input").on("change",function(){f.select(".div_enable").classed("disabled",!this.checked),e(this,"input")}),f.append(d.div(c)).classed("div_enable",!0).classed("disabled",!f.select("input").node().checked),f.node().getValue=f.select(".param.checkbox").node().getValue,function(){return f.node()}},d.select=function(a,b,c){var d=d3.select(document.createElement("label")).classed("param select",!0).text(a),e=d.append("select");return e.selectAll("option").data(b).enter().append("option").text(function(a){return a}),e.node().value=c,d.node().getValue=function(){return e.node().value},function(){return d.node()}},d.select_multi=function(a,b){var c=d3.select(document.createElement("div")).classed("param select-multi",!0);return c.append("label").text(a).append("input").attr("type","checkbox").style("display","none").on("change",function(){c.select("ul").classed("shown",this.checked)}).node().checked=!1,c.append("ul").classed("block-list",!0).selectAll("li").data(b).enter().append("li").each(function(a){d3.select(this).append(d.checkbox(a,!0))}),c.node().getValue=function(){return c.selectAll(".param.checkbox").filter(function(){return this.children[0].checked})[0].map(function(a){return"undefined"!=typeof a.value?a.value:d3.select(a).select(".label").text()})},function(){return c.node()}},d.select_toggle=function(a,b){console.log(a,b);var c=d3.select(document.createElement("div")).classed("param select-toggle",!0);c.append(d.select(a,Object.keys(b))).selectAll("option").attr("value",function(a){return a}).text(function(a){return b[a][0]});var f=c.append("div").classed("method_params",!0),g=c.select("select").node();return c.select("select").on("input",function(){d3.event.stopPropagation()}).on("change",function(){f.select("fieldset").remove(),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),e(this.parentNode,"input")}),Object.keys(b[g.value][1]).length>0&&f.append("fieldset").append(d.div(b[g.value][1])),c.node().getValue=function(){return g.value},function(){return c.node()}},d.button=function(a){var b=d3.select(document.createElement("input")).classed("param btn",!0).attr("type","button").attr("value",a).on("click",function(){e(this,"input")});return b.node().getValue=function(){return d3.event&&d3.event.target===b.node()},function(){return b.node()}},d.threshold=function(b,c,e){console.log("app: ",e);var f=d3.select(document.createElement("div")).classed("param threshold",!0),g=f.append("input").attr("type","hidden"),h=f.append("input").attr("type","text").attr("readonly","readonly");return f.insert(d.button(b),":last-child").on("click",function(){var b=d3.selectAll(".nanoModalOverride:not([style*='display: none'])").style("display","none"),c=a("./d1/threshold")();c(e.currentSlide().specContainer(),function(a){h.attr("value",a.toExponential(2)),g.attr("value",a),b.style("display","block")})}),f.node().getValue=function(){return g.node().value},function(){return f.node()}},d.div=function(a,b){var c=d3.select(document.createElement("div"));for(var d in a){var e=a[d];"function"!=typeof e&&(c.append(f.apply(null,e.concat(b))).node().id=d)}return function(){return c.node()}};var f=function(a,b,c,e){var f=[d.num,d.checkbox,d.text,d.select_toggle,d.checkbox_toggle,d.button,d.threshold][b],g=[a].concat(c);return g=6===b?g.concat(e):g,f.apply(null,g)};d.spectrumSelector=function(a){var b=a.currentSlide().spectra(),c=a.currentSlide().specContainer();if(0===b.length)return function(){return d3.select(document.createElement("div")).text("No Spectra to show").node()};var e=d3.select(d.select_multi("Select Spectrum",b)()).classed("spec-selector",!0);return e.selectAll("li").each(function(a){d3.select(this).select(".checkbox").style("color",getComputedStyle(a.select("path").node()).stroke).select(".label").text(a.label()),d3.select(this).on("mouseenter",function(){c.highlightSpec(a)}).on("mouseleave",function(){c.highlightSpec()})}),e.node().getValue=function(){return e.selectAll("li").filter(function(){return d3.select(this).select("input").node().checked===!0}).data().map(function(a){return a.s_id()})},e.node().id="sid",function(){return e.node()}},d.preview=function(a){var b={prev_auto:["Instant Preview",1,"undefined"!=typeof a],prev_btn:["Preview",5,null]};return d.div(b)},d.popover=function(a){var b=d3.select(document.createElement("div")).classed("popover right",!0);b.append("div").classed("arrow",!0);var c=b.append("div").classed("popover-inner",!0);return c.append("h3").classed("popover-title",!0).text(a),c.append("div").classed("popover-content",!0),function(){return b.node()}},b.exports=d},{"./d1/threshold":15,"./utils":35}],22:[function(a,b,c){function d(a){return a.enter().append("li").text(function(a){return a.label}).classed("menu-item",!0).classed("not1d",function(a){return a.nd&&a.nd.indexOf(1)<0}).classed("not2d",function(a){return a.nd&&a.nd.indexOf(2)<0}),a}function e(a){var b=a.filter(function(a){return a.children}).classed("openable",!0).append("div").append("ul").selectAll("li").data(function(a){return a.children}).call(d);b.filter(function(a){return a.children}).size()>0&&e(b)}function f(a){function b(a){a.select(".menu-container").remove();var b=a.append(g.popover("Menu")).classed("menu-container",!0).select(".popover-content").append("div").classed("main-menu",!0).append("ul").classed("nav",!0);b.selectAll("li").data(c).call(d).call(e),b.selectAll("li").on("click",function(b){b.fun?(h.fireEvent(a.node(),"click"),b.fun()):this.focus()})}var c;return b.data=function(a){return arguments.length?(c=a,b):c},b}var g=a("../input_elem"),h=a("../utils");b.exports=f},{"../input_elem":21,"../utils":35}],23:[function(a,b,c){var d=a("../utils"),e=a("../../lib/bootstrap-tooltip").bootstrap;b.exports=function(b){function c(){if(d3.event.target===this){var a=d3.select(this).toggleClass("opened");a.select(".tooltip").style("display",a.classed("opened")?"none":null)}}var f=a("./main_menu")(b),g=a("./spectra")(b),h=a("./slides")(b),i=a("./menu_data")(b),j=a("./serverside-menu"),k=[["open-menu","Menu"],["open-spec-legend","Spectra"],["open-slides","Slides"],["open-settings","Settings"],["open-download","Download Spectra"],["open-fullscreen","Fullscreen App"],["connection-status","Connection Status"]],l=b.append("div").classed("column-menu",!0);l.selectAll("div").data(k).enter().append("div").attr("class",function(a){return a[0]}).attr("title",function(a){return a[1]}).call(e.tooltip().placement("right")).on("click",c),l.select(".open-menu").call(f.data(i));var m=b.dispatcher();return l.select(".open-fullscreen").on("click",function(){d.fullScreen.toggle(b.node()),c.apply(this)}),d3.select(window).on("resize.fullscreenbutton",function(){l.select(".open-fullscreen").classed("opened",d.fullScreen.isFull())}),m.on("menuUpdate.menu",function(){l.select(".open-menu").call(f)}),m.on("slideChange.menu",function(a){var b=2===a.nd;l.select(".open-menu").classed("d1",!b).classed("d2",b),l.select(".open-spec-legend").call(g),l.select(".open-slides").call(h)}),m.on("slideContentChange.menu",function(){l.select(".open-spec-legend").call(g)}),j(b,i),l}},{"../../lib/bootstrap-tooltip":1,"../utils":35,"./main_menu":22,"./menu_data":24,"./serverside-menu":25,"./slides":26,"./spectra":27}],24:[function(a,b,c){function d(a){var b=a.modals();return[{label:"Processing"},{label:"Analysis",children:[{label:"Peak Picking",children:[{label:"Manual peak picking",fun:e.peakpickToggle},{label:"View/manage peak table",fun:null},{label:"Delete peaks",fun:e.peakdelToggle}]}]},{label:"View",children:[{label:"Change region",children:[{label:"Set X region",fun:b.xRegion},{label:"Set Y region",fun:b.yRegion},{label:"Full spectrum",fun:null,children:[{label:"Error",fun:function(){b.error("error message")}}]},{label:"Reverse Spectrum",fun:null},{label:"Invert Phases",fun:null}]}]},{label:"Integration",fun:e.integrateToggle},{label:"crosshair",fun:e.crosshairToggle},{label:"Selected",fun:function(){},children:[{label:"Scale",fun:b.scaleLine}]}]}var e=a("../events");b.exports=d},{"../events":20}],25:[function(a,b,c){b.exports=function(b,c){function d(a,b){for(var c=a.length-1;c>=0;c--)if(a[c].label===b)return a[c].children||(a[c].children=[]),a[c];return a.push({label:b,children:[]}),a[a.length-1]}function e(a){return a.args?function(){b.modals().methods(a.fun,a.args,a.title)()}:function(){b.pluginRequest(a.fun)}}var f=a("../pro/ajax");f.getJSON("/nmr/test",function(a){for(var f=a,g=0;g<a.length;g++){for(var h=d(c,f[g].menu_path[0]),i=1;i<f[g].menu_path.length;i++)h=d(h.children,f[g].menu_path[i]);h.children=null,h.fun=e(f[g]),h.nd=f[g].nd}b.dispatcher().menuUpdate()})}},{"../pro/ajax":29}],26:[function(a,b,c){var d=a("../input_elem");b.exports=function(a){function b(b){b.select(".menu-container").remove();var c=b.append(d.popover("Slides")).classed("menu-container",!0).select(".popover-content");return c.append("ul").classed("block-list slide-list",!0).selectAll("li").data(a.slides).enter().append("li").text(function(a,b){return"Slide "+(b+1)}).on("click",function(b){a.dispatcher().slideChange(b)}),b}return b}},{"../input_elem":21}],27:[function(a,b,c){function d(a){function b(b){b.select(".menu-container").remove();var c=b.append(e.popover("Spectra")).classed("menu-container",!0).select(".popover-content"),d=e.spectrumSelector(a);if(a.currentSlide()&&0!==a.currentSlide().spectra().length){var f=d3.select(d()).select("ul");c.append(function(){return f.node()}).classed("block-list spec-list no-checkbox",!0)}else c.append(d);return b}return b}var e=a("../input_elem");b.exports=d},{"../input_elem":21}],28:[function(a,b,c){function d(b){var c={};return c.proto=function(a,c,d,f){var g=e(c,{overlayClose:!1,autoRemove:!0,buttons:[{text:"OK",handler:d,primary:!0},{text:"Cancel",handler:f?f:"hide",classes:"cancelBtn"}]});if(!b)return void console.log("App is not defined. Initialize the modal module first.");b.append(function(){return g.overlay.el}),b.append(function(){return g.modal.el});var h=d3.select(g.modal.el);return h.insert("div",":first-child").classed("title",!0).text(a?a:"Dialogue"),h.on("keydown",function(){13===d3.event.keyCode&&d3.select(g.modal.el).select(".nanoModalBtnPrimary").node().click(),27===d3.event.keyCode&&d3.select(g.modal.el).select(".cancelBtn").node().click()}),g.onShow(function(){h.style({display:"flex","flex-direction":"column","margin-left":-h.node().clientWidth/2,"max-width":.8*h.node().parentNode.clientWidth,"max-height":.8*h.node().parentNode.clientHeight});var a=d3.behavior.drag().on("drag",function(){h.style("top",d3.event.sourceEvent.pageY+"px").style("left",d3.event.sourceEvent.pageX+"px")});d3.select(g.modal.el).select(".title").call(a),d3.select(g.modal.el).select(".cancelBtn").node().focus()}),g},c.error=function(a,b){var d=c.proto("Error: "+a,b);d3.select(d.modal.el).classed("errorModal",!0).select(".cancelBtn").text("Dismiss"),d.show()},c.range=function(a,b,d,f){var g;g=b[0]>b[1]?[b[1],b[0]]:b,g=[d3.round(g[0],3),d3.round(g[1],3)],"undefined"==typeof f?f=g:(f[0]>f[1]&&(f=[f[1],f[0]]),f=[d3.round(f[0],3),d3.round(f[1],3)]);var h=a+'<input type="number" id="range0" step="0.001" value='+f[0]+" min="+g[0]+" max="+g[1]+'> - <input type="number" id="range1" step="0.001" value='+f[1]+" min="+g[0]+" max="+g[1]+">",i=c.proto("Range",h,function(a){a.hide();var c=d3.select(a.modal.el).selectAll("input")[0].map(function(a){return+a.value});c[0]<g[0]||c[0]>g[1]||c[1]<g[0]||c[1]>g[1]||c[0]>c[1]?e("Invalid input."+c).show():d(b[0]>b[1]?c.reverse():c)});return i.show},c.input=function(a,b,d){var e=a+'<input type="number" id="input0" step="0.001" value='+b+">",f=c.proto("Numeric",e,function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;d(b)});return f.show},c.xRegion=function(){c.range("Set x region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.x,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({xdomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().xScale.domain())()},c.yRegion=function(){c.range("Set y region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.y,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({ydomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().yScale.domain())()},c.slider=function(a,b,d){var e=a+'<input id="slider" type="range" min="-5" max="5" value="0" step="0.001"/>',f=c.proto("Slider",e,function(a){a.hide()},function(){d(0)});return d3.select(f.modal.el).select("#slider").on("input",function(){d(+this.value)}),f.show},c.scaleLine=function(){c.slider("Scale spectrum by a factor:",0,function(a){d3.select(".selected").node().setScaleFactor(Math.pow(2,a))})()},c.methods=function(d,e,f,g,h){var i,j=!0,k=function(b){j=!1,a("./utils").fireEvent(i.node(),"input"),b.hide()},l=c.proto(f,"",k);i=d3.select(l.modal.el).select(".nanoModalContent");var m=null;i.on("input",function(){var a={};i.selectAll(".param").filter(function(){return""!==this.id}).each(function(){a[this.id]=this.getValue()}),m&&clearTimeout(m),j===!1||d3.event.target===i||a.prev_btn===!0?b.pluginRequest(d,a,a.s_id,j):a.prev_auto===!0&&(m=setTimeout(function(){b.pluginRequest(d,a,a.s_id,!0)},300))});var n=a("./input_elem");return i.append(n.spectrumSelector(b)),i.append(n.div(e,b)),i.append(n.preview(!0)),l.show},c}a("nanoModal"),console.log(a("nanoModal")());var e=window.nanoModal;e.customHide=function(a,b){b.modal.el.style.display="block",a()},b.exports=d},{"./input_elem":21,"./utils":35,nanoModal:4}],29:[function(a,b,c){var d=a("../modals"),e=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){var a=4,e=200;d.readyState===a&&d.status===e?"function"==typeof b&&b(d.responseText):d.readyState===a&&c(d.responseText)},d.send()},f=function(a,b,c){var f=g();e(a,function(a){f.stop();var c=JSON.parse(a);"undefined"==typeof c.error?b(c):d.error(c.error.name,c.error.message)},function(a){f.stop(),d.error("Network Error",a)}),c&&f()},g=function(){function a(){e("/nmr/test",function(b){c?ajax("/nmr/test?complete=1"):(d3.select(".progress").text(b),setTimeout(a,100))})}var b,c=!1,d=function(){a()};return d.stop=function(){clearInterval(b),c=!0,d3.select(".progress").text("Completed")},d};b.exports.request=e,b.exports.getJSON=f},{"../modals":28}],30:[function(a,b,c){function d(a,b){var c=a.currentSlide().spectra().filter(function(a){return a.s_id()===b.s_id});0===c.length&&a.modals.error("Incompatible server response","Can't find spectrum with s_id:"+b.s_id),c[0].addPeaks(b.peaks)}function e(a,b){var c=a.currentSlide().spectra().filter(function(a){return a.s_id()===b.s_id});0===c.length&&a.modals.error("Incompatible server response","Can't find spectrum with s_id:"+b.s_id);for(var d=0;d<b.segs.length;d++)c[0].addSegmentl(b.segs[d])}function f(a,b,c){void 0!==b.peaks&&d(a,b,c),void 0!==b.segs&&e(a,b,c)}function g(b,c,d){a("./process_data").process_spectrum(c,b.currentSlide().addSpec)}b.exports.spectrum=g,b.exports.spec_feature=f},{"./process_data":32}],31:[function(a,b,c){b.exports=function(b){function c(c,e,f,g){if(e=e||{},!e.sid)if(f)e.sid=f;else{var h=b.currentSlide().spectra(!0);e.sid=h.map(function(a){return a.s_id()})}0===e.sid.length&&b.modals.error("No Spectra selected","Please select one or more spectra!");var i=c+"_",j="sid="+JSON.stringify(e.sid)+"&preview="+ +g+"&"+i+"=null";for(var k in e)"sid"!==k&&(j.length>0&&(j+="&"),j+=i+k+"="+e[k]);var l="/nmr/plugins?"+j,m=a("./ajax");m.getJSON(l,function(a){d(a,g)})}function d(c,e){if(c.constructor!==Array){var f=a("./plugin-hooks"),g=c.data_type;void 0===g&&(g="spectrum"),"function"==typeof f[g]?f[g](b,c,e):b.modals.error("Unsupported data-type","Couldn't find suitable function to read \""+g+'" data')}else for(var h=c.length-1;h>=0;h--)d(c[h])}return c}},{"./ajax":29,"./plugin-hooks":30}],32:[function(a,b,c){function d(b,c){if(console.log("processing"),b.constructor!==Array)switch(b.format){case"xy":f(b,c);break;case"base64":g(b,c);break;case"png":case"png16":a("./worker").maxWorkers()>0?i(b,c):h(b,c)}else for(var e=b.length-1;e>=0;e--)d(b[e],c)}function e(b,c){var e=a("./ajax");e.getJSON(b,function(a){d(a,c)})}var f=function(a,b){var c=a.x.map(function(b,c){return{x:b,y:a.y[c]}});b(c)},g=function(a,b){var c=atob(a.y);console.log(c);var d=d3.scale.linear().range(a.x_domain).domain([0,c.length]),e=d3.scale.linear().range(a.y_domain).domain([0,255]),f=c.map(function(a,b){return{x:d(b),y:e(a)}});b(f)},h=function(a,b){if(a.nd&&1!=a.nd)2==a.nd?b(a):console.log("Unsupported data dimension: "+a.nd);else{var c=document.createElement("img");c.onload=function(){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var e=d.getContext("2d");e.drawImage(c,0,0);var f=e.getImageData(0,0,c.width,c.height).data,g=[],h="png16"==a.format,i=h?f.length/2:f.length,j=d3.scale.linear().range(a.y_domain).domain([0,255]);h&&j.domain([0,Math.pow(2,16)-1]);for(var k=0;i>k;k+=4)h?g.push(j((f[k+i]<<8)+f[k])):g.push(j(f[k]));if(a.x_domain){var l=d3.scale.linear().range(a.x_domain).domain([0,g.length]);g=g.map(function(a,b){return{x:l(b),y:a}})}var m;m="undefined"!=typeof a.s_id?{data:g,s_id:a.s_id}:{data:g},b(m)};var d=a.data?a.data:a.y;c.src="data:image/png;base64,"+d}},i=function(b,c){if(b.nd&&1!=b.nd)2==b.nd?c(b):console.log("Unsupported data dimension: "+b.nd);else{var d=document.createElement("img");d.onload=function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f={};f._16bit="png16"==b.format;var g=e.getContext("2d");g.drawImage(d,0,0),f.buffer=g.getImageData(0,0,d.width,d.height).data,f.y_range=b.y_domain,f.y_domain=[0,255],f._16bit&&(f.y_domain=[0,Math.pow(2,16)-1]);var h=function(a){console.log("worker done");var d=[].slice.call(a.data);if(b.x_domain){var e=d3.scale.linear().range(b.x_domain).domain([0,d.length]);d=d.map(function(a,b){return{x:e(b),y:a}})}b.data=d,c(b)},i=[f,[f.buffer.buffer]];a("./worker").addJob({message:i,callback:h})};var e=b.data?b.data:b.y;d.src="data:image/png;base64,"+e}};b.exports.get_spectrum=e,b.exports.process_spectrum=d},{"./ajax":29,"./worker":33}],33:[function(a,b,c){
function d(){var a=function(){function a(a,b){var c=b[1]-b[0],d=a[1]-a[0];return function(e){return(e-b[0])/c*d+a[0]}}self.onmessage=function(b,c){b=b.data;for(var d=b.buffer,e=b._16bit?d.length/2:d.length,f=a(b.y_range,b.y_domain),g=new Float64Array(e/4),h=0;e>h;h+=4)b._16bit?g[h/4]=f((d[h+e]<<8)+d[h]):g[h/4]=f(d[h]);self.postMessage(g,[g.buffer])}},b=new Blob(["("+a.toString()+")()"],{type:"application/javascript"}),c=window.URL.createObjectURL(b),d=new Worker(c);return d}function e(a){var b=k.shift();b&&(a.hasJob=!0,a.onmessage=function(c){var d=b.callback;a.hasJob=!1,e(a),d(c)},a.postMessage(b.message[0],b.message[1]))}function f(a){k.push(a);var b=g();"undefined"!=typeof b&&e(b)}function g(){for(var a=0;a<i.length;a++)if(!i[a].hasJob)return i[a];if(i.length<j){var b=d();return i.push(b),b}return void 0}function h(a){return arguments.length?void(j=a):j}var i=[],j=(navigator.hardwareConcurrency||2)-1,k=[];b.exports.addJob=f,b.exports.maxWorkers=h},{}],34:[function(a,b,c){b.exports=function(){function b(c){if(j=c,e){h=b.width(),i=b.height();var n=20,o={top:10+n,right:40,bottom:40,left:10+n},p=h-o.left-o.right,q=i-o.top-o.bottom,r=d3.scale.linear().range([0,p]),s=d3.scale.linear().range([q,0]),t=d3.svg.axis().scale(r).orient("bottom"),u=d3.svg.axis().scale(s).orient("right").tickFormat(d3.format("s")),v=d3.svg.axis().scale(r).orient("bottom").innerTickSize(q).tickFormat(""),w=d3.svg.axis().scale(s).orient("right").innerTickSize(p).tickFormat(""),x=e.nd&&2===e.nd;m.idx=0,g=c.append("svg").classed("spec-slide",!0).attr({width:h,height:i}),f=d(g).attr("transform","translate("+o.left+","+o.top+")").attr({width:h,height:i});var y=f.append("defs");if(y.append("clipPath").attr("id",l).append("rect").attr("width",p).attr("height",q),x){var z=1;a("bowser").safari&&(z*=2);var A=y.append("filter").attr("id","2dColorFilter");A.append("feColorMatrix").attr("type","matrix").attr("values","1 0 0 0 0	0 0 0 0 0 1 0 0 0 0 0 0 0 1 0");var B=A.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");B.append("feFuncR").attr("type","linear").attr("slope",-z).attr("intercept","0.5"),B.append("feFuncB").attr("type","linear").attr("slope",z).attr("intercept","-0.5"),B=A.append("feComponentTransfer").attr("color-interpolation-filters","sRGB"),B.append("feFuncR").attr("id","rfunc").attr("type","linear").attr("slope","1"),B.append("feFuncB").attr("id","bfunc").attr("type","linear").attr("slope","1"),A.append("feColorMatrix").attr("type","matrix").attr("values","-10 0 0 0 1 -10 0 -10 0 1 0 0 -10 0 1 0 0 0 1 0")}f.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")"),f.append("g").attr("class","y axis").attr("transform","translate("+p+",0)"),f.append("g").classed("x grid",!0),f.append("g").classed("y grid",!0),f.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",p/2).attr("y",q).attr("dy","2.8em").text("Chemical shift (ppm)"),f.append("text").attr("class","y label").attr("text-anchor","end").attr("y",p).attr("dy","-.75em").attr("transform","rotate(-90)").text("Intensity"),m.on("redraw.slide",function(a){a.x&&(f.select(".x.axis").call(t),c.options.grid.x&&f.select(".x.grid").call(v)),a.y&&(f.select(".y.axis").call(u),c.options.grid.y&&f.select(".y.grid").call(w))}),k=x?a("./d2/spec-container-2d")():a("./d1/spec-container-1d")(),k.datum(e).xScale(r).yScale(s).width(p).height(q).dispatcher(m)(b),a("./d1/scale-brush")().xScale(r).dispatcher(m)(b),a("./d1/scale-brush")().yScale(s).dispatcher(m)(b),d3.rebind(b,k,"spectra","addSpec","changeRegion","range")}}var c=a("./elem"),d=c.Elem("g");c.inherit(b,d);var e,f,g,h,i,j,k,l=a("./utils").guid(),m=d3.dispatch("rangechange","regionchange","regionfull","redraw","specDataChange","mouseenter","mouseleave","mousemove","click","keyboard","peakpickEnable","peakdelEnable","peakpick","peakdel","integrateEnable","integrate","integ_refactor","crosshairEnable","blindregion","log");return b.show=function(a){g.classed("active",a)},b.nd=function(){return e?e.nd&&2===e.nd?2:1:0},b.clipId=function(){return l},b.slideDispatcher=function(){return m},b.specContainer=function(){return k},b.datum=function(a){return arguments.length?(e=a,b):e},b.parent=function(){return j},b}},{"./d1/scale-brush":13,"./d1/spec-container-1d":14,"./d2/spec-container-2d":17,"./elem":19,"./utils":35,bowser:2}],35:[function(a,b,c){function d(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function e(a){d()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():h(a)}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}Array.prototype.subset=function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push(this[a[c]]);return b},Array.prototype.rotate=function(a){return a?this.push(this.shift()):this.unshift(this.pop()),this},Array.prototype.rotateTo=function(a){for(;this[0]!==a;)this.rotate();return this},Array.prototype.whichMax=function(){if(!this.length||0===this.length)return null;if(1===this.length)return 0;for(var a=this[0].y,b=0,c=1;c<this.length;c++)this[c].y>a&&(b=c,a=this[c].y);return b},Array.prototype.cumsum=function(){for(var a=[this[0]],b=0,c=this.length-1;c>b;b++)a[b+1]=a[b]+this[b+1];return a},d3.selection.prototype.selectP=function(a){for(var b=this.node().parentNode;b;){if(b.matches(a))return d3.select(b);b=b.parentNode}return null},d3.selection.prototype.toggleClass=function(a){return this.classed(a,!this.classed(a))},d3.selection.prototype.size=function(){var a=0;return this.each(function(){++a}),a};var g=function(a,b){if(document.createEventObject){var c=document.createEventObject();return a.fireEvent("on"+b,c)}var c=document.createEvent("HTMLEvents");return c.initEvent(b,!0,!0),!a.dispatchEvent(c)},h=function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},i=function(a,b,c){var d=a.length*(b[0]-b[1])/(c[0]-c[1]),e=a.length*(b[0]-c[0])/(c[1]-c[0]);return{start:e,end:e+d}},j=function(a,b,c){var d=i(a,b,c);return a.slice(d.start,d.end)},k=function(b,c,d){var e=Math.abs(c.domain()[0]-c.domain()[1]),f=Math.abs(c.range()[0]-c.range()[1]);ppm_per_pixel=e/f,d*=ppm_per_pixel;var g=a("simplify")(b,d);return g};b.exports.fireEvent=g,b.exports.fullScreen={},b.exports.fullScreen.launch=h,b.exports.fullScreen.toggle=e,b.exports.fullScreen.isFull=d,b.exports.guid=f,b.exports.simplify=k,b.exports.sliceData=j,b.exports.sliceDataIdx=i},{simplify:5}]},{},[6,29,28,19,20,35,33,32,7,10,13,15,12,11,17,18,34]);