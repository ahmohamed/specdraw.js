!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(){"use strict";function a(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function c(a,b,c){var d=b.x,e=b.y,f=c.x-d,g=c.y-e;if(0!==f||0!==g){var h=((a.x-d)*f+(a.y-e)*g)/(f*f+g*g);h>1?(d=c.x,e=c.y):h>0&&(d+=f*h,e+=g*h)}return f=a.x-d,g=a.y-e,f*f+g*g}function d(b,c){for(var d,e=b[0],f=[e],g=1,h=b.length;h>g;g++)d=b[g],a(d,e)>c&&(f.push(d),e=d);return e!==d&&f.push(d),f}function e(a,b){var d,e,f,g,h=a.length,i="undefined"!=typeof Uint8Array?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[];for(j[k]=j[l]=1;l;){for(e=0,d=k+1;l>d;d++)f=c(a[d],a[k],a[l]),f>e&&(g=d,e=f);e>b&&(j[g]=1,m.push(k,g,g,l)),l=m.pop(),k=m.pop()}for(d=0;h>d;d++)j[d]&&n.push(a[d]);return n}function f(a,b,c){if(a.length<=1)return a;var f=void 0!==b?b*b:1;return a=c?a:d(a,f),a=e(a,f)}"function"==typeof define&&define.amd?define(function(){return f}):"undefined"!=typeof b?b.exports=f:"undefined"!=typeof self?self.simplify=f:window.simplify=f}()},{}],2:[function(a,b,c){!function(){"use strict";function b(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function c(a){b()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():j(a)}function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}var e={version:"0.5.2"},f={};e.globals={},e.globals.render=!0;Array.prototype.subset=function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push(this[a[c]]);return b},Array.prototype.rotate=function(a){return a?this.push(this.shift()):this.unshift(this.pop()),this},Array.prototype.rotateTo=function(a){for(;this[0]!==a;)this.rotate();return this},d3.selection.prototype.selectP=function(a){for(var b=this.node().parentNode;b;){if(b.matches(a))return d3.select(b);b=b.parentNode}return null},d3.selection.prototype.toggleClass=function(a){return this.classed(a,!this.classed(a))};var g=function(a){if(!a.length||0===a.length)return null;if(1===a.length)return 0;for(var b=a[0].y,c=0,d=1;d<a.length;d++)a[d].y>b&&(c=d,b=a[d].y);return c};d3.selection.prototype.size=function(){var a=0;return this.each(function(){++a}),a};var h=function(a,b){if(document.createEventObject){var c=document.createEventObject();return a.fireEvent("on"+b,c)}var c=document.createEvent("HTMLEvents");return c.initEvent(b,!0,!0),!a.dispatchEvent(c)},j=function(a){console.log("go full screen"),a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},k=function(a,b,c){var d=a.length*(b[0]-b[1])/(c[0]-c[1]),e=a.length*(b[0]-c[0])/(c[1]-c[0]);return{start:e,end:e+d}},l=function(a,b,c){var d=k(a,b,c);return a.slice(d.start,d.end)},m=function(b,c,d){var e=a("./lib/simplify")(b,(c[0]-c[1])/d);return e},n=function(a){for(var b=[a[0]],c=0,d=a.length-1;d>c;c++)b[c+1]=b[c]+a[c+1];return b},o=function(a){svgAsDataUri(a.node(),{},function(a){var b=document.createElement("a");b.download="spec.svg",b.href=a,b.setAttribute("data-downloadurl",a),b.click()})},p=function(a,b){saveSvgAsPng(a.node(),b)},q=function(){var a="http://nmrshiftdb.org/portal/js_pane/P-Results/nmrshiftdbaction/searchBySpectrumSpec/spectrumtypespectrumsearch/1/suborwhole/whole/spectrum/",b="";d3.select(".peaks").selectAll("text").each(function(){b+=this.childNodes[0].nodeValue+"%0A"});var c=document.createElement("a");c.href=a+b,c.target="_blank",c.click()},r={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1,zoom:["x","y",!1]};r.crosshairToggle=function(a){r.crosshair=!r.crosshair,a.slideDispatcher.crosshairEnable(r.crosshair)},r.peakpickToggle=function(a){r.zoom[0]!==!1&&r.zoom.rotateTo(!1),r.peakdel!==!1&&r.peakdelToggle(a),r.integrate!==!1&&r.integrateToggle(a),console.log(r.zoom),r.peakpick=!r.peakpick,a.slideDispatcher.peakpickEnable(r.peakpick)},r.peakdelToggle=function(a){r.zoom[0]!==!1&&r.zoom.rotateTo(!1),r.peakpick!==!1&&r.peakpickToggle(a),r.integrate!==!1&&r.integrateToggle(a),r.peakdel=!r.peakdel,a.slideDispatcher.peakdelEnable(r.peakdel)},r.integrateToggle=function(a){r.zoom[0]!==!1&&r.zoom.rotateTo(!1),r.peakpick!==!1&&r.peakpickToggle(a),r.peakdel!==!1&&r.peakdelToggle(a),r.integrate=!r.integrate,a.slideDispatcher.integrateEnable(r.integrate)},r.zoomToggle=function(a){r.peakpick!==!1&&r.peakpickToggle(a),r.peakdel!==!1&&r.peakdelToggle(a),r.integrate!==!1&&r.integrateToggle(a),r.zoom.rotate(),console.log(r.zoom)};var s={addinteg:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABtElEQVRIS62WzStFQRiHzy3lc3MX/AWSj0KhlCV7xEJRStn42MgCC7KxsxEWipSNugvKSsrCzldRilIiSlkgVpKP59VM3cY5576nc6aezjkz7/x+M/POzL0pz7+0Ub3nNI3zPR8QH1id8mkppu4I7mASzkxMYgbtCG7DMCxDLVTBATwmMYMlRIZgBOQ9VnGXSL4z0AWtsB9Lnc6uQRF1x1ANjXCqNOgkrgUW4Ta7j2tQQOOhWfcmnidKg1XiBuBfH9eglKALKPMLDjFboG1UY1BJ0KURijIDtUE54tcxDOrpex6WA41BMwKFRuSH5yesmI0xZnKYb03cHFiDdwIasmZj4+WU35gcqfIfZPBA7xp4c1Ty+J6ANHyYNtGQOilybmQX2pIOMngiQhL+ohqm59kk58xBB4JbENXAXi85z0E34nJVyDrLaCQXmqLeptZgE9Ve+NaoExN5Bjt0kvvlS2kwS9y0mXXoOegjaAPsb4FSPzhMdtE9zMAarEM/VIA90bFMxEBOo+yaKZgDWZ5BUx9LXDpbAyu0y0sPvMZWNgJiUAcl8AxXSY3cDtDvX0VSg//T+QW01FzwK6wJAwAAAABJRU5ErkJggg==",delinteg:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABdklEQVRIS92VzysFURiG50p+b2z8AbJANgqFnX8AJRsLq0uRNWUlCxZWxIqUFbFTdspCKFcksVC6ko2NHSvyvDWndJw7c7ozs3Hqaeac+c77znfmO2dyQXybI2TJCuuhfxk/NQhyMUFtPL+HebiGozC+j+t5GgbLiMxCJ9zAANTDMXwkNahB4AraoRcufATtmKglaiS4AA3QBS9pG7Qi+ABvoPv3tA1aEHzM0qAf8dMsDUYR38vSYATx/X9h8EQWHfBpVVElfR0jddZ4Nf01KGo8ah+YJdolbgy+LSHtaJk3OcpXBXLma3BI4JDDQPObocKR2bPJOCqDVYJmQAbD8OV409ihKIN1Zk/BFkyUyCCRgckgj8pmrFKJAJ8lmmbuRtoGMt6GcegGnaplNZOBrvprTcIg6BS9CxVde8DbzBiopm9BZacfywGshBnseKs5Ao2BduUJaIOYtsDNIpRVnkbk90euZVDLUQWvUEzy5i6DNPT+aPwAle1IGSTahDYAAAAASUVORK5CYII=",peakpick:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABxUlEQVRIS+2VPSiFURjH7yUxyEdJiUlZpJgpg0kWBiQyGBhIKZtFhI1BSFFSlI+BmGQjMSgMRkpmZSCR8Ptzzu24rvc96t7NW7/e857znOd/nuc857zRSIqfaIr9R/4FQjPspqgA60Z4dGZl0z6H01BPkUgZNrVwApfW3hXIp7MV5h1nk7SX3AkBQh2MrcAgTCUSsH3TNPrhGsrh2WP1MmmGTeiDuSCBdgZXYRea4C3ZAnYlazhW2L4C2r9t6IbFoAisQFAERTjIdSJTGhX5GMyYPcjUeKKDFiagOYpOBRH6BAkEpWgAzw1w5yjU0S403xs2tfEC+l6GTlAVVcJD6DK/DLyqqATDW8dhFe2LZAp04awHdmACvh2aEKHQCDJwcAQqsX2TIqWpAp48oggVqDYCpbxv4ABqoB72PARasNHmKgML1t5ust465qpnbbAOlz3RvlGkMyfL+HiNF9BmnoFuw0MzmGP6FNEoDHtE8cNEK08z6dCqVcsxddq6i7bMrBHe2viXvwhJYBZ6QXtwnGDyEH3jTr8i0TXu/jd+1ZTAO7TBesDKdAXrjrGPKiv2UwmKSAJ5cO8Rtn5IxaCSvfKw/zT5AMjqYuejWwg8AAAAAElFTkSuQmCC",peakdel:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABqElEQVRIS+2VTShFQRiG3URC5GdjJ1HyU6wsiLtRliwtpPwtiNTNhlIWKBtFrMjKz0axUJRS7CyQUjayQIpYoFCK583cOumcOffo3mycevrmznznfeebmTM3lJTgJ5Rg/aR/A98V9lqiSt6sgReHQgbtbbjxVXUkeBkUk9MGo47cQdqrcBcPA2mkwAmUwSJ0BRGO5tpOkcaWoB36YD7eBtKbgf6/NmhkAutwCqmmymTiPkT8PrRYKmhFaMVl+Q7oC/sZzJHUC92w4LEHmm2my9g7fW82gywSjqHInCKZfAbdaJtBGLE9I3hNLIeneBnIeA0knA2dUA9a10CPVwWFqFxCFai9AbMwEEidZC8DXQs6/6WQB7fwbJbpKoiJm0EOAucwAjo5ylHs+E0VerkEcuEQdEokNAkVcG9mW008Mu0m4k6sVcjgAnQUtRwPRlSzn/ghMsXvIdPXQtw0E7J6yeAMdGOOQYNpO2cfFUijsQu1pkPXdgSWbUYyGIZx85I2sg50r7g96XROQ48Z3CI2w4dXGdFNLiBBF5Vm9Wqt+XtQ+fnwCNZ/uC/qOUsdSEVD5wAAAABJRU5ErkJggg==",refpick:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAB9klEQVRIS+WVTSilURjHWdBEkY+NnUQmH0UW1AgLCwsLylaKWJhIyYIpJRmRKEKJKImyMBYWPmJhITNCysdGFkiZxgJRZur6/afz6nW7133v7Vo59es599znPP/nfD1vaMg7t9AA42veVxiCVTiFUuiDUXiy4gYqoPmaOw8rMAZRsAUjMBwMAcWYgG2bwB79TpgKlsAggfJgGtTvhS649Vcgkwm5cG9NxEZCMRxCHFRAKjzYfP7vo5OWjFMltNucm+jnwKbZkh3skfH75+8K5B8G+5AG2vtaWIdZ0CF/hmNohv5ABLTaSagCXdG/JvAvbAPosMtgAVqhB1xOt8hKSAepYBLQdfTZPp6AXmi9OeBxn/uDgz9bpFKgl5oE1i1y+RLxR6CIYBsm4AU2HV5erDchpwLymwMFjoYaKAA9sjebU4FEopxBFqj/A1SqG4MloLKg+6/XqrpzBXdmm87fEnGyghgCnMA30M3RHNlqJ6vwJJDCxFj4CbolCtQNGfDbZJuN3TX9Euyyt1W4C3zCUeVXV1Hb8ccEVfbf3YKo9reYsXLsoknolZu7QAT/qnipYnZAoenbs7cCKJk1+GIGrrGqpDN2IU9b1IaDvkpqOsh8OHDL3vqphAagzgwsYVVRfX4PEnAKB2X16CW4fVj+8XADl/Y/ngGM/GMZMjMjNAAAAABJRU5ErkJggg=="},t=function(a){console.log(a),d3.select("body").on("keydown",function(){a.slideDispatcher.log("keyCode: "+d3.event.keyCode),80===d3.event.keyCode?r.peakpickToggle(a):68===d3.event.keyCode?r.peakdelToggle(a):73===d3.event.keyCode?r.integrateToggle(a):67===d3.event.keyCode?r.crosshairToggle(a):70===d3.event.keyCode?dispatcher.regionfull(a):90===d3.event.keyCode&&r.zoomToggle(a),a.slideDispatcher.keyboard(d3.event)})},u=a("./src/modals"),v=a("./src/elem");e.menu=function(){function a(a){if(d3.event.target===this){var b=d3.select(this).toggleClass("opened");b.select(".tooltip").style("display",b.classed("opened")?"none":null)}}function d(d){var g=[["open-menu","Menu"],["open-spec-legend","Spectra"],["open-slides","Slides"],["open-settings","Settings"],["open-download","Download Spectra"],["open-fullscreen","Fullscreen App"],["connection-status","Connection Status"]],h=d.append("div").classed("column-menu",!0);h.selectAll("div").data(g).enter().append("div").attr("class",function(a){return a[0]}).attr("title",function(a){return a[1]}).call(bootstrap.tooltip().placement("right")).on("click",a),h.select(".open-menu").call(e.menu.main_menu());var i=d.node().dispatcher;return h.select(".open-fullscreen").on("click",function(b){c(d.node()),a.apply(this)}),d3.select(window).on("resize.fullscreenbutton",function(){h.select(".open-fullscreen").classed("opened",b())}),i.on("menuUpdate.menu",function(){h.select(".open-menu").call(e.menu.main_menu())}),i.on("slideChange.menu",function(){var a=2==d.select(".spec-slide.active").node().nd;h.select(".open-menu").classed("d1",!a).classed("d2",a),h.select(".open-spec-legend").call(e.menu.spectra()),h.select(".open-slides").call(e.menu.slides())}),i.on("slideContentChange.menu",function(){h.select(".open-spec-legend").call(e.menu.spectra())}),f.read_menu(d.node(),e.menu.menu_data),h}return d},e.menu.main_menu=function(){function a(a){return a.enter().append("li").text(function(a){return a.label}).classed("menu-item",!0).classed("not1d",function(a){return a.nd&&a.nd.indexOf(1)<0}).classed("not2d",function(a){return a.nd&&a.nd.indexOf(2)<0}),a}function b(c){var d=c.filter(function(a){return a.children}).classed("openable",!0).append("div").append("ul").selectAll("li").data(function(a){return a.children}).call(a);d.filter(function(a){return a.children}).size()>0&&b(d)}function c(c){c.select(".menu-container").remove();var d=c.append(v.popover("Menu")).classed("menu-container",!0).select(".popover-content").append("div").classed("main-menu",!0).append("ul").classed("nav",!0);d.selectAll("li").data(e.menu.menu_data).call(a).call(b),d.selectAll("li").on("click",function(a){a.fun?(h(c.node(),"click"),a.fun()):this.focus()})}return c},e.menu.spectra=function(){function a(a){a.select(".menu-container").remove();var b=a.append(v.popover("Spectra")).classed("menu-container",!0).select(".popover-content"),c=d3.select(v.spectrumSelector()()).select("ul");return 0===c.size()?b.append(v.spectrumSelector()):b.append(function(){return c.node()}).classed("block-list spec-list no-checkbox",!0),a}return a},e.menu.slides=function(){function a(a){var b=a.selectP(".spec-app");a.select(".menu-container").remove();var c=b.selectAll(".spec-slide"),d=a.append(v.popover("Slides")).classed("menu-container",!0).select(".popover-content");return d.append("ul").classed("block-list slide-list",!0).selectAll("li").data(c[0]).enter().append("li").text(function(a,b){return"Slide "+(b+1)}).on("click",function(a){c.classed("active",!1),d3.select(a).classed("active",!0),b.node().dispatcher.slideChange()}),a}return a},e.menu.menu_data=[{label:"Processing"},{label:"Analysis",children:[{label:"Peak Picking",children:[{label:"Manual peak picking",fun:r.peakpickToggle},{label:"View/manage peak table",fun:null},{label:"Delete peaks",fun:r.peakdelToggle}]}]},{label:"View",children:[{label:"Change region",children:[{label:"Set X region",fun:u.xRegion},{label:"Set Y region",fun:u.yRegion},{label:"Full spectrum",fun:null,children:[{label:"Error",fun:function(){u.error("error message")}}]},{label:"Reverse Spectrum",fun:null},{label:"Invert Phases",fun:null}]}]},{label:"Integration",fun:r.integrateToggle},{label:"crosshair",fun:r.crosshairToggle},{label:"Selected",fun:function(){},children:[{label:"Scale",fun:u.scaleLine}]},{label:"Export",children:[{label:"As PNG",fun:function(){setTimeout(function(){p(svg.selectP("svg"),"specdraw.png")},500)}},{label:"As SVG",fun:function(){setTimeout(function(){o(svg.selectP("svg"),"specdraw.svg")},500)}},{label:"Search NMRShiftDB",fun:q},{label:"CSV",fun:function(){}},{label:"Peak table",fun:function(){}},{label:"JCAMP-DX",fun:function(){}}]}],e.d1={},e.d1.threshold=function(){function a(a){b=a.append("path").attr("class","threshold line x").on("_mousemove",function(a){b.attr("d",d3.svg.line()([[c.range()[0],a.ycoor],[c.range()[1],a.ycoor]]))}).on("_click",function(a){f(d.invert(a.ycoor)),b.remove(),e.on("mousemove.thresh."+g,null),e.on("click.thresh."+g,null)});var g=++e.idx;e.on("mousemove.thresh."+g,b.on("_mousemove")),e.on("click.thresh."+g,b.on("_click"))}var b,c,d,e,f;return a.callback=function(b){return arguments.length?(f=b,a):f},a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.d1.crosshair=function(){function a(a){var h=function(a){var b;if(a.shiftKey){var c=[Math.floor(k.invert(a.xcoor-10)),Math.floor(k.invert(a.xcoor+10))];b=c[0]+g(e.slice(c[0],c[1]+1))}else b=Math.floor(k.invert(a.xcoor));return b},j=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),k=c.copy(),l=a.node().line_idx;b=a.append("g").attr("class","crosshair").datum(null).call(j),b.append("circle").attr("class","clr"+l).attr("r",4.5).on("click",function(){a.toggleClass("selected")}).on("mouseenter",function(){a.selectP(".main-focus").classed("dimmed",!0),a.classed("highlighted",!0)}).on("mouseleave",function(){a.selectP(".main-focus").classed("dimmed",!1),a.classed("highlighted",!1)}),b.append("text").attr("x",9).attr("dy","-1em"),b.on("_regionchange",function(a){if(a.x)b.datum(null),b.attr("transform","translate(-1000,-1000)");else{var e=b.datum();e&&b.attr("transform","translate("+c(e.x)+","+d(e.y)+")")}}).on("_mousemove",function(a){var f=h(a);return"undefined"==typeof e[f]?(b.attr("i_pos",null),void b.datum(null)):(j.text(d3.round(e[f].x,3)).show(b.node()),b.attr("i_pos",f),b.datum(e[f]),void b.attr("transform","translate("+c(e[f].x)+","+d(e[f].y)+")"))}),b.node().setData=function(a){e=a},b.node().dataSlice=function(a){return arguments.length?void k.domain(a):k.domain()},b.node().show=function(a){return arguments.length?(b.style("display",a?null:"none"),a?j.show(b):j.hide(),void f.on("mousemove.line."+m,a?b.on("_mousemove"):null)):!("none"===b.style("display"))},b.node().enable=function(a){return arguments.length?(a?(f.on("mouseenter.line."+m,function(){b.node().show(!0)}),f.on("mouseleave.line."+m,function(){b.node().show(!1)})):(f.on("mouseenter.line."+m,null),f.on("mouseleave.line."+m,null)),void b.node().show(a)):params.crosshair},b.node().i=function(a){return arguments.length?(b.attr("i_pos",i),void b.datum(e[i])):b.attr("i_pos")},b.node().remove=function(){f.on("regionchange.line."+m,null),f.on("mouseenter.line."+m,null),f.on("mouseleave.line."+m,null),f.on("mousemove.line."+m,null),f.on("crosshairEnable.line."+m,null),e=null,b.remove()};var m=++f.idx;return f.on("regionchange.line."+m,b.on("_regionchange")),f.on("mouseenter.line."+m,function(){b.node().show(!0)}),f.on("mouseleave.line."+m,function(){b.node().show(!1)}),f.on("mousemove.line."+m,b.on("_mousemove")),f.on("crosshairEnable.line."+m,b.node().enable),b}var b,c,d,e,f;return a.dispatcher=function(b){return arguments.length?(f=b,a):f},a.datum=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.d1.integrate=function(){function b(b){function h(b,c){var d,e;return function(f){var h=f.append("g");d=f.append("path").attr("class","line").datum(b);var j=f.append("g").attr("class","integration-text"),l=j.append("rect");e=j.append("text").datum(c).text((c/i).toFixed(2)).on("focus",function(){}).on("blur",function(){});var m=e.node().getBBox();e.attr("dx",-m.width/2).attr("dy",m.height/2),l.attr("width",m.width+4).attr("height",m.height+4).attr("x",m.x-2).attr("y",m.y-2);var n=a("./src/modals");j.on("mouseenter",function(){l.classed("highlight",!0),d.classed("highlight",!0)}).on("mouseleave",function(){l.classed("highlight",!1),d.classed("highlight",!1)}).on("contextmenu",d3.contextMenu([{title:"Set integral",action:n.input("Set Integral to: ",e.text(),function(a){i=e.datum()/a,g.integ_refactor()})}])),h.on("_redraw",function(){d.attr("d",k);var a=d.node().getPointAtLength(.5*d.node().getTotalLength());j.attr("transform","translate("+a.x+","+a.y+")");var b=e.node().getBBox();l.attr("width",b.width+2).attr("height",b.height+2).attr("x",b.x-1).attr("y",b.y-1)}).on("_refactor",function(){e.text((c/i).toFixed(2));var a=e.node().getBBox();e.attr("dx",-a.width/2),h.on("_redraw")()});var o=++g.idx;g.on("redraw.integ."+o,h.on("_redraw")),g.on("integ_refactor."+o,h.on("_refactor"))}}var i,j=(b.attr("width"),b.attr("height"),20),k=d3.svg.line().x(function(a){return e(a.x)}).y(function(a){return f(a.y/j)-f.range()[0]/2});return d=b.append("g").attr("class","integration"),d.node().addIntegral=function(a){var b=c(a),e=b[b.length-1].y;i||(i=e),d.call(h(b,e))},d}function c(a){var b=n(a.map(function(a){return a.y})),c=a.map(function(a,c){return{x:a.x,y:b[c]}});return c}var d,e,f,g;return b.dispatcher=function(a){return arguments.length?(g=a,b):g},b.xScale=function(a){return arguments.length?(e=a,b):e},b.yScale=function(a){return arguments.length?(f=a,b):f},b},e.d1.line=function(){function a(a){var n,o,p,q=[],r=1,s=d3.svg.line().interpolate("linear").x(function(a){return c(a.x)}).y(function(a){return d(a.y*r)}),t=a.attr("width");h=a.append("g").attr("class","spec-line"),h.attr("clip-path","url(#"+h.selectP(".spec-slide").node().clip_id+")"),h.node().range=i;var u=a.node().nSpecs;h.node().line_idx=u;var v=h.append("path").datum(b).attr("class","line clr"+u);j&&(n=e.d1.crosshair().datum(b).xScale(c).yScale(d).dispatcher(g)(h));var w=e.d1.integrate().xScale(c).yScale(d).dispatcher(g)(h);h.on("_redraw",function(b){if(b.x)v.attr("d",s).attr("transform","scale(1,1)translate(0,0)"),h.selectAll(".segment").attr("d",s);else{var e=(c.copy().domain(a.node().range.x),d.copy().domain(a.node().range.y)),f=[0,-Math.min(e(d.domain()[1]),e(d.domain()[0]))],g=[1,Math.abs((a.node().range.y[0]-a.node().range.y[1])/(d.domain()[0]-d.domain()[1]))];v.attr("transform","scale("+g+")translate("+f+")"),h.selectAll(".segment").attr("transform","scale("+g+")translate("+f+")")}}).on("_regionchange",function(a){if(a.xdomain){var d=k(b,c.domain(),i.x);p=d,o=m(b.slice(p.start,p.end),c.domain(),t),v.datum(o),i.y=d3.extent(o.map(function(a){return a.y})),i.y[0]*=r,i.y[1]*=r,h.selectAll(".segment").remove(),q.forEach(function(a){var b=o.filter(function(b){return b.x<a[0]&&b.x>a[1]});h.append("path").datum(b).attr("class","segment")}),j&&n.node().dataSlice([p.start,p.end])}}).on("_integrate",function(a){var c=l(b,a.xdomain,i.x);w.node().addIntegral(c),h.node().addSegment([c[0].x,c[c.length-1].x]),g.redraw({y:!0})}).on("_segment",function(a){});var x=++g.idx;return g.on("regionchange.line."+x,h.on("_regionchange")),g.on("redraw.line."+x,h.on("_redraw")),g.on("integrate.line."+x,h.on("_integrate")),h.node().specData=function(){return b},h.node().setData=function(a){b=a[0].x?a:a.map(function(a,c){return{x:b[c].x,y:a}}),i.y=d3.extent(b.map(function(a){return a.y})),n&&n.node().setData(b),h.on("_regionchange")({xdomain:c.domain()}),h.on("_redraw")({x:!0})},h.node().dataSlice=function(){return p},h.node().specRange=function(){return i},h.node().s_id=function(a){return arguments.length?void(f=a):f},h.node().setScaleFactor=function(a){return arguments.length?(r=a,void h.on("_redraw")({y:!0})):r},h.node().addPeaks=function(c){a.select(".peaks").node().addpeaks(b.subset(c),u),a.select(".peaks").on("_regionchange")({xdomain:!0}),a.select(".peaks").on("_redraw")({x:!0})},h.node().addSegment=function(a){if(a[0].constructor===Array)for(var b=a.length-1;b>=0;b--)this.addSegment(a[b]);else{q.push(a);var c=o.filter(function(b){return b.x<=a[0]&&b.x>=a[1]});h.append("path").datum(c).attr("class","segment").attr("d",s)}},h.node().addSegmentByIndex=function(a){if(a[0].constructor===Array)for(var c=a.length-1;c>=0;c--)this.addSegmentByIndex(a[c]);else this.addSegment([b[a[0]].x,b[a[1]].x])},h.node().remove=function(){g.on("regionchange.line."+x,null),g.on("redraw.line."+x,null),g.on("integrate.line."+x,null),b=null,j&&n.node().remove(),h.remove()},h}var b,c,d,f,g,h,i={},j=!0;return a.datum=function(c){if(!arguments.length)return b;if(c[0].x)b=c;else{var d=d3.scale.linear().range(svg.node().range.x).domain([0,c.length]);b=c.map(function(a,b){return{x:d(b),y:a}})}return i.x=[b[0].x,b[b.length-1].x],i.y=d3.extent(b.map(function(a){return a.y})),a},a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.crosshair=function(b){return arguments.length?(j=b,a):j},a.s_id=function(b){return arguments.length?(f=b,a):f},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.d1.mainBrush=function(){function a(a){function f(){if(l.empty())return c&&d?l.extent([[0,0],[0,0]]):l.extent([0,0]),b.call(l),null;var a={};return c&&d?(a.xdomain=[l.extent()[1][0],l.extent()[0][0]],a.ydomain=[l.extent()[1][1],l.extent()[0][1]]):(a.xdomain=c?l.extent().reverse():null,a.ydomain=d?l.extent():null),l.clear(),b.call(l),a}function g(){var b=f();b&&a.on("_regionchange")(b)}function h(){var a=f();a&&e.peakdel(a)}function i(){var a=f();a&&e.integrate(a)}function j(){l.clear(),b.call(l)}var k=(a.attr("width"),a.attr("height")),l=d3.svg.brush().x(c).y(d).on("brushend",g);b=a.append("g").attr("class","main-brush").call(l),b.selectAll("rect").attr("height",k),b.select(".background").style("cursor",null).style("pointer-events","all"),a.style("cursor","crosshair"),b.node().peakpickEnable=function(c){b.classed("peakpick-brush",c),a.style("cursor",c?"url("+s.peakpick+"), auto":"crosshair"),l.on("brushend",c?j:g)},b.node().peakdelEnable=function(c){b.classed("peakdel-brush",c),a.style("cursor",c?"url("+s.peakdel+"), auto":"crosshair"),l.on("brushend",c?h:g)},b.node().integrateEnable=function(c){b.classed("integrate-brush",c),a.style("cursor",c?"url("+s.addinteg+"), auto":"crosshair"),l.on("brushend",c?i:g)};var m=++e.idx;return e.on("peakpickEnable.brush."+m,b.node().peakpickEnable),e.on("peakdelEnable.brush."+m,b.node().peakdelEnable),e.on("integrateEnable.brush."+m,b.node().integrateEnable),b}var b,c,d,e;return a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.d1.scaleBrush=function(){function a(a){var i=e?e:f;h=e?e.copy():f.copy(),d=e?"bottom":"top";var j=d3.svg.axis().scale(h).orient(d).tickFormat(d3.format("s")),k=d3.svg.brush().x(h).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brushend",function(){var b=k.empty()?h.domain():k.extent().reverse();b=b.sort(h.domain()[0]>h.domain()[1]?d3.descending:d3.ascending),a.select(".main-focus").on("_regionchange")(e?{xdomain:b}:{ydomain:b})});c=a.append("g").attr("class",(e?"x":"y")+" scale-brush").attr("transform",e?"translate(0,-20)":"translate(-20,0)rotate(90)"),c.append("g").call(j).attr("class","brush-axis"),c.append("g").attr("class","brush").call(k).selectAll("rect").attr("y",-5).attr("height",10),c.select(".background").style("pointer-events","all"),c.on("_rangechange",function(a){(a.x||a.y&&f)&&(h.domain(e?a.x:a.y),c.select(".brush-axis").call(j),c.select(".brush").call(k))}).on("_regionchange",function(a){if(a.xdomain||a.ydomain&&f){var c=b(i.domain(),h.domain());k.extent(c)}}).on("_redraw",function(a){(a.x||a.y&&f)&&c.select(".brush").call(k)});var l=++g.idx;return g.on("rangechange.scalebrush."+l,c.on("_rangechange")),g.on("regionchange.scalebrush."+l,c.on("_regionchange")),g.on("redraw.scalebrush."+l,c.on("_redraw")),c}function b(a,b){var c=[0,0];return a[0]>a[1]?(c[0]=Math.min(a[0],b[0]),c[1]=Math.max(a[1],b[1])):(c[0]=Math.max(a[0],b[0]),c[1]=Math.min(a[1],b[1])),c.join()==b.join()&&(c=[0,0]),c}var c,d,e,f,g,h;return a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.xScale=function(b){return arguments.length?(e=b,a):e},a.yScale=function(b){return arguments.length?(f=b,a):f},a},e.d1.pp=function(){function a(a){var g=[{title:" Delete peak",action:function(a,b,c){f.peakdel({xdomain:[b[0],b[0]]})}}],h=(a.attr("width"),a.attr("height"),[]),i=[];c=a.append("g").attr("class","peaks"),c.on("_click",function(b){r.crosshair||d3.selectAll(".crosshair").each(function(){d3.select(this).on("_mousemove")(b)}),a.selectAll(".crosshair").each(function(){c.node().addpeaks(this.__data__,this.parentNode.line_idx),c.on("_regionchange")({xdomain:!0}),c.on("_redraw")({x:!0,y:!0})})}).on("_regionchange",function(a){if(a.xdomain){var b=d.domain().sort(d3.descending);i=h.filter(function(a){return a[0]<b[0]&&a[0]>b[1]})}}).on("_redraw",function(a){var e=c.selectAll("text").data(i);e.enter().append("text").text(function(a){return d3.round(a[0],3)}).attr("dy","0.35em").attr("focusable",!0).on("focus",function(){}).on("keydown",function(a){68===d3.event.keyCode&&f.peakdel({xdomain:[a[0],a[0]]})}).on("contextmenu",d3.contextMenu(g)),e.exit().remove();var h=c.selectAll(".peak-line").data(i);if(h.enter().append("path").style("fill","none"),h.exit().remove(),0!==i.length){var j,k=[],l=c.select("text").node().getBBox().height;c.selectAll("text").sort(function(a,b){return d3.ascending(a[0],b[0])}).text(function(a){return d3.round(a[0],3)}).attr("class",function(a){return"peak-text clr"+a[2]}).attr("transform",function(a,b){var c=d(a[0]);return c>j-l&&(c=j-l),j=c,k.push(c),"translate("+c+",0)rotate(90)"}).append("title").text("dbl Click to edit"),c.selectAll("path").sort(function(a,b){return d3.ascending(a[0],b[0])}).attr("class",function(a){return"peak-line clr"+a[2]}).attr("d",function(a,c){return b(a[0],a[1],k[c])})}}).on("_peakpick",function(a,b){this.addPeaks(a,b),c.on("_regionchange")({xdomain:!0}),c.on("_redraw")({x:!0,y:!0})}).on("_peakdel",function(a){if(a.xdomain){var b=a.xdomain.sort(d3.descending);h=h.filter(function(a){return!(a[0]<=b[0]&&a[0]>=b[1])})}if(a.ydomain){var b=a.ydomain.sort(d3.descending);h=h.filter(function(a){return!(a[0]<=b[0]&&a[0]>=b[1])})}c.on("_regionchange")({xdomain:d.domain(),ydomain:e.domain()}),c.on("_redraw")({x:!0,y:!0})});var j=++f.idx;return f.on("regionchange.peaks."+j,c.on("_regionchange")),f.on("redraw.peaks."+j,c.on("_redraw")),f.on("peakpickEnable.peaks."+j,function(a){f.on("click.peaks."+j,a?c.on("_click"):null)}),f.on("peakpick.peaks."+j,c.on("_peakpick")),f.on("peakdel.peaks."+j,c.on("_peakdel")),c.node().peaks=function(){return h},c.node().addpeaks=function(a,b){if(a.x)-1==h.indexOf([a.x,a.y])&&h.push([a.x,a.y,b]);else for(var c=a.length-1;c>=0;c--)this.addpeaks(a[c],b)},c}function b(a,b,c){var f=Math.max(e(b)-10,60);return d3.svg.line().defined(function(a){return!isNaN(a[1])})([[c,40],[d(a),60],[d(a),80],[NaN,NaN],[d(a),f-10],[d(a),f]])}var c,d,e,f;return a.dispatcher=function(b){return arguments.length?(f=b,a):f},a.xScale=function(b){return arguments.length?(d=b,a):d},a.yScale=function(b){return arguments.length?(e=b,a):e},a},e.d1.main_focus=function(){function a(a){b=a.append("g").attr("class","main-focus").attr("pointer-events","all").attr("width",c).attr("height",d).call(k).on("dblclick.zoom",null).on("mousedown.zoom",null),b.node().dispatch_idx=0,b.node().nSpecs=0,b.node().xScale=f,b.node().yScale=g,b.node().range=j,b.node().addPeaks=function(a){b.select(".peaks").node().addpeaks(i.subset(a)),b.select(".peaks").on("_regionchange")({xdomain:!0}),b.select(".peaks").on("_redraw")({x:!0})},b.node().addSpecLine=function(a,c,d){c||(c=!0);var i=null,j="spec"+b.node().nSpecs;console.log(a.label),a.constructor!==Array&&("undefined"!=typeof a.s_id&&(i=a.s_id),"undefined"!=typeof a.label&&(j=a.label),a=a.data);var k;if(d&&0!=d.size()?(console.log("overwriting spec"),k=d,k.node().setData(a),i&&k.node().s_id(i)):(k=e.d1.line().datum(a).xScale(f).yScale(g).s_id(i).crosshair(c).dispatcher(h)(b),k.node().label=j),e.globals.render){var l=d3.max(b.selectAll(".spec-line")[0].map(function(a){return a.range.x[0]})),m=d3.min(b.selectAll(".spec-line")[0].map(function(a){return a.range.x[1]})),n=d3.min(b.selectAll(".spec-line")[0].map(function(a){return a.range.y[0]})),o=d3.max(b.selectAll(".spec-line")[0].map(function(a){return a.range.y[1]})),p=o-n;n-=.05*p,o+=.05*p;var q=f.domain();g.domain();b.on("_rangechange")({x:[l,m],y:[n,o],norender:b.node().nSpecs>0}),b.node().nSpecs>0&&b.on("_regionchange")({xdomain:q})}return b.node().nSpecs++,k},b.node().addSpec=b.node().addSpecLine,b.node().nd=1,b.node().getThreshold=function(a){b.call(e.d1.threshold().xScale(f).yScale(g).dispatcher(h).callback(a))},b.on("_redraw",function(a){h.redraw(a)}).on("_regionchange",function(a){if(a.xdomain&&f.domain(a.xdomain),h.regionchange({xdomain:a.xdomain}),a.ydomain)g.domain(a.ydomain),a.zoom||k.scale((j.y[0]-j.y[1])/(g.domain()[0]-g.domain()[1]));else{var c=d3.min(b.selectAll(".spec-line")[0].map(function(a){return a.range.y[0]})),d=d3.max(b.selectAll(".spec-line")[0].map(function(a){return a.range.y[1]})),e=d-c;c-=.05*e,d+=.05*e,j.y=[c,d],g.domain(j.y),h.rangechange({y:j.y}),k.scale(1)}h.regionchange({ydomain:g.domain()}),b.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(j.x=a.x),a.y&&(j.y=a.y),h.rangechange(a),a.norender||b.on("_regionchange")({xdomain:j.x,ydomain:j.y})}).on("mouseenter",h.mouseenter).on("mouseleave",h.mouseleave).on("mousemove",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.mousemove(b)}).on("mousedown",function(a){var c=new Event("mousedown");c.pageX=d3.event.pageX,c.clientX=d3.event.clientX,c.pageY=d3.event.pageY,c.clientY=d3.event.clientY,b.select(".main-brush").node().dispatchEvent(c)}).on("click",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.click(b)}).on("dblclick",h.regionfull),h.on("regionfull",function(){b.on("_regionchange")({xdomain:j.x})}),b.append("rect").attr("width",c).attr("height",d).style("fill","none"),b.call(e.d1.mainBrush().xScale(f).dispatcher(h)),b.node().addSpecLine(i),b.call(e.d1.pp().xScale(f).yScale(g).dispatcher(h))}var b,c,d,f,g,h,i,j={},k=d3.behavior.zoom().on("zoom",function(){var a=j.y[1]/k.scale()-j.y[0],c=(a-(g.domain()[1]-g.domain()[0]))/2,d=[];g.domain()[0]==j.y[0]?d[0]=j.y[0]:d[0]=Math.max(g.domain()[0]-c,j.y[0]),d[1]=d[0]+a,b.on("_regionchange")({zoom:!0,ydomain:d})});return a.datum=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(h=b,a):h},a.xScale=function(b){return arguments.length?(f=b,a):f},a.yScale=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(c=b,a):c},a.height=function(b){return arguments.length?(d=b,a):d},a},e.d2={},e.d2.crosshair=function(){function a(a){var f=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),g=0;
b=a.append("g").classed("crosshair clr"+g,!0).datum(null).call(f);var h=b.append("g").attr("class","crosshair line");h.append("path").attr("class","crosshair line x").attr("d",d3.svg.line()([[-c.range()[1],0],[c.range()[1],0]])),h.append("path").attr("class","crosshair line y").attr("d",d3.svg.line()([[0,-d.range()[0]],[0,d.range()[0]]]));var i=b.append("circle").attr("r",4.5);b.append("text").attr("x",9).attr("dy","-1em"),b.on("_regionchange",function(a){b.datum(null),b.attr("transform","translate(-10000,-10000)")}).on("_mousemove",function(a){var e=[c.invert(a.xcoor),d.invert(a.ycoor)];f.text(d3.round(e[0],3)+", "+d3.round(e[1],3)).show(i.node()),b.datum(e),b.attr("transform","translate("+a.xcoor+","+a.ycoor+")")}),b.node().show=function(a){return arguments.length?(b.style("display",a?null:"none"),a?f.show(b):f.hide(),void e.on("mousemove.line."+j,a?b.on("_mousemove"):null)):!("none"===b.style("display"))},b.node().enable=function(a){return arguments.length?(a?(e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)})):(e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null)),void b.node().show(a)):params.crosshair},b.node().remove=function(){e.on("regionchange.line."+j,null),e.on("mouseenter.line."+j,null),e.on("mouseleave.line."+j,null),e.on("mousemove.line."+j,null),e.on("crosshairEnable.line."+j,null),data=null,b.remove()};var j=++e.idx;return e.on("regionchange.line."+j,b.on("_regionchange")),e.on("mouseenter.line."+j,function(){b.node().show(!0)}),e.on("mouseleave.line."+j,function(){b.node().show(!1)}),e.on("mousemove.line."+j,b.on("_mousemove")),e.on("crosshairEnable.line."+j,b.node().enable),b}var b,c,d,e;return a.dispatcher=function(b){return arguments.length?(e=b,a):e},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.d2.main_focus=function(){function a(a){b=a.append("g").attr("class","main-focus").attr("pointer-events","all").attr("width",c).attr("height",d).call(k).on("dblclick.zoom",null).on("mousedown.zoom",null),b.node().dispatch_idx=0,b.node().nSpecs=0,b.node().xScale=f,b.node().yScale=g,b.node().range=j,b.node().addPeaks=function(a){b.select(".peaks").node().addpeaks(i.subset(a)),b.select(".peaks").on("_regionchange")({xdomain:!0}),b.select(".peaks").on("_redraw")({x:!0})},b.node().addSpec=function(a,c,d){arguments.length<2&&(c=!0);var i;d&&console.log("overwrite size:",d.size()),d&&0!=d.size()?(console.log("overwriting spec"),i=d,i.node().setData(a.data),a.s_id&&i.node().s_id(a.s_id)):i=e.d2.spec2d().datum(a.data).xScale(f).yScale(g).s_id(a.s_id).range({x:a.x_domain,y:a.y_domain}).crosshair(c).dispatcher(h)(b);var j=f.domain(),k=g.domain();return console.log("domains: ",a.x_domain,a.y_domain),b.on("_rangechange")({x:a.x_domain,y:a.y_domain,norender:b.node().nSpecs>0}),b.node().nSpecs>0&&b.on("_regionchange")({xdomain:j,ydomain:k}),b.node().nSpecs++,i},b.node().addSpecLine=b.node().addSpec,b.node().nd=2,b.node().getThreshold=function(a){b.call(e.d1.threshold().xScale(f).yScale(g).dispatcher(h).callback(a))},b.on("_redraw",function(a){h.redraw(a)}).on("_regionchange",function(a){a.xdomain&&f.domain(a.xdomain),a.ydomain&&g.domain(a.ydomain),h.regionchange({xdomain:a.xdomain,ydomain:g.domain()}),b.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(j.x=a.x),a.y&&(j.y=a.y),h.rangechange(a),a.norender||b.on("_regionchange")({xdomain:j.x,ydomain:j.y})}).on("mouseenter",h.mouseenter).on("mouseleave",h.mouseleave).on("mousemove",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.mousemove(b)}).on("mousedown",function(a){var c=new Event("mousedown");c.pageX=d3.event.pageX,c.clientX=d3.event.clientX,c.pageY=d3.event.pageY,c.clientY=d3.event.clientY,b.select(".main-brush").node().dispatchEvent(c)}).on("click",function(a){var b=d3.event;b.xcoor=d3.mouse(this)[0],b.ycoor=d3.mouse(this)[1],h.click(b)}).on("dblclick",h.regionfull),h.on("regionfull",function(){b.on("_regionchange")({xdomain:j.x,ydomain:j.y})}),b.node().addSpec(i),b.call(e.d1.mainBrush().xScale(f).yScale(g).dispatcher(h))}var b,c,d,f,g,h,i,j={},k=d3.behavior.zoom().on("zoom",function(){d3.select("#rfunc").attr("slope",k.scale()),d3.select("#bfunc").attr("slope",k.scale())}).scaleExtent([.1,100]);return a.datum=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(h=b,a):h},a.xScale=function(b){return arguments.length?(f=b,a):f},a.yScale=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(c=b,a):c},a.height=function(b){return arguments.length?(d=b,a):d},a},e.d2.spec2d=function(){function a(a){var k,l=a.attr("width"),m=a.attr("height");h=a.append("g").attr("class","spec-img"),h.attr("clip-path","url(#"+h.selectP(".spec-slide").node().clip_id+")");var n=h.append("g").attr("filter","url(#2dColorFilter)").append("svg:image").attr("width",l).attr("height",m).attr("xlink:href","data:image/ png;base64,"+b).attr("preserveAspectRatio","none");h.node().range=i,j&&(k=e.d2.crosshair().xScale(c).yScale(d).dispatcher(g)(h)),h.on("_redraw",function(a){console.log("scale & range: ",c,i.x);var b=c.copy().domain(i.x),e=d.copy().domain(i.y),f=[-Math.min(b(c.domain()[1]),b(c.domain()[0])),-Math.min(e(d.domain()[1]),e(d.domain()[0]))],g=[Math.abs((i.x[0]-i.x[1])/(c.domain()[0]-c.domain()[1])),Math.abs((i.y[0]-i.y[1])/(d.domain()[0]-d.domain()[1]))];n.attr("transform","scale("+g+")translate("+f+")")}).on("_regionchange",function(a){}).on("_integrate",function(a){}).on("_segment",function(a){});var o=++g.idx;return g.on("regionchange.line."+o,h.on("_regionchange")),g.on("redraw.line."+o,h.on("_redraw")),h.node().specData=function(){return b},h.node().setData=function(a){b=a,n.attr("xlink:href","data:image/ png;base64,"+b),h.on("_redraw")()},h.node().specRange=function(){return i},h.node().s_id=function(){return f},h.node().remove=function(){g.on("regionchange.line."+o,null),g.on("redraw.line."+o,null),b=null,h.remove()},h}var b,c,d,f,g,h,i={},j=!0;return a.datum=function(c){return arguments.length?(b=c,a):b},a.range=function(b){return arguments.length?(i=b,a):i},a.dispatcher=function(b){return arguments.length?(g=b,a):g},a.crosshair=function(b){return arguments.length?(j=b,a):j},a.s_id=function(b){return arguments.length?(f=b,a):f},a.xScale=function(b){return arguments.length?(c=b,a):c},a.yScale=function(b){return arguments.length?(d=b,a):d},a},e.app=function(){function b(h){if("undefined"==typeof d||"undefined"==typeof f||isNaN(d)||isNaN(f)){var i=h.node(),j=i.clientWidth?[i.clientWidth,i.clientHeight]:[i.getBoundingClientRect().width,i.getBoundingClientRect().height];d=j[0]-50,f=j[1]}if(400>d||400>f)throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px");var k=d3.dispatch("slideChange","slideContentChange","menuUpdate");c=h.append("div").classed("spec-app",!0).attr({width:d,height:f}),c.node().dispatcher=k,a("./src/modals").init(c.node()),c.call(e.menu()),t(c.node()),c.node().appendSlide=function(a){c.selectAll(".spec-slide").classed("active",!1),c.call(e.slide().datum(a).width(d).height(f)),k.slideChange()},c.node().appendToCurrentSlide=function(a){var b=c.select(".spec-slide.active").node();b?(b.addSpec(a),k.slideContentChange()):c.node().appendSlide(a)},c.node().options=b.options,k.on("slideChange.app",function(){c.node().slideDispatcher=c.select(".spec-slide.active").node().slideDispatcher});for(var l=0;l<g.length;l++)c.node().appendSlide(g[l].slide)}var c,d,f,g=[];return b.appendSlide=function(a){if(!arguments.length)throw new Error("appendSlide: No data provided.");return c?c.node().appendSlide(a):g.push({slide:a}),b},b.appendToCurrentSlide=function(a){if(!arguments.length)throw new Error("appendToCurrentSlide: No data provided.");if(!c){if(0===g.length)return b.appendSlide(a);var d=g[g.length-1].slide;return d.push(a),b}c.node().appendToCurrentSlide(a)},b.width=function(a){return arguments.length?(d=a,b):d},b.height=function(a){return arguments.length?(f=a,b):f},b.options={grid:{x:!1,y:!1}},b},e.slide=function(){function a(a){if(!b)return void create_empty_slide();var g=20,h={top:10+g,right:40,bottom:40,left:10+g},i=c-h.left-h.right,j=f-h.top-h.bottom,k=d3.scale.linear().range([0,i]),l=d3.scale.linear().range([j,0]),m=d3.svg.axis().scale(k).orient("bottom"),n=d3.svg.axis().scale(l).orient("right").tickFormat(d3.format("s")),o=d3.svg.axis().scale(k).orient("bottom").innerTickSize(j).tickFormat(""),p=d3.svg.axis().scale(l).orient("right").innerTickSize(i).tickFormat(""),q=b.nd&&2===b.nd,r=d3.dispatch("rangechange","regionchange","regionfull","redraw","mouseenter","mouseleave","mousemove","click","keyboard","peakpickEnable","peakdelEnable","peakpick","peakdel","integrateEnable","integrate","integ_refactor","crosshairEnable","blindregion","log");r.idx=0;var s=a.append("svg").attr({width:c,height:f}).classed("spec-slide",!0).classed("active",!0),t=s.append("g").attr("transform","translate("+h.left+","+h.top+")");s.node().clip_id=d();var u=s.append("defs");if(u.append("clipPath").attr("id",s.node().clip_id).append("rect").attr("width",i).attr("height",j),q){var v=u.append("filter").attr("id","2dColorFilter");v.append("feColorMatrix").attr("type","matrix").attr("values","1 0 0 0 0	0 0 0 0 0 1 0 0 0 0 0 0 0 1 0");var w=v.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");w.append("feFuncR").attr("type","linear").attr("slope","-1").attr("intercept","0.5"),w.append("feFuncB").attr("type","linear").attr("slope","1").attr("intercept","-0.5");var w=v.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");w.append("feFuncR").attr("id","rfunc").attr("type","linear").attr("slope","1"),w.append("feFuncB").attr("id","bfunc").attr("type","linear").attr("slope","1"),v.append("feColorMatrix").attr("type","matrix").attr("values","-10 0 0 0 1 -10 0 -10 0 1 0 0 -10 0 1 0 0 0 1 0")}t.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")"),t.append("g").attr("class","y axis").attr("transform","translate("+i+",0)"),t.append("g").classed("x grid",!0),t.append("g").classed("y grid",!0),t.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",i/2).attr("y",j).attr("dy","2.8em").text("Chemical shift (ppm)"),t.append("text").attr("class","y label").attr("text-anchor","end").attr("y",i).attr("dy","-.75em").attr("transform","rotate(-90)").text("Intensity"),r.on("redraw.slide",function(b){b.x&&(t.select(".x.axis").call(m),a.node().options.grid.x&&t.select(".x.grid").call(o)),b.y&&(t.select(".y.axis").call(n),a.node().options.grid.y&&t.select(".y.grid").call(p))});var x=q?e.d2.main_focus:e.d1.main_focus;t.call(x().datum(b).xScale(k).yScale(l).width(i).height(j).dispatcher(r)),t.call(e.d1.scaleBrush().xScale(k).dispatcher(r)),t.call(e.d1.scaleBrush().yScale(l).dispatcher(r)),s.node().nd=q?2:1,s.node().addSpec=function(a){t.select(".main-focus").node().addSpec(a)},s.node().slideDispatcher=r}var b,c,f;return a.datum=function(c){return arguments.length?(b=c,a):b},a.width=function(b){return arguments.length?(c=b,a):c},a.height=function(b){return arguments.length?(f=b,a):f},a},e.slideChanger=function(){function a(a){var b;if(0===a.select(".slide-changer").size()){var c=a.append("g").attr("class","slide-changer"),d=a.attr("width"),e=a.attr("height"),f=c.append("svg:foreignObject").attr("width",d).attr("height",e).style("pointer-events","all").append("xhtml:div").classed("slideout",!0).on("click",function(){f.toggleClass("active")});f.append("xhtml:p").text("Slides"),b=f.append("xhtml:div").classed("slideout_inner",!0).text("Switch Slide")}else b=a.select(".slideout_inner");var g=a.selectAll(".spec-slide");b.selectAll("div").data(g[0]).enter().append("xhtml:div").text(function(a,b){return"slide "+(b+1)}),b.selectAll("div").on("click",function(b){g.classed("active",!1),d3.select(b).classed("active",!0),a.node().dispatcher=b.slideDispatcher})}return a};var w=function(){var a=function(){function a(a,b){var c=b[1]-b[0],d=a[1]-a[0];return function(e){return(e-b[0])/c*d+a[0]}}self.onmessage=function(b,c){b=b.data;for(var d=b.buffer,e=b._16bit?d.length/2:d.length,f=a(b.y_range,b.y_domain),g=new Float64Array(e/4),h=0;e>h;h+=4)b._16bit?g[h/4]=f((d[h+e]<<8)+d[h]):g[h/4]=f(d[h]);self.postMessage(g,[g.buffer])}},b=new Blob(["("+a.toString()+")()"],{type:"application/javascript"}),c=window.URL.createObjectURL(b),d=new Worker(c);return d};f.worker=w(),f.worker_queue=function(a){var b,c=[],d={};return d.next=function(){b=c.shift(),b&&(a.onmessage=function(a){var c=b.callback;d.next(),c(a)},a.postMessage(b.message[0],b.message[1]))},d.addJob=function(a){c.push(a),b||d.next()},d},f.worker.queue=f.worker_queue(f.worker);var x=function(a,b){var c=a.x.map(function(b,c){return{x:b,y:a.y[c]}});b(c)},y=function(a,b){var c=atob(a.y);console.log(c);var d=d3.scale.linear().range(a.x_domain).domain([0,c.length]),e=d3.scale.linear().range(a.y_domain).domain([0,255]),f=c.map(function(a,b){return{x:d(b),y:e(a)}});b(f)},z=function(a,b){if(a.nd&&1!=a.nd)2==a.nd?b(a):console.log("Unsupported data dimension: "+a.nd);else{var c=document.createElement("img");c.onload=function(){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var e={};e._16bit="png16"==a.format;var g=d.getContext("2d");g.drawImage(c,0,0),e.buffer=g.getImageData(0,0,c.width,c.height).data,e.y_range=a.y_domain,e.y_domain=[0,255],e._16bit&&(e.y_domain=[0,Math.pow(2,16)-1]);var h=function(c){console.log("worker done");var d=[].slice.call(c.data);if(a.x_domain){var e=d3.scale.linear().range(a.x_domain).domain([0,d.length]);d=d.map(function(a,b){return{x:e(b),y:a}})}a.data=d,b(a)},i=[e,[e.buffer.buffer]];f.worker.queue.addJob({message:i,callback:h})};var d=a.data?a.data:a.y;c.src="data:image/png;base64,"+d}};f.process_spectrum=function(a,b){if(console.log("processing"),a.constructor!==Array)switch(a.format){case"xy":x(a,b);break;case"base64":y(a,b);break;case"png":case"png16":z(a,b)}else for(var c=a.length-1;c>=0;c--)f.process_spectrum(a[c],b)},f.get_spectrum=function(b,c){var d=a("./src/pro/ajax");d.getJSON(b,function(a){f.process_spectrum(a,c)})},f.read_menu=function(b,c){var d=f.plugins(b),e=a("./src/modals"),g=function(a,b){console.log(a,b);for(var c=a.length-1;c>=0;c--)if(a[c].label==b)return a[c].children||(a[c].children=[]),a[c];return a.push({label:b,children:[]}),a[a.length-1]},h=function(a){return a.args?function(){e.methods(a.fun,a.args,a.title)()}:function(){d.request(a.fun)}},i=a("./src/pro/ajax");i.getJSON("/nmr/test",function(a){console.log(c);for(var d=a,e=0;e<a.length;e++){for(var f=g(c,d[e].menu_path[0]),i=1;i<d[e].menu_path.length;i++)f=g(f.children,d[e].menu_path[i]);f.children=null,f.fun=h(d[e]),f.nd=d[e].nd}console.log(c),b.dispatcher.menuUpdate()})},f.output={},f.output.overwriteSpec=function(a,b){"undefined"==typeof b&&"undefined"!=typeof a.s_id&&(b=a.s_id);var c=d3.select(".spec-slide.active").select(".main-focus"),d=1==c.node().nd?".spec-line":".spec-img",e=c.selectAll(d).filter(function(a){return this.s_id()==b});c.node().addSpecLine(a,!0,e)},f.output.preview=function(a){d3.select(".preview-spec").size()>0?d3.select(".preview-spec").node().setData(a):d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a,!1).classed("preview-spec",!0)},f.output.newSpec=function(a){d3.select(".spec-slide.active").select(".main-focus").node().addSpecLine(a)},f.output.newSlide=function(a){},f.analysis={},f.analysis.addPeaks=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(console.log(f),1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addPeaks(b.peaks)},f.analysis.addSegments=function(b){var c=b.s_id,d=d3.select(".spec-slide.active").select(".main-focus"),e=1==d.node().nd?".spec-line":".spec-img",f=d.selectAll(e).filter(function(a){return this.s_id()===c});if(1!=f.size()){var g=a("./src/modals");g.error("Incompatible server response","Can't find spectrum with s_id:"+c)}f.node().addSegmentByIndex(b.segs)},f.plugins=function(b){var c={},d=function(){var a=d3.select(b).select(".spec-slide.active").select(".main-focus"),c=1==a.node().nd?".spec-line":".spec-img",d=a.selectAll(c+".selected")[0].map(function(a){return a.s_id()});return 0==d.length&&(d=a.selectAll(c)[0].map(function(a){return a.s_id()})),d},e=function(a,b){var c=a.output?f.output[a.output]:f.output.overwriteSpec;f.process_spectrum(a,c)},g=function(a,b){void 0!==a.peaks&&f.analysis.addPeaks(a),void 0!==a.segs&&f.analysis.addSegments(a)};return c.request=function(b,e,f,g){e||(e={}),e.sid||(f?e.sid=f:e.sid=d()),0===e.sid.length&&error("No Spectra selected","Please select one or more spectra!");var h=b+"_",i="sid="+JSON.stringify(e.sid)+"&preview="+ +g+"&"+h+"=null";for(var j in e)"sid"!==j&&(i.length>0&&(i+="&"),i+=h+j+"="+e[j]);var k="/nmr/plugins?"+i,l=a("./src/pro/ajax");l.getJSON(k,function(a){c.response(a,g)})},c.response=function(a,b){if(a.constructor!==Array)return void 0===a.data_type||"spectrum"===a.data_type?e(a,b):"spec_feature"===a.data_type?void g(a,b):"spec_like"===a.data_type?void handle_spec_like(a,b):void 0;for(var d=a.length-1;d>=0;d--)c.response(a[d])},c},window.spec=e,window.pro=f,console.log("specdraw:"+e.version)}()},{"./lib/simplify":1,"./src/elem":3,"./src/modals":4,"./src/pro/ajax":5}],3:[function(a,b,c){var d={};d.num=function(a,b,c,d,e,f){var g=d3.select(document.createElement("label"));return g.classed("param num",!0).text(a).append("input").attr({type:"number",value:"undefined"==typeof b?0:b,min:"undefined"==typeof c?-(1/0):c,max:"undefined"==typeof d?1/0:d,step:"undefined"==typeof e?1:e}).text("undefined"==typeof f?"":f),g.node().getValue=function(){return g.select("input").node().value},function(){return g.node()}},d.checkbox=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param checkbox",!0).append("input").attr("type","checkbox").on("change",function(){fireEvent(this,"input")}).node().checked=b?!0:!1,c.append("div").classed("checker",!0),c.append("div").classed("label",!0).text(a),c.node().getValue=function(){return c.select("input").node().checked},function(){return c.node()}},d.checkbox_toggle=function(a,b,c){var e=d3.select(document.createElement("div")).classed("param checkbox-toggle",!0);return e.append(d.checkbox(a,b)).select("input").on("change",function(){e.select(".div_enable").classed("disabled",!this.checked),fireEvent(this,"input")}),e.append(d.div(c)).classed("div_enable",!0).classed("disabled",!e.select("input").node().checked),e.node().getValue=e.select(".param.checkbox").node().getValue,function(){return e.node()}},d.select=function(a,b,c){var d=d3.select(document.createElement("label")).classed("param select",!0).text(a),e=d.append("select");return e.selectAll("option").data(b).enter().append("option").text(function(a){return a}),e.node().value=c,d.node().getValue=function(){return e.node().value},function(){return d.node()}},d.select_multi=function(a,b){var c=d3.select(document.createElement("div")).classed("param select-multi",!0);return c.append("label").text(a).append("input").attr("type","checkbox").style("display","none").on("change",function(){c.select("ul").classed("shown",this.checked)}).node().checked=!1,c.append("ul").classed("block-list",!0).selectAll("li").data(b).enter().append("li").each(function(a){d3.select(this).append(d.checkbox(a,!0))}),c.node().getValue=function(){return c.selectAll(".param.checkbox").filter(function(){return this.children[0].checked})[0].map(function(a){return"undefined"!=typeof a.value?a.value:d3.select(a).select(".label").text()})},function(){return c.node()}},d.select_toggle=function(a,b){console.log(a,b);var c=d3.select(document.createElement("div")).classed("param select-toggle",!0);c.append(d.select(a,Object.keys(b))).selectAll("option").attr("value",function(a){return a}).text(function(a){return b[a][0]});var e=c.append("div").classed("method_params",!0),f=c.select("select").node();return c.select("select").on("input",function(){d3.event.stopPropagation()}).on("change",function(){e.select("fieldset").remove(),Object.keys(b[f.value][1]).length>0&&e.append("fieldset").append(d.div(b[f.value][1])),fireEvent(this.parentNode,"input")}),Object.keys(b[f.value][1]).length>0&&e.append("fieldset").append(d.div(b[f.value][1])),c.node().getValue=function(){return f.value},function(){return c.node()}},d.button=function(a){var b=d3.select(document.createElement("input")).classed("param btn",!0).attr("type","button").attr("value",a).on("click",function(){fireEvent(this,"input")});return b.node().getValue=function(){return d3.event&&d3.event.target===b.node()},function(){return b.node()}},d.threshold=function(a){var b=d3.select(document.createElement("div")).classed("param threshold",!0),c=b.append("input").attr("type","hidden"),e=b.append("input").attr("type","text").attr("readonly","readonly");return b.insert(d.button(a),":last-child").on("click",function(){var a=d3.selectAll(".nanoModalOverride:not([style*='display: none'])").style("display","none");d3.select(".spec-slide.active").select(".main-focus").node().getThreshold(function(b){e.attr("value",b.toExponential(2)),c.attr("value",b),a.style("display","block")})}),b.node().getValue=function(){return c.node().value},function(){return b.node()}},d.div=function(a){var b=d3.select(document.createElement("div"));for(var c in a){var d=a[c];"function"!=typeof d&&(b.append(e.apply(null,d)).node().id=c)}return function(){return b.node()}};var e=function(a,b,c){var e=[d.num,d.checkbox,d.text,d.select_toggle,d.checkbox_toggle,d.button,d.threshold][b];return e.apply(null,[a].concat(c))};d.spectrumSelector=function(){var a=d3.select(".spec-slide.active").select(".main-focus").selectAll(".spec-line");if(0===a.size())return function(){return d3.select(document.createElement("div")).text("No Spectra to show").node()};var b=d3.select(d.select_multi("Select Spectrum",a[0])()).classed("spec-selector",!0);return b.selectAll("li").each(function(a){d3.select(this).select(".checkbox").style("color",getComputedStyle(a.childNodes[0]).stroke).select(".label").text(a.label),d3.select(this).on("mouseenter",function(){d3.select(a.parentNode).classed("dimmed",!0),d3.select(a).classed("highlighted",!0)}).on("mouseleave",function(){d3.select(a.parentNode).classed("dimmed",!1),d3.select(a).classed("highlighted",!1)})}),b.node().getValue=function(){return b.selectAll("li").filter(function(){return d3.select(this).select("input").node().checked===!0}).data().map(function(a){return a.s_id()})},b.node().id="sid",function(){return b.node()}},d.preview=function(a){var b={prev_auto:["Instant Preview",1,"undefined"!=typeof a],prev_btn:["Preview",5,null]};return d.div(b)},d.popover=function(a){var b=d3.select(document.createElement("div")).classed("popover right",!0);b.append("div").classed("arrow",!0);var c=b.append("div").classed("popover-inner",!0);return c.append("h3").classed("popover-title",!0).text(a),c.append("div").classed("popover-content",!0),function(){return b.node()}},b.exports=d},{}],4:[function(a,b,c){var d,e={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1};e.init=function(a){d=a},nanoModal.customHide=function(a,b){b.modal.el.style.display="block",a()},e.proto=function(a,b,c,e){var f=nanoModal(b,{overlayClose:!1,autoRemove:!0,buttons:[{text:"OK",handler:c,primary:!0},{text:"Cancel",handler:e?e:"hide",classes:"cancelBtn"}]});if(!d)return void console.log("App is not defined. Initialize the modal module first.");d3.select(d).append(function(){return f.overlay.el}),d3.select(d).append(function(){return f.modal.el});var g=d3.select(f.modal.el);return g.insert("div",":first-child").classed("title",!0).text(a?a:"Dialogue"),g.on("keydown",function(){13===d3.event.keyCode&&d3.select(f.modal.el).select(".nanoModalBtnPrimary").node().click(),27===d3.event.keyCode&&d3.select(f.modal.el).select(".cancelBtn").node().click()}),f.onShow(function(){g.style({display:"flex","flex-direction":"column","margin-left":-g.node().clientWidth/2,"max-width":.8*g.node().parentNode.clientWidth,"max-height":.8*g.node().parentNode.clientHeight});var a=d3.behavior.drag().on("drag",function(){g.style("top",d3.event.sourceEvent.pageY+"px").style("left",d3.event.sourceEvent.pageX+"px")});d3.select(f.modal.el).select(".title").call(a),d3.select(f.modal.el).select(".cancelBtn").node().focus()}),f},e.error=function(a,b){var c=e.proto("Error: "+a,b);d3.select(c.modal.el).classed("errorModal",!0).select(".cancelBtn").text("Dismiss"),c.show()},e.range=function(a,b,c,d){var f;f=b[0]>b[1]?[b[1],b[0]]:b,f=[d3.round(f[0],3),d3.round(f[1],3)],"undefined"==typeof d?d=f:(d[0]>d[1]&&(d=[d[1],d[0]]),d=[d3.round(d[0],3),d3.round(d[1],3)]);var g=a+'<input type="number" id="range0" step="0.001" value='+d[0]+" min="+f[0]+" max="+f[1]+'> - <input type="number" id="range1" step="0.001" value='+d[1]+" min="+f[0]+" max="+f[1]+">",h=e.proto("Range",g,function(a){a.hide();var d=d3.select(a.modal.el).selectAll("input")[0].map(function(a){return+a.value});d[0]<f[0]||d[0]>f[1]||d[1]<f[0]||d[1]>f[1]||d[0]>d[1]?nanoModal("Invalid input."+d).show():c(b[0]>b[1]?d.reverse():d)});return h.show},e.input=function(a,b,c){var d=a+'<input type="number" id="input0" step="0.001" value='+b+">",f=e.proto("Numeric",d,function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;c(b)});return f.show},e.xRegion=function(){e.range("Set x region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.x,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({xdomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().xScale.domain())()},e.yRegion=function(){e.range("Set y region to:\n",d3.select(".spec-slide.active").select(".main-focus").node().range.y,function(a){d3.select(".spec-slide.active").select(".main-focus").on("_regionchange")({ydomain:a})},d3.select(".spec-slide.active").select(".main-focus").node().yScale.domain())()},e.slider=function(a,b,c){var d=a+'<input id="slider" type="range" min="-5" max="5" value="0" step="0.001"/>',f=e.proto("Slider",d,function(a){a.hide()},function(a){c(0)});return d3.select(f.modal.el).select("#slider").on("input",function(){c(+this.value)}),f.show},e.scaleLine=function(){e.slider("Scale spectrum by a factor:",0,function(a){d3.select(".selected").node().setScaleFactor(Math.pow(2,a))})()},e.methods=function(b,c,f,g,h){var i,j=!0,k=pro.plugins(d),l=function(a){j=!1,fireEvent(i.node(),"input"),a.hide()},m=e.proto(f,"",l);i=d3.select(m.modal.el).select(".nanoModalContent");var n=null;i.on("input",function(){var a={};i.selectAll(".param").filter(function(){return""!==this.id}).each(function(b){a[this.id]=this.getValue()}),n&&clearTimeout(n),j===!1||d3.event.target===i||a.prev_btn===!0?k.request(b,a,a.s_id,j):a.prev_auto===!0&&(n=setTimeout(function(){k.request(b,a,a.s_id,!0)},300))});var o=a("./elem");return i.append(o.spectrumSelector()),i.append(o.div(c)),i.append(o.preview(!0)),m.show},b.exports=e},{"./elem":3}],5:[function(a,b,c){var d=a("../modals"),e=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){var a=4,e=200;d.readyState===a&&d.status===e?"function"==typeof b&&b(d.responseText):d.readyState===a&&c(d.responseText)},d.send()},f=function(a,b,c){var f=g();e(a,function(a){f.stop();var c=JSON.parse(a);"undefined"==typeof c.error?b(c):d.error(c.error.name,c.error.message)},function(a){f.stop(),d.error("Network Error",a)}),c&&f()},g=function(){function a(){e("/nmr/test",function(b){c?ajax("/nmr/test?complete=1"):(d3.select(".progress").text(b),setTimeout(a,100))})}var b,c=!1,d=function(){a()};return d.stop=function(){clearInterval(b),c=!0,d3.select(".progress").text("Completed")},d};b.exports.request=e,b.exports.getJSON=f},{"../modals":4}]},{},[2,5,4,3]);